<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Journal: Integrate Bluetooth Lamp into HomeKit | The Coding Notes</title>
<meta name=keywords content="Bluetooth,HomeKit"><meta name=description content="I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart
Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit.
After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn&rsquo;t - a price difference of approximately 100 RMB."><meta name=author content="Lex Cao"><link rel=canonical href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/><link crossorigin=anonymous href=/assets/css/stylesheet.0633f72569546c04f177152a4fc857757796b843f92bb1208cf7114db62b1d94.css integrity="sha256-BjP3JWlUbATxdxUqT8hXdXeWuEP5K7EgjPcRTbYrHZQ=" rel="preload stylesheet" as=style><link rel=icon href=https://lexcao.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lexcao.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lexcao.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lexcao.io/apple-touch-icon.png><link rel=mask-icon href=https://lexcao.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/><link rel=alternate hreflang=zh href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DDVMDVDZMH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DDVMDVDZMH")}</script><meta property="og:title" content="Journal: Integrate Bluetooth Lamp into HomeKit"><meta property="og:description" content="I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart
Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit.
After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn&rsquo;t - a price difference of approximately 100 RMB."><meta property="og:type" content="article"><meta property="og:url" content="https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/"><meta property="og:image" content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-26T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-26T00:00:00+00:00"><meta property="og:site_name" content="The Coding Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta name=twitter:title content="Journal: Integrate Bluetooth Lamp into HomeKit"><meta name=twitter:description content="I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart
Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit.
After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn&rsquo;t - a price difference of approximately 100 RMB."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lexcao.io/posts/"},{"@type":"ListItem","position":2,"name":"Journal: Integrate Bluetooth Lamp into HomeKit","item":"https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Journal: Integrate Bluetooth Lamp into HomeKit","name":"Journal: Integrate Bluetooth Lamp into HomeKit","description":"I. The Challenge: Making a \u0026ldquo;Basic\u0026rdquo; Ceiling Light Smart Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit. After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn\u0026rsquo;t - a price difference of approximately 100 RMB.\n","keywords":["Bluetooth","HomeKit"],"articleBody":"I. The Challenge: Making a “Basic” Ceiling Light Smart Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit. After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn’t - a price difference of approximately 100 RMB.\nAs a developer, I approached this from first principles: Since the mobile app requires Bluetooth permissions, it must use Bluetooth for communication. If it’s Bluetooth-controlled, it can theoretically be controlled by other Bluetooth applications and integrated into smart home ecosystems.\nNote: For those interested in implementing this solution, refer to my detailed tutorial: Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit\nCurrent State Demonstration To view the final implementation, click here to jump.\nII. Exploration: Home Assistant and Bluetooth Control Solutions I began researching potential solutions. Since direct Mi Home integration wasn’t possible, I explored alternative approaches. This led me to discover Home Assistant (HA).\nHome Assistant Open source home automation that puts local control and privacy first. Powered by a worldwide community of tinkerers and DIY enthusiasts.\nI discovered that Home Assistant includes a HomeKit Bridge component that can bridge various non-HomeKit devices to HomeKit. This opened up new possibilities.\nFurther research in the Home Assistant community led me to ha-ble-adv, a solution specifically designed for Bluetooth integration.\nHome Assistant Bluetooth Low Energy Advertisement HA Custom Integration to control BLE ADV Ceiling Fans / Lamps Integration of Bluetooth controlled ceiling lamp Convert a “smart” chinese lamp to a real smart lamp Controlling BLE ceiling light with HA This led to a clear implementation plan:\nControl the Bluetooth light via ha-ble-adv Manage ha-ble-adv through Home Assistant Integrate with HomeKit using Home Assistant’s HomeKit Bridge III. Implementation: Docker Environment Challenges With the theory validated, I began implementation. I started by setting up Home Assistant:\nInstall Home Assistant Install Home Assistant Community Store (HACS) Install ha-ble-adv via HACS The first challenge emerged when attempting to connect the Bluetooth light: Bluetooth adapter not found. Research revealed that Home Assistant running in Docker cannot access host machine’s Bluetooth devices. Most tutorials focus on Linux environments. I found a solution:\nEasiest way to handle bluetooth (basically regardless of how you’re running HA) is to use an ESPHome BT proxy. Spend $5 on a ESP32, flash the BT proxy firmware, and you magically have bluetooth connectivity wherever you place your ESP(s) – Reddit: Is bluetooth possible for docker in Mac?\nAdditionally, ha-ble-adv doesn’t support native macOS Bluetooth devices, as documented in this issue.\nI purchased an ESP32 board for 25 RMB as the simplest solution.\n3.1 Initial ESP32 Setup: Wi-Fi Configuration I began configuring the ESP32. The ha-ble-adv documentation recommended using esphome-ble_adv_proxy as the Bluetooth proxy.\nFollowing the documentation:\nInstall ESPHome for ESP32 configuration and Home Assistant integration Connect the ESP32 board via ESPHome Flash the ble_adv_proxy component The second challenge appeared: Board remained offline after connection. ESPHome documentation revealed that most ESP32 models only support 2.4GHz Wi-Fi. Adjusting the Wi-Fi settings resolved the issue.\nThe ESP32 successfully connected to ble_adv_proxy. The Debug webpage showed it receiving Bluetooth signals from the environment.\n3.2 ESP32 Home Assistant Integration: mDNS Resolution The next step was integrating ESPHome with Home Assistant for ha-ble-adv to utilize the ble_adv_proxy.\nESPHome documentation indicated automatic discovery of the ESP32 device. However, the third challenge emerged: ESP32 addition failed. Automatic discovery failed, and manual addition using the .local address also failed. I attempted troubleshooting: Would using the IP address directly work? Given the Docker deployment, the container might not resolve the ESP32’s .local address. I added extra_hosts to the Home Assistant Docker configuration:\nextra_hosts: - \"esp32.local:192.168.50.66\" # Map esp32.local to its IP address Note: The automatic discovery failure indicated a deeper issue - mDNS service discovery protocol malfunction. This is a common issue in Docker deployments and affected subsequent operations.\nAfter restarting Home Assistant, the device connected successfully using the .local address.\n3.3 ha-ble-adv Configuration With successful device addition, ha-ble-adv recognized the ESP32 as a Bluetooth adapter. The fourth challenge appeared: ha-ble-adv configuration page inaccessible. Debug logs showed a Python code error. After extensive troubleshooting, I filed an issue. The author responded quickly and fixed the error.\nAfter updating ha-ble-adv, I successfully accessed the configuration page and configured the Bluetooth ceiling light. First milestone achieved: controlling the ceiling light via the ESP32 Bluetooth device! This enabled Home Assistant control of the light’s power state and brightness.\nIV. Final Challenge: HomeKit Bridge Integration The final step was adding the HomeKit Bridge to integrate the light into Apple’s HomeKit ecosystem. I expected this to be straightforward - enable the HomeKit Bridge component and add it in the Home app. The final and most challenging obstacle appeared: HomeKit Bridge addition failed. This issue persisted for three days.\nI researched extensively, consulting community posts and documentation. The problem pointed to network configuration. I investigated:\nDocker’s network_mode settings mDNS network configurations HomeKit network requirements Wi-Fi network settings I attempted reinstalling Home Assistant and adjusting various Docker configurations. Many users reported similar network issues in Docker environments, particularly with mDNS and HomeKit.\nV. Solution: Native Deployment I decided to remove Docker and deploy Home Assistant natively on macOS. The results were immediate:\nHome Assistant automatically recognized and enabled the macOS host’s Bluetooth adapter Home Assistant automatically discovered the ESP32 after ESPHome connection Each step proceeded smoothly, with results matching expectations. Finally, adding the HomeKit Bridge to HomeKit succeeded! 🎉\nI can now control the ceiling light through the iPhone’s “Home” app or via Siri! Power control and brightness adjustment work as expected.\nFinal Implementation Demo VI. Summary Despite challenges, I successfully integrated the “non-smart” ceiling light into HomeKit using an ESP32 (25 RMB), saving approximately 100 RMB compared to the Mi Home version. This solution provided both technical value and cost efficiency.\nLimitations: The ble-adv solution has several limitations:\nRequires continuous Home Assistant operation Requires persistent ESP32 connection Cannot track current state - e.g., if the light is turned off via remote, the phone app still shows it as on ","wordCount":"1023","inLanguage":"en","image":"https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format\u0026fit=crop\u0026w=720\u0026q=80","datePublished":"2025-04-26T00:00:00Z","dateModified":"2025-04-26T00:00:00Z","author":{"@type":"Person","name":"Lex Cao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/"},"publisher":{"@type":"Organization","name":"The Coding Notes","logo":{"@type":"ImageObject","url":"https://lexcao.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lexcao.io/ accesskey=h title="The Coding Notes (Alt + H)">The Coding Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://lexcao.io/zh/ title=中文 aria-label=中文>中文</a></li></ul></div></div><ul id=menu><li><a href=https://lexcao.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://lexcao.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://lexcao.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://lexcao.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://lexcao.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lexcao.io/>Home</a>&nbsp;»&nbsp;<a href=https://lexcao.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Journal: Integrate Bluetooth Lamp into HomeKit</h1><div class=post-meta><span title='2025-04-26 00:00:00 +0000 UTC'>April 26, 2025</span>&nbsp;·&nbsp;5 mins&nbsp;·&nbsp;Lex Cao&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit/>中文</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#i-the-challenge-making-a-basic-ceiling-light-smart aria-label="I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart">I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart</a><ul><li><a href=#current-state-demonstration aria-label="Current State Demonstration">Current State Demonstration</a></li></ul></li><li><a href=#ii-exploration-home-assistant-and-bluetooth-control-solutions aria-label="II. Exploration: Home Assistant and Bluetooth Control Solutions">II. Exploration: Home Assistant and Bluetooth Control Solutions</a></li><li><a href=#iii-implementation-docker-environment-challenges aria-label="III. Implementation: Docker Environment Challenges">III. Implementation: Docker Environment Challenges</a><ul><li><a href=#31-initial-esp32-setup-wi-fi-configuration aria-label="3.1 Initial ESP32 Setup: Wi-Fi Configuration">3.1 Initial ESP32 Setup: Wi-Fi Configuration</a></li><li><a href=#32-esp32-home-assistant-integration-mdns-resolution aria-label="3.2 ESP32 Home Assistant Integration: mDNS Resolution">3.2 ESP32 Home Assistant Integration: mDNS Resolution</a></li><li><a href=#33-ha-ble-adv-configuration aria-label="3.3 ha-ble-adv Configuration">3.3 ha-ble-adv Configuration</a></li></ul></li><li><a href=#iv-final-challenge-homekit-bridge-integration aria-label="IV. Final Challenge: HomeKit Bridge Integration">IV. Final Challenge: HomeKit Bridge Integration</a></li><li><a href=#v-solution-native-deployment aria-label="V. Solution: Native Deployment">V. Solution: Native Deployment</a><ul><li><a href=#final-implementation-demo aria-label="Final Implementation Demo ">Final Implementation Demo</a></li></ul></li><li><a href=#vi-summary aria-label="VI. Summary">VI. Summary</a><ul><li><a href=#limitations aria-label=Limitations:>Limitations:</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=i-the-challenge-making-a-basic-ceiling-light-smart>I. The Challenge: Making a &ldquo;Basic&rdquo; Ceiling Light Smart<a hidden class=anchor aria-hidden=true href=#i-the-challenge-making-a-basic-ceiling-light-smart>#</a></h2><p>Recently, I replaced my living room ceiling light with a new model. This light supports both remote and mobile app control, making it appear smart. However, it lacks integration with Mi Home or HomeKit.
After research, I discovered that the premium version of the same brand supports Mi Home control, while my basic version doesn&rsquo;t - a price difference of approximately 100 RMB.</p><p>As a developer, I approached this from first principles: Since the mobile app requires Bluetooth permissions, it must use Bluetooth for communication. If it&rsquo;s Bluetooth-controlled, it can theoretically be controlled by other Bluetooth applications and integrated into smart home ecosystems.</p><p><strong>Note:</strong> For those interested in implementing this solution, refer to my detailed tutorial: <a href=/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/>Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit</a></p><h3 id=current-state-demonstration>Current State Demonstration<a hidden class=anchor aria-hidden=true href=#current-state-demonstration>#</a></h3><p><video width=100% controls disablepictureinpicture controlslist=nodownload src=/videos/integrate-bluetooth-lamp-into-homekit/remoter_control_lamp.webm type=video/webm>
</video>
<video width=100% controls disablepictureinpicture controlslist=nodownload src=/videos/integrate-bluetooth-lamp-into-homekit/app_control_lamp.webm type=video/webm></video></p><p>To view the final implementation, <a href=/posts/integrate-bluetooth-lamp-into-homekit/#final>click here to jump</a>.</p><h2 id=ii-exploration-home-assistant-and-bluetooth-control-solutions>II. Exploration: Home Assistant and Bluetooth Control Solutions<a hidden class=anchor aria-hidden=true href=#ii-exploration-home-assistant-and-bluetooth-control-solutions>#</a></h2><p>I began researching potential solutions. Since direct Mi Home integration wasn&rsquo;t possible, I explored alternative approaches. This led me to discover <code>Home Assistant</code> (HA).</p><ul><li><a href=https://www.home-assistant.io/><code>Home Assistant</code></a></li></ul><blockquote><p>Open source home automation that puts local control and privacy first. Powered by a worldwide community of tinkerers and DIY enthusiasts.</p></blockquote><p>I discovered that <code>Home Assistant</code> includes a <code>HomeKit Bridge</code> component that can bridge various non-HomeKit devices to HomeKit. This opened up new possibilities.</p><p>Further research in the <code>Home Assistant</code> community led me to <code>ha-ble-adv</code>, a solution specifically designed for Bluetooth integration.</p><ul><li>Home Assistant Bluetooth Low Energy Advertisement</li><li><a href=https://community.home-assistant.io/t/ha-custom-integration-to-control-ble-adv-ceiling-fans-lamps/866888/1>HA Custom Integration to control BLE ADV Ceiling Fans / Lamps</a></li><li><a href=https://community.home-assistant.io/t/integration-of-bluetooth-controlled-ceiling-lamp/372969/1>Integration of Bluetooth controlled ceiling lamp</a></li><li><a href=https://community.home-assistant.io/t/convert-a-smart-chinese-lamp-to-a-real-smart-lamp/560607/1>Convert a &ldquo;smart&rdquo; chinese lamp to a real smart lamp</a></li><li><a href=https://community.home-assistant.io/t/controlling-ble-ceiling-light-with-ha/520612/1>Controlling BLE ceiling light with HA</a></li></ul><p>This led to a clear implementation plan:</p><ol><li>Control the Bluetooth light via <code>ha-ble-adv</code></li><li>Manage <code>ha-ble-adv</code> through <code>Home Assistant</code></li><li>Integrate with HomeKit using <code>Home Assistant</code>&rsquo;s <code>HomeKit Bridge</code></li></ol><img src=/images/integrate-bluetooth-lamp-into-homekit/ha-ble-adv-arch01.webp alt=ha-ble-adv-arch01><h2 id=iii-implementation-docker-environment-challenges>III. Implementation: Docker Environment Challenges<a hidden class=anchor aria-hidden=true href=#iii-implementation-docker-environment-challenges>#</a></h2><p>With the theory validated, I began implementation. I started by setting up <code>Home Assistant</code>:</p><ol><li>Install <code>Home Assistant</code></li><li>Install <code>Home Assistant</code> Community Store (HACS)</li><li>Install <code>ha-ble-adv</code> via HACS</li></ol><p>The first challenge emerged when attempting to connect the Bluetooth light: <strong>Bluetooth adapter not found</strong>.
Research revealed that <code>Home Assistant</code> running in <code>Docker</code> cannot access host machine&rsquo;s Bluetooth devices. Most tutorials focus on Linux environments.
I found a solution:</p><blockquote><p>Easiest way to handle bluetooth (basically regardless of how you&rsquo;re running HA) is to use an ESPHome BT proxy. Spend $5 on a ESP32, flash the BT proxy firmware, and you magically have bluetooth connectivity wherever you place your ESP(s)
&ndash; Reddit: <a href=https://www.reddit.com/r/homeassistant/comments/1hpyhlq/is_bluetooth_possible_for_docker_in_mac/>Is bluetooth possible for docker in Mac?</a></p></blockquote><p>Additionally, <code>ha-ble-adv</code> doesn&rsquo;t support native <code>macOS</code> Bluetooth devices, as documented in this <a href=https://github.com/NicoIIT/ha-ble-adv/discussions/33>issue</a>.</p><p>I purchased an <code>ESP32</code> board for 25 RMB as the simplest solution.</p><img src=/images/integrate-bluetooth-lamp-into-homekit/esp32.webp alt=esp32><h3 id=31-initial-esp32-setup-wi-fi-configuration>3.1 Initial ESP32 Setup: Wi-Fi Configuration<a hidden class=anchor aria-hidden=true href=#31-initial-esp32-setup-wi-fi-configuration>#</a></h3><p>I began configuring the <code>ESP32</code>. The <code>ha-ble-adv</code> documentation recommended using <code>esphome-ble_adv_proxy</code> as the Bluetooth proxy.</p><img src=/images/integrate-bluetooth-lamp-into-homekit/ha-ble-adv-arch02.webp alt=ha-ble-adv-arch02><p>Following the documentation:</p><ol><li>Install ESPHome for <code>ESP32</code> configuration and <code>Home Assistant</code> integration</li><li>Connect the <code>ESP32</code> board via ESPHome</li><li>Flash the <code>ble_adv_proxy</code> component</li></ol><p>The second challenge appeared: <strong>Board remained offline after connection</strong>.
ESPHome documentation revealed that most <code>ESP32</code> models only support 2.4GHz Wi-Fi. Adjusting the Wi-Fi settings resolved the issue.</p><p>The <code>ESP32</code> successfully connected to <code>ble_adv_proxy</code>. The Debug webpage showed it receiving Bluetooth signals from the environment.</p><img src=/images/integrate-bluetooth-lamp-into-homekit/esp32-debug-page.webp alt=esp32-debug-page><h3 id=32-esp32-home-assistant-integration-mdns-resolution>3.2 ESP32 Home Assistant Integration: mDNS Resolution<a hidden class=anchor aria-hidden=true href=#32-esp32-home-assistant-integration-mdns-resolution>#</a></h3><p>The next step was integrating ESPHome with <code>Home Assistant</code> for <code>ha-ble-adv</code> to utilize the <code>ble_adv_proxy</code>.</p><p>ESPHome documentation indicated automatic discovery of the <code>ESP32</code> device. However, the third challenge emerged: <strong>ESP32 addition failed</strong>.
Automatic discovery failed, and manual addition using the <code>.local</code> address also failed.
I attempted troubleshooting: Would using the IP address directly work?
Given the <code>Docker</code> deployment, the container might not resolve the <code>ESP32</code>&rsquo;s <code>.local</code> address. I added <code>extra_hosts</code> to the <code>Home Assistant</code> <code>Docker</code> configuration:</p><pre tabindex=0><code>    extra_hosts:
    - &#34;esp32.local:192.168.50.66&#34; # Map esp32.local to its IP address
</code></pre><p>Note: The automatic discovery failure indicated a deeper issue - mDNS service discovery protocol malfunction. This is a common issue in <code>Docker</code> deployments and affected subsequent operations.</p><p>After restarting <code>Home Assistant</code>, the device connected successfully using the <code>.local</code> address.</p><h3 id=33-ha-ble-adv-configuration>3.3 <code>ha-ble-adv</code> Configuration<a hidden class=anchor aria-hidden=true href=#33-ha-ble-adv-configuration>#</a></h3><p>With successful device addition, <code>ha-ble-adv</code> recognized the <code>ESP32</code> as a Bluetooth adapter.
The fourth challenge appeared: <strong><code>ha-ble-adv</code> configuration page inaccessible</strong>.
Debug logs showed a Python code error. After extensive troubleshooting, I filed an <a href=https://github.com/NicoIIT/ha-ble-adv/discussions/30>issue</a>.
The author responded quickly and fixed the error.</p><p>After updating <code>ha-ble-adv</code>, I successfully accessed the configuration page and configured the Bluetooth ceiling light.
First milestone achieved: controlling the ceiling light via the <code>ESP32</code> Bluetooth device!
This enabled <code>Home Assistant</code> control of the light&rsquo;s power state and brightness.</p><h2 id=iv-final-challenge-homekit-bridge-integration>IV. Final Challenge: HomeKit Bridge Integration<a hidden class=anchor aria-hidden=true href=#iv-final-challenge-homekit-bridge-integration>#</a></h2><p>The final step was adding the <code>HomeKit Bridge</code> to integrate the light into Apple&rsquo;s HomeKit ecosystem.
I expected this to be straightforward - enable the <code>HomeKit Bridge</code> component and add it in the Home app.
The final and most challenging obstacle appeared: <strong>HomeKit Bridge addition failed</strong>. This issue persisted for three days.</p><p>I researched extensively, consulting community posts and documentation.
The problem pointed to network configuration. I investigated:</p><ul><li><code>Docker</code>&rsquo;s <code>network_mode</code> settings</li><li>mDNS network configurations</li><li>HomeKit network requirements</li><li>Wi-Fi network settings</li></ul><p>I attempted reinstalling <code>Home Assistant</code> and adjusting various <code>Docker</code> configurations.
Many users reported similar network issues in <code>Docker</code> environments, particularly with mDNS and HomeKit.</p><h2 id=v-solution-native-deployment>V. Solution: Native Deployment<a hidden class=anchor aria-hidden=true href=#v-solution-native-deployment>#</a></h2><p>I decided to remove <code>Docker</code> and deploy <code>Home Assistant</code> natively on <code>macOS</code>.
The results were immediate:</p><ol><li><code>Home Assistant</code> automatically recognized and enabled the <code>macOS</code> host&rsquo;s Bluetooth adapter</li><li><code>Home Assistant</code> automatically discovered the <code>ESP32</code> after ESPHome connection</li></ol><p>Each step proceeded smoothly, with results matching expectations.
Finally, adding the <code>HomeKit Bridge</code> to HomeKit succeeded! 🎉</p><p>I can now control the ceiling light through the iPhone&rsquo;s &ldquo;Home&rdquo; app or via <code>Siri</code>! Power control and brightness adjustment work as expected.</p><h3 id=final-implementation-demo>Final Implementation Demo <a name=final><a hidden class=anchor aria-hidden=true href=#final-implementation-demo>#</a></h3><p><video width=100% controls disablepictureinpicture controlslist=nodownload src=/videos/integrate-bluetooth-lamp-into-homekit/home_control_lamp.webm type=video/webm>
</video>
<video width=100% controls disablepictureinpicture controlslist=nodownload src=/videos/integrate-bluetooth-lamp-into-homekit/hey_siri_open_light.webm type=video/webm></video></p><h2 id=vi-summary>VI. Summary<a hidden class=anchor aria-hidden=true href=#vi-summary>#</a></h2><p>Despite challenges, I successfully integrated the &ldquo;non-smart&rdquo; ceiling light into HomeKit using an <code>ESP32</code> (25 RMB), saving approximately 100 RMB compared to the Mi Home version. This solution provided both technical value and cost efficiency.</p><h3 id=limitations>Limitations:<a hidden class=anchor aria-hidden=true href=#limitations>#</a></h3><p>The <code>ble-adv</code> solution has several limitations:</p><ol><li>Requires continuous <code>Home Assistant</code> operation</li><li>Requires persistent <code>ESP32</code> connection</li><li>Cannot track current state - e.g., if the light is turned off via remote, the phone app still shows it as on</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://lexcao.io/tags/bluetooth/>Bluetooth</a></li><li><a href=https://lexcao.io/tags/homekit/>HomeKit</a></li></ul><nav class=paginav><a class=prev href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><span class=title>« Prev</span><br><span>Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit</span>
</a><a class=next href=https://lexcao.io/posts/genapi/><span class=title>Next »</span><br><span>Introducing genapi: A Golang HTTP Client Code Generator</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lexcao.io/>The Coding Notes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>