<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit | The Coding Notes</title>
<meta name=keywords content="Bluetooth,HomeKit,Home Assistant,ESPHome,Tutorial"><meta name=description content="Introduction
This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple&rsquo;s HomeKit ecosystem. The following mobile apps are supported:

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

By following this guide, you&rsquo;ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: Journal: Integrate Bluetooth Lamp into HomeKit."><meta name=author content="Lex Cao"><link rel=canonical href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><link crossorigin=anonymous href=/assets/css/stylesheet.0633f72569546c04f177152a4fc857757796b843f92bb1208cf7114db62b1d94.css integrity="sha256-BjP3JWlUbATxdxUqT8hXdXeWuEP5K7EgjPcRTbYrHZQ=" rel="preload stylesheet" as=style><link rel=icon href=https://lexcao.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lexcao.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lexcao.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lexcao.io/apple-touch-icon.png><link rel=mask-icon href=https://lexcao.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><link rel=alternate hreflang=zh href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DDVMDVDZMH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DDVMDVDZMH")}</script><meta property="og:title" content="Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit"><meta property="og:description" content="Introduction
This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple&rsquo;s HomeKit ecosystem. The following mobile apps are supported:

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

By following this guide, you&rsquo;ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: Journal: Integrate Bluetooth Lamp into HomeKit."><meta property="og:type" content="article"><meta property="og:url" content="https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"><meta property="og:image" content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-27T00:00:00+00:00"><meta property="og:site_name" content="The Coding Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta name=twitter:title content="Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit"><meta name=twitter:description content="Introduction
This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple&rsquo;s HomeKit ecosystem. The following mobile apps are supported:

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

By following this guide, you&rsquo;ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: Journal: Integrate Bluetooth Lamp into HomeKit."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lexcao.io/posts/"},{"@type":"ListItem","position":2,"name":"Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit","item":"https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit","name":"Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit","description":"Introduction This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple\u0026rsquo;s HomeKit ecosystem. The following mobile apps are supported:\nLampSmart Pro Lamp Smart Pro - Soft Lighting / Smart Lighting FanLamp Pro Zhi Jia Zhi Guang ApplianceSmart Vmax smart Zhi Mei Deng Kong By following this guide, you\u0026rsquo;ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: Journal: Integrate Bluetooth Lamp into HomeKit.\n","keywords":["Bluetooth","HomeKit","Home Assistant","ESPHome","Tutorial"],"articleBody":"Introduction This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple’s HomeKit ecosystem. The following mobile apps are supported:\nLampSmart Pro Lamp Smart Pro - Soft Lighting / Smart Lighting FanLamp Pro Zhi Jia Zhi Guang ApplianceSmart Vmax smart Zhi Mei Deng Kong By following this guide, you’ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: Journal: Integrate Bluetooth Lamp into HomeKit.\nThis implementation is based on the open-source project ha-ble-adv.\nPrerequisites Before proceeding, ensure you have:\nBasic understanding of Home Assistant concepts and operations Terminal command-line proficiency Docker installation GitHub account Required Hardware: ESP32 development board Primary function: Bluetooth communication Implementation Overview This tutorial uses MacOS as the reference environment. Linux and Windows users may need to adjust certain steps accordingly. Each section includes:\nImplementation steps Verification procedures Troubleshooting guidelines (where applicable) Implementation Details If you’re not interested in the technical details, you can skip to Part 1\nComponent List Home Assistant (HA) Home Assistant Community Store (HACS) ha-ble-adv Home Assistant Bluetooth Low Energy Advertise ESP Home esphome-ble-adv-proxy ESP32 System Architecture Core functionality: ha-ble-adv handles Bluetooth communication for device control HomeKit integration: Achieved through Home Assistant’s HomeKit Bridge Implementation requirements: ha-ble-adv component installation via HACS esphome-ble-adv-proxy deployment on ESP32 through ESP Home System architecture diagram:\nLet’s get started. Based on the implementation above, for tutorial continuity, we’ll begin with the ESP32.\nFirst, create a directory to store all components we’ll use:\n$ mkdir Home-Assistant $ cd Home-Assistant Part 1: ESP Home Installing ESP Home Implementation Steps Install ESP Home using Docker. For alternative installation methods, refer to the official documentation.\nConfiguration Create a Docker Compose configuration: # Home-Assistant/docker-compose.yml services: esphome: container_name: esphome image: ghcr.io/esphome/esphome volumes: - ./esphome/config:/config - /etc/localtime:/etc/localtime:ro restart: always privileged: true network_mode: host Deploy the service: $ docker compose up -d Verification Access the ESP Home dashboard at http://localhost:6052.\nFor installation issues, refer to the official documentation.\nESP32 Device Integration Implementation Steps Configure ESP32 in ESP Home for device management.\nConfiguration Connect ESP32 to MacOS via USB In the ESP Home dashboard: Add new device Set device name (e.g., esp32-ble-adv-proxy) Select ESP32’s serial port Configure Wi-Fi credentials Important: Use 2.4GHz Wi-Fi network Begin installation: Select “Plug into this computer” Wait for installation completion (minimum 2 minutes) Verification Installation completion prompt appears Device status shows as ONLINE in dashboard View device logs through LOGS interface Troubleshooting Installation timeout: Wait minimum 2 minutes Monitor installation progress Device offline: Verify Wi-Fi credentials Confirm 2.4GHz network connection Installing esphome-ble-adv-proxy Implementation Steps Deploy the community component esphome-ble_adv_proxy on the ESP32 device.\nFor detailed instructions, visit esphome-ble_adv_proxy.\nConfiguration In ESP Home dashboard, select the esp32-ble-adv-proxy device Update configuration: (...) esp32: board: esp32dev # Or your specific board model framework: type: esp-idf # Recommended for BLE stability # Enable ESP32 Bluetooth Low Energy Tracker esp32_ble_tracker: scan_parameters: # Active scanning for enhanced device discovery active: true # Enable Home Assistant Bluetooth Proxy bluetooth_proxy: active: true # Configure external component source external_components: - source: github://NicoIIT/esphome-ble_adv_proxy # Initialize ble_adv_proxy component ble_adv_proxy: # Default configuration (...) Save configuration Select wireless installation Wait for installation completion (minimum 2 minutes) Verification Monitor installation progress in real-time Access debug interface at http://esp32-ble-adv-proxy.local Verify data generation in debug interface For installation issues, check the installation logs for error messages.\nNow that the ESP32 part is ready, let’s return to the main Home Assistant setup.\nPart 2: Home Assistant Installing Home Assistant Implementation Steps Install Home Assistant Core directly on MacOS using Python. Note: This implementation is not compatible with Docker-based Home Assistant installations. See Q\u0026A for details.\nFor alternative installation methods, refer to the official documentation.\nConfiguration Initialize Python virtual environment: $ python3 -m venv . $ source ./bin/activate Install Home Assistant Core: $ pip3 install homeassistant==2025.4.4 Create configuration directory: $ mkdir config Launch Home Assistant: $ hass --config config Verification Access Home Assistant dashboard at http://localhost:8123 Complete initial account setup For installation issues, refer to the official documentation.\nESP32 Integration Implementation Steps Add ESP32 device to Home Assistant dashboard.\nConfiguration Home Assistant should automatically discover the ESP32 device. If not, proceed with manual integration:\nNavigate to Settings \u003e Devices \u0026 Services Click ADD INTEGRATION Search for ESP Home Enter device address: esp32-ble-adv-proxy.local Complete integration using ESP Home API Key Verification ESP32 device and Bluetooth services appear in Devices \u0026 Services Device status shows as connected Troubleshooting Integration failure: Verify ESP32 accessibility at http://esp32-ble-adv-proxy.local Check ESP Home service status API Key retrieval: In ESP Home device card, click ··· Select Show API Key For additional help, refer to the official documentation.\nHome Assistant Community Store Installation Implementation Steps Deploy HACS integration in Home Assistant.\nFor detailed instructions, visit the official documentation.\nConfiguration Ensure wget is installed Execute installation command: $ wget -O - https://get.hacs.xyz | bash - Restart Home Assistant Navigate to Settings \u003e Devices \u0026 Services Click ADD INTEGRATION Search for HACS Complete GitHub authentication Finalize installation Verification HACS appears in Home Assistant navigation menu For configuration issues, refer to the official documentation.\nInstalling ha-ble-adv Implementation Steps Deploy the custom repository ha-ble-adv through HACS.\nConfiguration Access Home Assistant HACS interface Click ··· in top-right corner Select Custom repositories Add repository: https://github.com/NicoIIT/ha-ble-adv Verification Installation completes successfully BLE ADV appears in Settings \u003e Devices \u0026 Services integration list For repository installation issues, refer to the official documentation.\nBluetooth Light Integration Implementation Steps Configure ha-ble-adv for Bluetooth light control.\nConfiguration Navigate to Settings \u003e Devices \u0026 Services Click ADD INTEGRATION Search for BLE ADV Select “Duplicate Paired Phone App Config” Verification Integration completes successfully Bluetooth light appears in Home Assistant Overview Direct control available through Home Assistant interface Troubleshooting Installation guide inaccessible: Manually load ble-adv component Edit config/configurations.yml: # config/configurations.yml ... ble_adv: Restart Home Assistant Retry integration Bluetooth communication issues: Verify ESP32 online status in ESP Home Check debug interface at http://esp32-ble-adv-proxy.local Additional issues: Refer to FAQ HomeKit Bridge Integration Implementation Steps Configure HomeKit Bridge for iPhone Home app integration.\nFor detailed instructions, refer to the official documentation.\nConfiguration Navigate to Settings \u003e Devices \u0026 Services Click ADD INTEGRATION Search for Apple Add HomeKit Bridge Open iPhone Home app Scan QR code from Home Assistant notification Select “Add Anyway” for uncertified accessory Verification Bluetooth light appears in iPhone Home app Control available through Home app and Siri Troubleshooting Device Not Found After Scanning Primary cause: Network configuration issues. Follow these verification steps:\nVerify mDNS functionality: $ dns-sd -B _hap._tcp local Expected output:\nTimestamp A/R Flags if Domain Service Type Instance Name 0:29:39.244 Add 3 10 local. _hap._tcp. HASS Bridge xxxxxx Enable debug logging: logger: default: warning logs: homeassistant.components.homekit: debug pyhap: debug Restart Home Assistant Retry device addition Check error logs for specific issues Additional Network Verification Install “Discovery - DNS-SD Browser” on iPhone Verify local domain: Check _hap._tcp existence Verify HASS Bridge xxxxxx presence Network Configuration Verify network connectivity: Ensure iPhone and MacOS on same network Check firewall settings: HomeKit Bridge port: 21063 mDNS port: 5353 Verify router configuration: Ensure mDNS not disabled Additional Resources Official HomeKit Troubleshooting HomeKit Bridge Docker Guide Docker HomeKit Integration HomeKit Troubleshooting Guide Docker HomeKit Issue MacOS Docker Configuration Summary This tutorial demonstrates the integration of Bluetooth-enabled lights into Apple’s HomeKit ecosystem using open-source tools. The implementation utilizes an ESP32 development board with esphome-ble-adv-proxy for Bluetooth communication. Home Assistant Core on MacOS manages device integration, while the ha-ble-adv custom component enables Bluetooth light control. The HomeKit Bridge facilitates iPhone Home app integration, enabling control through both the Home App and Siri. The guide includes comprehensive troubleshooting procedures, particularly for mDNS network issues in HomeKit integration.\nQ\u0026A Q1: Docker Compatibility Question: Can Home Assistant run in Docker?\nAnswer: Yes, but with limitations. Reference implementations:\nMacOS Docker Guide Docker HomeKit Bridge Guide Known Issues:\nHomeKit connection failures mDNS network detection issues Incompatibility with host Bluetooth functionality Q2: MacOS Bluetooth Integration Question: Can MacOS built-in Bluetooth be used instead of ESP32?\nAnswer: Currently not supported for two reasons:\nDocker limitations prevent host Bluetooth access MacOS Bluetooth implementation doesn’t meet ble-adv requirements Q3: Home Assistant Service Management Background Service Script:\n#!/bin/bash source bin/activate nohup hass --config config \u003e hass.log 2\u003e\u00261 \u0026 echo \"Home Assistant started on: http://localhost:8123\" Service Management:\nAdd execution permission: $ chmod +x run.sh Start service: $ ./run.sh Monitor logs: $ tail -f hass.log Stop service: $ pkill -f \"hass --config config\" References Home Assistant Home Assistant Community Store ha-ble-adv ESP Home esphome-ble-adv-proxy ESP Home Installation Guide ESP Home Installation Troubleshooting ESP Home Home Assistant Integration Home Assistant MacOS Installation Home Assistant HomeKit Integration Home Assistant HomeKit Troubleshooting HACS Documentation HACS Configuration Guide HACS Custom Repositories ha-ble-adv FAQ HomeKit Bridge Docker Guide Docker HomeKit Integration HomeKit Troubleshooting Guide Docker HomeKit Issue MacOS Docker Configuration Service URLs:\nESP Home Dashboard: http://localhost:6052 Home Assistant Dashboard: http://localhost:8123 ","wordCount":"1463","inLanguage":"en","image":"https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format\u0026fit=crop\u0026w=720\u0026q=80","datePublished":"2025-04-27T00:00:00Z","dateModified":"2025-04-27T00:00:00Z","author":{"@type":"Person","name":"Lex Cao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"},"publisher":{"@type":"Organization","name":"The Coding Notes","logo":{"@type":"ImageObject","url":"https://lexcao.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lexcao.io/ accesskey=h title="The Coding Notes (Alt + H)">The Coding Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://lexcao.io/zh/ title=中文 aria-label=中文>中文</a></li></ul></div></div><ul id=menu><li><a href=https://lexcao.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://lexcao.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://lexcao.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://lexcao.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://lexcao.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lexcao.io/>Home</a>&nbsp;»&nbsp;<a href=https://lexcao.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Tutorial: Make Your Non-Smart Bluetooth Light Work with HomeKit</h1><div class=post-meta><span title='2025-04-27 00:00:00 +0000 UTC'>April 27, 2025</span>&nbsp;·&nbsp;7 mins&nbsp;·&nbsp;Lex Cao&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/>中文</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a><ul><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a></li><li><a href=#implementation-overview aria-label="Implementation Overview">Implementation Overview</a></li></ul></li><li><a href=#implementation-details aria-label="Implementation Details">Implementation Details</a><ul><li><a href=#component-list aria-label="Component List">Component List</a></li><li><a href=#system-architecture aria-label="System Architecture">System Architecture</a></li></ul></li><li><a href=#part-1-esp-home aria-label="Part 1: ESP Home ">Part 1: ESP Home</a><ul><li><a href=#installing-esp-home aria-label="Installing ESP Home">Installing ESP Home</a><ul><li><a href=#implementation-steps aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration aria-label=Configuration>Configuration</a></li><li><a href=#verification aria-label=Verification>Verification</a></li></ul></li><li><a href=#esp32-device-integration aria-label="ESP32 Device Integration">ESP32 Device Integration</a><ul><li><a href=#implementation-steps-1 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-1 aria-label=Configuration>Configuration</a></li><li><a href=#verification-1 aria-label=Verification>Verification</a></li><li><a href=#troubleshooting aria-label=Troubleshooting>Troubleshooting</a></li></ul></li><li><a href=#installing-esphome-ble-adv-proxy aria-label="Installing esphome-ble-adv-proxy">Installing esphome-ble-adv-proxy</a><ul><li><a href=#implementation-steps-2 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-2 aria-label=Configuration>Configuration</a></li><li><a href=#verification-2 aria-label=Verification>Verification</a></li></ul></li></ul></li><li><a href=#part-2-home-assistant aria-label="Part 2: Home Assistant">Part 2: Home Assistant</a><ul><li><a href=#installing-home-assistant aria-label="Installing Home Assistant">Installing Home Assistant</a><ul><li><a href=#implementation-steps-3 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-3 aria-label=Configuration>Configuration</a></li><li><a href=#verification-3 aria-label=Verification>Verification</a></li></ul></li><li><a href=#esp32-integration aria-label="ESP32 Integration">ESP32 Integration</a><ul><li><a href=#implementation-steps-4 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-4 aria-label=Configuration>Configuration</a></li><li><a href=#verification-4 aria-label=Verification>Verification</a></li><li><a href=#troubleshooting-1 aria-label=Troubleshooting>Troubleshooting</a></li></ul></li><li><a href=#home-assistant-community-store-installation aria-label="Home Assistant Community Store Installation">Home Assistant Community Store Installation</a><ul><li><a href=#implementation-steps-5 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-5 aria-label=Configuration>Configuration</a></li><li><a href=#verification-5 aria-label=Verification>Verification</a></li></ul></li><li><a href=#installing-ha-ble-adv aria-label="Installing ha-ble-adv">Installing ha-ble-adv</a><ul><li><a href=#implementation-steps-6 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-6 aria-label=Configuration>Configuration</a></li><li><a href=#verification-6 aria-label=Verification>Verification</a></li></ul></li><li><a href=#bluetooth-light-integration aria-label="Bluetooth Light Integration">Bluetooth Light Integration</a><ul><li><a href=#implementation-steps-7 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-7 aria-label=Configuration>Configuration</a></li><li><a href=#verification-7 aria-label=Verification>Verification</a></li><li><a href=#troubleshooting-2 aria-label=Troubleshooting>Troubleshooting</a></li></ul></li><li><a href=#homekit-bridge-integration aria-label="HomeKit Bridge Integration">HomeKit Bridge Integration</a><ul><li><a href=#implementation-steps-8 aria-label="Implementation Steps">Implementation Steps</a></li><li><a href=#configuration-8 aria-label=Configuration>Configuration</a></li><li><a href=#verification-8 aria-label=Verification>Verification</a></li><li><a href=#troubleshooting-3 aria-label=Troubleshooting>Troubleshooting</a><ul><li><a href=#device-not-found-after-scanning aria-label="Device Not Found After Scanning">Device Not Found After Scanning</a></li><li><a href=#additional-network-verification aria-label="Additional Network Verification">Additional Network Verification</a></li><li><a href=#network-configuration aria-label="Network Configuration">Network Configuration</a></li><li><a href=#additional-resources aria-label="Additional Resources">Additional Resources</a></li></ul></li></ul></li></ul></li><li><a href=#summary aria-label=Summary>Summary</a></li><li><a href=#qa aria-label="Q&amp;A ">Q&amp;A</a><ul><ul><li><a href=#q1-docker-compatibility aria-label="Q1: Docker Compatibility">Q1: Docker Compatibility</a></li><li><a href=#q2-macos-bluetooth-integration aria-label="Q2: MacOS Bluetooth Integration">Q2: MacOS Bluetooth Integration</a></li><li><a href=#q3-home-assistant-service-management aria-label="Q3: Home Assistant Service Management">Q3: Home Assistant Service Management</a></li></ul></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>This tutorial demonstrates how to integrate Bluetooth-enabled lights into Apple&rsquo;s HomeKit ecosystem. The following mobile apps are supported:</p><ul><li>LampSmart Pro</li><li>Lamp Smart Pro - Soft Lighting / Smart Lighting</li><li>FanLamp Pro</li><li>Zhi Jia</li><li>Zhi Guang</li><li>ApplianceSmart</li><li>Vmax smart</li><li>Zhi Mei Deng Kong</li></ul><p>By following this guide, you&rsquo;ll be able to control your Bluetooth light through the iPhone Home app and Siri voice commands. For a demonstration of the final implementation, refer to my companion post: <a href=/posts/integrate-bluetooth-lamp-into-homekit/>Journal: Integrate Bluetooth Lamp into HomeKit</a>.</p><p>This implementation is based on the open-source project <a href=https://github.com/NicoIIT/ha-ble-adv/>ha-ble-adv</a>.</p><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>Before proceeding, ensure you have:</p><ul><li>Basic understanding of Home Assistant concepts and operations</li><li>Terminal command-line proficiency</li><li>Docker installation</li><li>GitHub account</li><li><strong>Required Hardware: ESP32 development board</strong><ul><li>Primary function: Bluetooth communication</li></ul></li></ul><h2 id=implementation-overview>Implementation Overview<a hidden class=anchor aria-hidden=true href=#implementation-overview>#</a></h2><p>This tutorial uses MacOS as the reference environment. Linux and Windows users may need to adjust certain steps accordingly. Each section includes:</p><ul><li>Implementation steps</li><li>Verification procedures</li><li>Troubleshooting guidelines (where applicable)</li></ul><h1 id=implementation-details>Implementation Details<a hidden class=anchor aria-hidden=true href=#implementation-details>#</a></h1><p>If you&rsquo;re not interested in the technical details, you can skip to <a href=/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/#Step1>Part 1</a></p><h2 id=component-list>Component List<a hidden class=anchor aria-hidden=true href=#component-list>#</a></h2><ul><li><a href=https://www.home-assistant.io/>Home Assistant (HA)</a></li><li><a href=https://hacs.xyz/>Home Assistant Community Store (HACS)</a></li><li><strong><a href=https://github.com/NicoIIT/ha-ble-adv/>ha-ble-adv</a></strong><ul><li>Home Assistant Bluetooth Low Energy Advertise</li></ul></li><li><a href=https://esphome.io/>ESP Home</a></li><li><a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble-adv-proxy</a></li><li>ESP32</li></ul><h2 id=system-architecture>System Architecture<a hidden class=anchor aria-hidden=true href=#system-architecture>#</a></h2><ol><li>Core functionality: <code>ha-ble-adv</code> handles Bluetooth communication for device control</li><li>HomeKit integration: Achieved through Home Assistant&rsquo;s HomeKit Bridge</li><li>Implementation requirements:<ol><li><code>ha-ble-adv</code> component installation via <code>HACS</code></li><li><code>esphome-ble-adv-proxy</code> deployment on ESP32 through ESP Home</li></ol></li></ol><p>System architecture diagram:</p><img src=/images/integrate-bluetooth-lamp-into-homekit-step-by-step/ha-ble-adv-arch02.webp alt=ha-ble-adv-arch02><p>Let&rsquo;s get started. Based on the implementation above, for tutorial continuity, we&rsquo;ll begin with the ESP32.</p><p>First, create a directory to store all components we&rsquo;ll use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir Home-Assistant
</span></span><span style=display:flex><span>$ cd Home-Assistant
</span></span></code></pre></div><h1 id=part-1-esp-home>Part 1: ESP Home <a name=Step1><a hidden class=anchor aria-hidden=true href=#part-1-esp-home>#</a></h1><h2 id=installing-esp-home>Installing ESP Home<a hidden class=anchor aria-hidden=true href=#installing-esp-home>#</a></h2><h3 id=implementation-steps>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps>#</a></h3><p>Install ESP Home using Docker. For alternative installation methods, refer to the <a href=https://esphome.io/guides/getting_started_command_line#bonus-esphome-device-builder>official documentation</a>.</p><h3 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><ol><li>Create a Docker Compose configuration:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Home-Assistant/docker-compose.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/esphome/esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./esphome/config:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privileged</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network_mode</span>: <span style=color:#ae81ff>host</span>
</span></span></code></pre></div><ol start=2><li>Deploy the service:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker compose up -d
</span></span></code></pre></div><h3 id=verification>Verification<a hidden class=anchor aria-hidden=true href=#verification>#</a></h3><p>Access the ESP Home dashboard at <a href=http://localhost:6052>http://localhost:6052</a>.</p><p>For installation issues, refer to the <a href=https://esphome.io/guides/getting_started_command_line#installation>official documentation</a>.</p><h2 id=esp32-device-integration>ESP32 Device Integration<a hidden class=anchor aria-hidden=true href=#esp32-device-integration>#</a></h2><h3 id=implementation-steps-1>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-1>#</a></h3><p>Configure ESP32 in ESP Home for device management.</p><h3 id=configuration-1>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-1>#</a></h3><ol><li>Connect ESP32 to MacOS via USB</li><li>In the ESP Home dashboard:<ul><li>Add new device</li><li>Set device name (e.g., <code>esp32-ble-adv-proxy</code>)</li><li>Select ESP32&rsquo;s serial port</li><li>Configure Wi-Fi credentials<ul><li><strong>Important: Use 2.4GHz Wi-Fi network</strong></li></ul></li></ul></li><li>Begin installation:<ul><li>Select &ldquo;Plug into this computer&rdquo;</li><li>Wait for installation completion (minimum 2 minutes)</li></ul></li></ol><h3 id=verification-1>Verification<a hidden class=anchor aria-hidden=true href=#verification-1>#</a></h3><ul><li>Installation completion prompt appears</li><li>Device status shows as ONLINE in dashboard</li><li>View device logs through LOGS interface</li></ul><h3 id=troubleshooting>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting>#</a></h3><ul><li>Installation timeout:<ul><li>Wait minimum 2 minutes</li><li>Monitor installation progress</li></ul></li><li>Device offline:<ul><li>Verify Wi-Fi credentials</li><li>Confirm 2.4GHz network connection</li></ul></li></ul><h2 id=installing-esphome-ble-adv-proxy>Installing <code>esphome-ble-adv-proxy</code><a hidden class=anchor aria-hidden=true href=#installing-esphome-ble-adv-proxy>#</a></h2><h3 id=implementation-steps-2>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-2>#</a></h3><p>Deploy the community component <code>esphome-ble_adv_proxy</code> on the ESP32 device.</p><p>For detailed instructions, visit <a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble_adv_proxy</a>.</p><h3 id=configuration-2>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-2>#</a></h3><ol><li>In ESP Home dashboard, select the <code>esp32-ble-adv-proxy</code> device</li><li>Update configuration:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>(...)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp32dev</span> <span style=color:#75715e># Or your specific board model</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>framework</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>esp-idf</span> <span style=color:#75715e># Recommended for BLE stability</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable ESP32 Bluetooth Low Energy Tracker</span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scan_parameters</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Active scanning for enhanced device discovery</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>active</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable Home Assistant Bluetooth Proxy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>bluetooth_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>active</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Configure external component source</span>
</span></span><span style=display:flex><span><span style=color:#f92672>external_components</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source</span>: <span style=color:#ae81ff>github://NicoIIT/esphome-ble_adv_proxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Initialize ble_adv_proxy component</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ble_adv_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Default configuration</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>(...)</span>
</span></span></code></pre></div><ol start=3><li>Save configuration</li><li>Select wireless installation</li><li>Wait for installation completion (minimum 2 minutes)</li></ol><h3 id=verification-2>Verification<a hidden class=anchor aria-hidden=true href=#verification-2>#</a></h3><ul><li>Monitor installation progress in real-time</li><li>Access debug interface at <code>http://esp32-ble-adv-proxy.local</code></li><li>Verify data generation in debug interface</li></ul><p>For installation issues, check the installation logs for error messages.</p><p>Now that the ESP32 part is ready, let&rsquo;s return to the main Home Assistant setup.</p><h1 id=part-2-home-assistant>Part 2: Home Assistant<a hidden class=anchor aria-hidden=true href=#part-2-home-assistant>#</a></h1><h2 id=installing-home-assistant>Installing Home Assistant<a hidden class=anchor aria-hidden=true href=#installing-home-assistant>#</a></h2><h3 id=implementation-steps-3>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-3>#</a></h3><p>Install Home Assistant Core directly on MacOS using Python. <strong>Note: This implementation is not compatible with Docker-based Home Assistant installations</strong>. See <a href=/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/#QA>Q&amp;A</a> for details.</p><p>For alternative installation methods, refer to the <a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>official documentation</a>.</p><h3 id=configuration-3>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-3>#</a></h3><ol><li>Initialize Python virtual environment:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ python3 -m venv .
</span></span><span style=display:flex><span>$ source ./bin/activate
</span></span></code></pre></div><ol start=2><li>Install Home Assistant Core:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pip3 install homeassistant<span style=color:#f92672>==</span>2025.4.4
</span></span></code></pre></div><ol start=3><li>Create configuration directory:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir config
</span></span></code></pre></div><ol start=4><li>Launch Home Assistant:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ hass --config config
</span></span></code></pre></div><h3 id=verification-3>Verification<a hidden class=anchor aria-hidden=true href=#verification-3>#</a></h3><ul><li>Access Home Assistant dashboard at <a href=http://localhost:8123>http://localhost:8123</a></li><li>Complete initial account setup</li></ul><p>For installation issues, refer to the <a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>official documentation</a>.</p><h2 id=esp32-integration>ESP32 Integration<a hidden class=anchor aria-hidden=true href=#esp32-integration>#</a></h2><h3 id=implementation-steps-4>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-4>#</a></h3><p>Add ESP32 device to Home Assistant dashboard.</p><h3 id=configuration-4>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-4>#</a></h3><p>Home Assistant should automatically discover the ESP32 device. If not, proceed with manual integration:</p><ol><li>Navigate to <code>Settings > Devices & Services</code></li><li>Click ADD INTEGRATION</li><li>Search for ESP Home</li><li>Enter device address: <code>esp32-ble-adv-proxy.local</code></li><li>Complete integration using ESP Home API Key</li></ol><h3 id=verification-4>Verification<a hidden class=anchor aria-hidden=true href=#verification-4>#</a></h3><ul><li>ESP32 device and Bluetooth services appear in <code>Devices & Services</code></li><li>Device status shows as connected</li></ul><h3 id=troubleshooting-1>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting-1>#</a></h3><ul><li>Integration failure:<ul><li>Verify ESP32 accessibility at <a href=http://esp32-ble-adv-proxy.local>http://esp32-ble-adv-proxy.local</a></li><li>Check ESP Home service status</li></ul></li><li>API Key retrieval:<ul><li>In ESP Home device card, click ···</li><li>Select Show API Key</li></ul></li></ul><p>For additional help, refer to the <a href=https://esphome.io/guides/getting_started_hassio>official documentation</a>.</p><h2 id=home-assistant-community-store-installation>Home Assistant Community Store Installation<a hidden class=anchor aria-hidden=true href=#home-assistant-community-store-installation>#</a></h2><h3 id=implementation-steps-5>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-5>#</a></h3><p>Deploy HACS integration in Home Assistant.</p><p>For detailed instructions, visit the <a href=https://hacs.xyz/>official documentation</a>.</p><h3 id=configuration-5>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-5>#</a></h3><ol><li>Ensure <code>wget</code> is installed</li><li>Execute installation command:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget -O - https://get.hacs.xyz | bash -
</span></span></code></pre></div><ol start=3><li>Restart Home Assistant</li><li>Navigate to <code>Settings > Devices & Services</code></li><li>Click ADD INTEGRATION</li><li>Search for HACS</li><li>Complete GitHub authentication</li><li>Finalize installation</li></ol><h3 id=verification-5>Verification<a hidden class=anchor aria-hidden=true href=#verification-5>#</a></h3><ul><li>HACS appears in Home Assistant navigation menu</li></ul><p>For configuration issues, refer to the <a href=https://hacs.xyz/docs/use/configuration/basic/>official documentation</a>.</p><h2 id=installing-ha-ble-adv>Installing <code>ha-ble-adv</code><a hidden class=anchor aria-hidden=true href=#installing-ha-ble-adv>#</a></h2><h3 id=implementation-steps-6>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-6>#</a></h3><p>Deploy the custom repository <code>ha-ble-adv</code> through HACS.</p><h3 id=configuration-6>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-6>#</a></h3><ol><li>Access Home Assistant HACS interface</li><li>Click ··· in top-right corner</li><li>Select <code>Custom repositories</code></li><li>Add repository: <code>https://github.com/NicoIIT/ha-ble-adv</code></li></ol><h3 id=verification-6>Verification<a hidden class=anchor aria-hidden=true href=#verification-6>#</a></h3><ul><li>Installation completes successfully</li><li>BLE ADV appears in <code>Settings > Devices & Services</code> integration list</li></ul><p>For repository installation issues, refer to the <a href=https://hacs.xyz/docs/use/repositories/dashboard/>official documentation</a>.</p><h2 id=bluetooth-light-integration>Bluetooth Light Integration<a hidden class=anchor aria-hidden=true href=#bluetooth-light-integration>#</a></h2><h3 id=implementation-steps-7>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-7>#</a></h3><p>Configure <code>ha-ble-adv</code> for Bluetooth light control.</p><h3 id=configuration-7>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-7>#</a></h3><ol><li>Navigate to <code>Settings > Devices & Services</code></li><li>Click ADD INTEGRATION</li><li>Search for BLE ADV</li><li>Select &ldquo;Duplicate Paired Phone App Config&rdquo;</li></ol><h3 id=verification-7>Verification<a hidden class=anchor aria-hidden=true href=#verification-7>#</a></h3><ul><li>Integration completes successfully</li><li>Bluetooth light appears in Home Assistant Overview</li><li>Direct control available through Home Assistant interface</li></ul><h3 id=troubleshooting-2>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting-2>#</a></h3><ul><li>Installation guide inaccessible:<ul><li>Manually load <code>ble-adv</code> component</li><li>Edit <code>config/configurations.yml</code>:</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># config/configurations.yml</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>ble_adv</span>:
</span></span></code></pre></div><ul><li>Restart Home Assistant</li><li>Retry integration</li><li>Bluetooth communication issues:<ul><li>Verify ESP32 online status in ESP Home</li><li>Check debug interface at <a href=http://esp32-ble-adv-proxy.local>http://esp32-ble-adv-proxy.local</a></li></ul></li><li>Additional issues: Refer to <a href="https://github.com/NicoIIT/ha-ble-adv?tab=readme-ov-file#faq">FAQ</a></li></ul><h2 id=homekit-bridge-integration>HomeKit Bridge Integration<a hidden class=anchor aria-hidden=true href=#homekit-bridge-integration>#</a></h2><h3 id=implementation-steps-8>Implementation Steps<a hidden class=anchor aria-hidden=true href=#implementation-steps-8>#</a></h3><p>Configure HomeKit Bridge for iPhone Home app integration.</p><p>For detailed instructions, refer to the <a href=https://www.home-assistant.io/integrations/homekit>official documentation</a>.</p><h3 id=configuration-8>Configuration<a hidden class=anchor aria-hidden=true href=#configuration-8>#</a></h3><ol><li>Navigate to <code>Settings > Devices & Services</code></li><li>Click ADD INTEGRATION</li><li>Search for Apple</li><li>Add HomeKit Bridge</li><li>Open iPhone Home app</li><li>Scan QR code from Home Assistant notification</li><li>Select &ldquo;Add Anyway&rdquo; for uncertified accessory</li></ol><h3 id=verification-8>Verification<a hidden class=anchor aria-hidden=true href=#verification-8>#</a></h3><ul><li>Bluetooth light appears in iPhone Home app</li><li>Control available through Home app and Siri</li></ul><h3 id=troubleshooting-3>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting-3>#</a></h3><h4 id=device-not-found-after-scanning>Device Not Found After Scanning<a hidden class=anchor aria-hidden=true href=#device-not-found-after-scanning>#</a></h4><p>Primary cause: Network configuration issues. Follow these verification steps:</p><ol><li>Verify mDNS functionality:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ dns-sd -B _hap._tcp local
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Timestamp     A/R    Flags  <span style=color:#66d9ef>if</span> Domain     Service Type     Instance Name
</span></span><span style=display:flex><span> 0:29:39.244  Add        <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>10</span> local.     _hap._tcp.       HASS Bridge xxxxxx
</span></span></code></pre></div><ol start=2><li>Enable debug logging:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>default</span>: <span style=color:#ae81ff>warning</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>logs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>homeassistant.components.homekit</span>: <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pyhap</span>: <span style=color:#ae81ff>debug</span>
</span></span></code></pre></div><ol start=3><li>Restart Home Assistant</li><li>Retry device addition</li><li>Check error logs for specific issues</li></ol><h4 id=additional-network-verification>Additional Network Verification<a hidden class=anchor aria-hidden=true href=#additional-network-verification>#</a></h4><ol><li>Install &ldquo;Discovery - DNS-SD Browser&rdquo; on iPhone</li><li>Verify local domain:<ul><li>Check <code>_hap._tcp</code> existence</li><li>Verify <code>HASS Bridge xxxxxx</code> presence</li></ul></li></ol><h4 id=network-configuration>Network Configuration<a hidden class=anchor aria-hidden=true href=#network-configuration>#</a></h4><ol><li>Verify network connectivity:<ul><li>Ensure iPhone and MacOS on same network</li></ul></li><li>Check firewall settings:<ul><li>HomeKit Bridge port: <code>21063</code></li><li>mDNS port: <code>5353</code></li></ul></li><li>Verify router configuration:<ul><li>Ensure mDNS not disabled</li></ul></li></ol><h4 id=additional-resources>Additional Resources<a hidden class=anchor aria-hidden=true href=#additional-resources>#</a></h4><ul><li><a href=https://www.home-assistant.io/integrations/homekit#troubleshooting>Official HomeKit Troubleshooting</a></li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>HomeKit Bridge Docker Guide</a></li><li><a href=https://community.home-assistant.io/t/using-homekit-component-inside-docker/45409>Docker HomeKit Integration</a></li><li><a href=https://www.reddit.com/r/HomeKit/comments/a3iwwj/troubleshooting_homekit_what_tools_to_use_and_how/>HomeKit Troubleshooting Guide</a></li><li><a href=https://github.com/home-assistant/core/issues/15692>Docker HomeKit Issue</a></li><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>MacOS Docker Configuration</a></li></ul><h1 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h1><p>This tutorial demonstrates the integration of Bluetooth-enabled lights into Apple&rsquo;s HomeKit ecosystem using open-source tools. The implementation utilizes an ESP32 development board with <code>esphome-ble-adv-proxy</code> for Bluetooth communication. Home Assistant Core on MacOS manages device integration, while the <code>ha-ble-adv</code> custom component enables Bluetooth light control. The HomeKit Bridge facilitates iPhone Home app integration, enabling control through both the Home App and Siri. The guide includes comprehensive troubleshooting procedures, particularly for mDNS network issues in HomeKit integration.</p><h1 id=qa>Q&amp;A <a name=QA><a hidden class=anchor aria-hidden=true href=#qa>#</a></h1><h3 id=q1-docker-compatibility>Q1: Docker Compatibility<a hidden class=anchor aria-hidden=true href=#q1-docker-compatibility>#</a></h3><p><strong>Question</strong>: Can Home Assistant run in Docker?</p><p><strong>Answer</strong>: Yes, but with limitations. Reference implementations:</p><ul><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>MacOS Docker Guide</a></li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>Docker HomeKit Bridge Guide</a></li></ul><p><strong>Known Issues</strong>:</p><ul><li>HomeKit connection failures</li><li>mDNS network detection issues</li><li>Incompatibility with host Bluetooth functionality</li></ul><h3 id=q2-macos-bluetooth-integration>Q2: MacOS Bluetooth Integration<a hidden class=anchor aria-hidden=true href=#q2-macos-bluetooth-integration>#</a></h3><p><strong>Question</strong>: Can MacOS built-in Bluetooth be used instead of ESP32?</p><p><strong>Answer</strong>: Currently not supported for two reasons:</p><ol><li>Docker limitations prevent host Bluetooth access</li><li>MacOS Bluetooth implementation doesn&rsquo;t meet <code>ble-adv</code> requirements</li></ol><h3 id=q3-home-assistant-service-management>Q3: Home Assistant Service Management<a hidden class=anchor aria-hidden=true href=#q3-home-assistant-service-management>#</a></h3><p><strong>Background Service Script</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>source bin/activate
</span></span><span style=display:flex><span>nohup hass --config config &gt; hass.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Home Assistant started on: http://localhost:8123&#34;</span>
</span></span></code></pre></div><p><strong>Service Management</strong>:</p><ol><li>Add execution permission:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ chmod +x run.sh
</span></span></code></pre></div><ol start=2><li>Start service:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./run.sh
</span></span></code></pre></div><ol start=3><li>Monitor logs:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tail -f hass.log
</span></span></code></pre></div><ol start=4><li>Stop service:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pkill -f <span style=color:#e6db74>&#34;hass --config config&#34;</span>
</span></span></code></pre></div><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><a href=https://www.home-assistant.io/>Home Assistant</a></li><li><a href=https://hacs.xyz/>Home Assistant Community Store</a></li><li><a href=https://github.com/NicoIIT/ha-ble-adv/>ha-ble-adv</a></li><li><a href=https://esphome.io/>ESP Home</a></li><li><a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble-adv-proxy</a></li><li><a href=https://esphome.io/guides/getting_started_command_line#bonus-esphome-device-builder>ESP Home Installation Guide</a></li><li><a href=https://esphome.io/guides/getting_started_command_line#installation>ESP Home Installation Troubleshooting</a></li><li><a href=https://esphome.io/guides/getting_started_hassio>ESP Home Home Assistant Integration</a></li><li><a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>Home Assistant MacOS Installation</a></li><li><a href=https://www.home-assistant.io/integrations/homekit>Home Assistant HomeKit Integration</a></li><li><a href=https://www.home-assistant.io/integrations/homekit#troubleshooting>Home Assistant HomeKit Troubleshooting</a></li><li><a href=https://hacs.xyz/>HACS Documentation</a></li><li><a href=https://hacs.xyz/docs/use/configuration/basic/>HACS Configuration Guide</a></li><li><a href=https://hacs.xyz/docs/use/repositories/dashboard/>HACS Custom Repositories</a></li><li><a href="https://github.com/NicoIIT/ha-ble-adv?tab=readme-ov-file#faq">ha-ble-adv FAQ</a></li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>HomeKit Bridge Docker Guide</a></li><li><a href=https://community.home-assistant.io/t/using-homekit-component-inside-docker/45409>Docker HomeKit Integration</a></li><li><a href=https://www.reddit.com/r/HomeKit/comments/a3iwwj/troubleshooting_homekit_what_tools_to_use_and_how/>HomeKit Troubleshooting Guide</a></li><li><a href=https://github.com/home-assistant/core/issues/15692>Docker HomeKit Issue</a></li><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>MacOS Docker Configuration</a></li></ul><p><strong>Service URLs</strong>:</p><ul><li>ESP Home Dashboard: <a href=http://localhost:6052>http://localhost:6052</a></li><li>Home Assistant Dashboard: <a href=http://localhost:8123>http://localhost:8123</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://lexcao.io/tags/bluetooth/>Bluetooth</a></li><li><a href=https://lexcao.io/tags/homekit/>HomeKit</a></li><li><a href=https://lexcao.io/tags/home-assistant/>Home Assistant</a></li><li><a href=https://lexcao.io/tags/esphome/>ESPHome</a></li><li><a href=https://lexcao.io/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=next href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit/><span class=title>Next »</span><br><span>Journal: Integrate Bluetooth Lamp into HomeKit</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lexcao.io/>The Coding Notes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>