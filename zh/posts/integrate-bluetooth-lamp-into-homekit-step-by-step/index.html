<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>教程：让你的不智能蓝牙灯接入 HomeKit 智能家居 | The Coding Notes</title>
<meta name=keywords content="蓝牙,HomeKit,Home Assistant,ESPHome,教程"><meta name=description content="引言
如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。
来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。
对于实现后的效果，可以看我另一篇博文：折腾：HomeKit 接入蓝牙吸顶灯
非常感谢 https://github.com/NicoIIT/ha-ble-adv/，本篇教程实际是从零接入该项目。
开始之前
在开始之前，需要一点点基础的计算机知识，确保满足以下条件：

熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉；
能够使用 Terminal 命令行工具；
已安装 Docker 并且可用；
有一个 GitHub 帐号；
关键：一块 ESP32 开发板；

主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格；
（未来会研究如何直接使用系统自带的蓝牙）；



教程方式
本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。
教程的每个步骤会说明：要做什么、怎么做、以及验证结果。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。
如何实现
对于实现不感兴趣的，可以跳转到下一部分
组件列表

Home Assistant (HA)
Home Assistant Community Store (HACS)
ha-ble-adv

缩写是 Home Assistant Bluetooth Low Energy Advertise
翻译为 Home Assistant 蓝牙低功耗广播


ESP Home
esphome-ble-adv-proxy
ESP32

组件交互

核心是使用 ha-ble-adv 通过蓝牙与设备交互，控制开关和亮度
通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制
要让 Home Assistant 成功使用上 ha-ble-adv 需要具备以下条件：

通过 HACS 安装组件 ha-ble-adv
通过 ESP Home 在 ESP32 上面安装 esphome-ble-adv-proxy 以供 ha-ble-adv 发送和接收蓝牙信息



以下是整体架构图"><meta name=author content="Lex Cao"><link rel=canonical href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><link crossorigin=anonymous href=/assets/css/stylesheet.0633f72569546c04f177152a4fc857757796b843f92bb1208cf7114db62b1d94.css integrity="sha256-BjP3JWlUbATxdxUqT8hXdXeWuEP5K7EgjPcRTbYrHZQ=" rel="preload stylesheet" as=style><link rel=icon href=https://lexcao.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lexcao.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lexcao.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lexcao.io/apple-touch-icon.png><link rel=mask-icon href=https://lexcao.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><link rel=alternate hreflang=zh href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DDVMDVDZMH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DDVMDVDZMH")}</script><meta property="og:title" content="教程：让你的不智能蓝牙灯接入 HomeKit 智能家居"><meta property="og:description" content="引言
如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。
来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。
对于实现后的效果，可以看我另一篇博文：折腾：HomeKit 接入蓝牙吸顶灯
非常感谢 https://github.com/NicoIIT/ha-ble-adv/，本篇教程实际是从零接入该项目。
开始之前
在开始之前，需要一点点基础的计算机知识，确保满足以下条件：

熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉；
能够使用 Terminal 命令行工具；
已安装 Docker 并且可用；
有一个 GitHub 帐号；
关键：一块 ESP32 开发板；

主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格；
（未来会研究如何直接使用系统自带的蓝牙）；



教程方式
本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。
教程的每个步骤会说明：要做什么、怎么做、以及验证结果。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。
如何实现
对于实现不感兴趣的，可以跳转到下一部分
组件列表

Home Assistant (HA)
Home Assistant Community Store (HACS)
ha-ble-adv

缩写是 Home Assistant Bluetooth Low Energy Advertise
翻译为 Home Assistant 蓝牙低功耗广播


ESP Home
esphome-ble-adv-proxy
ESP32

组件交互

核心是使用 ha-ble-adv 通过蓝牙与设备交互，控制开关和亮度
通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制
要让 Home Assistant 成功使用上 ha-ble-adv 需要具备以下条件：

通过 HACS 安装组件 ha-ble-adv
通过 ESP Home 在 ESP32 上面安装 esphome-ble-adv-proxy 以供 ha-ble-adv 发送和接收蓝牙信息



以下是整体架构图"><meta property="og:type" content="article"><meta property="og:url" content="https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"><meta property="og:image" content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-27T00:00:00+00:00"><meta property="og:site_name" content="The Coding Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&amp;fit=crop&amp;w=720&amp;q=80"><meta name=twitter:title content="教程：让你的不智能蓝牙灯接入 HomeKit 智能家居"><meta name=twitter:description content="引言
如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：

LampSmart Pro
Lamp Smart Pro - Soft Lighting / Smart Lighting
FanLamp Pro
Zhi Jia
Zhi Guang
ApplianceSmart
Vmax smart
Zhi Mei Deng Kong

那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。
来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。
对于实现后的效果，可以看我另一篇博文：折腾：HomeKit 接入蓝牙吸顶灯
非常感谢 https://github.com/NicoIIT/ha-ble-adv/，本篇教程实际是从零接入该项目。
开始之前
在开始之前，需要一点点基础的计算机知识，确保满足以下条件：

熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉；
能够使用 Terminal 命令行工具；
已安装 Docker 并且可用；
有一个 GitHub 帐号；
关键：一块 ESP32 开发板；

主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格；
（未来会研究如何直接使用系统自带的蓝牙）；



教程方式
本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。
教程的每个步骤会说明：要做什么、怎么做、以及验证结果。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。
如何实现
对于实现不感兴趣的，可以跳转到下一部分
组件列表

Home Assistant (HA)
Home Assistant Community Store (HACS)
ha-ble-adv

缩写是 Home Assistant Bluetooth Low Energy Advertise
翻译为 Home Assistant 蓝牙低功耗广播


ESP Home
esphome-ble-adv-proxy
ESP32

组件交互

核心是使用 ha-ble-adv 通过蓝牙与设备交互，控制开关和亮度
通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制
要让 Home Assistant 成功使用上 ha-ble-adv 需要具备以下条件：

通过 HACS 安装组件 ha-ble-adv
通过 ESP Home 在 ESP32 上面安装 esphome-ble-adv-proxy 以供 ha-ble-adv 发送和接收蓝牙信息



以下是整体架构图"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"博文","item":"https://lexcao.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"教程：让你的不智能蓝牙灯接入 HomeKit 智能家居","item":"https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"教程：让你的不智能蓝牙灯接入 HomeKit 智能家居","name":"教程：让你的不智能蓝牙灯接入 HomeKit 智能家居","description":"引言 如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：\nLampSmart Pro Lamp Smart Pro - Soft Lighting / Smart Lighting FanLamp Pro Zhi Jia Zhi Guang ApplianceSmart Vmax smart Zhi Mei Deng Kong 那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。 来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。 对于实现后的效果，可以看我另一篇博文：折腾：HomeKit 接入蓝牙吸顶灯\n非常感谢 https://github.com/NicoIIT/ha-ble-adv/，本篇教程实际是从零接入该项目。\n开始之前 在开始之前，需要一点点基础的计算机知识，确保满足以下条件：\n熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉； 能够使用 Terminal 命令行工具； 已安装 Docker 并且可用； 有一个 GitHub 帐号； 关键：一块 ESP32 开发板； 主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格； （未来会研究如何直接使用系统自带的蓝牙）； 教程方式 本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。 教程的每个步骤会说明：要做什么、怎么做、以及验证结果。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。\n如何实现 对于实现不感兴趣的，可以跳转到下一部分\n组件列表 Home Assistant (HA) Home Assistant Community Store (HACS) ha-ble-adv 缩写是 Home Assistant Bluetooth Low Energy Advertise 翻译为 Home Assistant 蓝牙低功耗广播 ESP Home esphome-ble-adv-proxy ESP32 组件交互 核心是使用 ha-ble-adv 通过蓝牙与设备交互，控制开关和亮度 通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制 要让 Home Assistant 成功使用上 ha-ble-adv 需要具备以下条件： 通过 HACS 安装组件 ha-ble-adv 通过 ESP Home 在 ESP32 上面安装 esphome-ble-adv-proxy 以供 ha-ble-adv 发送和接收蓝牙信息 以下是整体架构图\n","keywords":["蓝牙","HomeKit","Home Assistant","ESPHome","教程"],"articleBody":"引言 如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：\nLampSmart Pro Lamp Smart Pro - Soft Lighting / Smart Lighting FanLamp Pro Zhi Jia Zhi Guang ApplianceSmart Vmax smart Zhi Mei Deng Kong 那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。 来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。 对于实现后的效果，可以看我另一篇博文：折腾：HomeKit 接入蓝牙吸顶灯\n非常感谢 https://github.com/NicoIIT/ha-ble-adv/，本篇教程实际是从零接入该项目。\n开始之前 在开始之前，需要一点点基础的计算机知识，确保满足以下条件：\n熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉； 能够使用 Terminal 命令行工具； 已安装 Docker 并且可用； 有一个 GitHub 帐号； 关键：一块 ESP32 开发板； 主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格； （未来会研究如何直接使用系统自带的蓝牙）； 教程方式 本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。 教程的每个步骤会说明：要做什么、怎么做、以及验证结果。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。\n如何实现 对于实现不感兴趣的，可以跳转到下一部分\n组件列表 Home Assistant (HA) Home Assistant Community Store (HACS) ha-ble-adv 缩写是 Home Assistant Bluetooth Low Energy Advertise 翻译为 Home Assistant 蓝牙低功耗广播 ESP Home esphome-ble-adv-proxy ESP32 组件交互 核心是使用 ha-ble-adv 通过蓝牙与设备交互，控制开关和亮度 通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制 要让 Home Assistant 成功使用上 ha-ble-adv 需要具备以下条件： 通过 HACS 安装组件 ha-ble-adv 通过 ESP Home 在 ESP32 上面安装 esphome-ble-adv-proxy 以供 ha-ble-adv 发送和接收蓝牙信息 以下是整体架构图\n话不多说，让我们开始吧。基于上面的实现，为了教程的连贯性，让我们从 ESP32 开始。\n首先创建一个目录存放本次用到的所有组件。\n$ mkdir Home-Assistant $ cd Home-Assistant 第一部分： ESP Home 安装 ESP Home 要做什么 使用 Docker 安装 ESP Home。 当然，可以访问 官方文档 获取更多安装方式。\n怎么做 使用以下 Docker compose 文件 # Home-Assistant/docker-compose.yml services: esphome: container_name: esphome image: ghcr.io/esphome/esphome volumes: - ./esphome/config:/config - /etc/localtime:/etc/localtime:ro restart: always privileged: true network_mode: host 启动运行 $ docker compose up -d 结果验证 在浏览器访问 http://localhost:6052 能够进入 ESP Home 后台。\n遇到问题请参考 官方文档。\n连接 ESP32 要做什么 添加 ESP32 到 ESP Home 进行管理，用于后续安装组件。\n怎么做 将你的 ESP32 设备通过有线连接到 MacOS 在 ESP Home 后台添加设备，设置一个名字，比如 esp32-ble-adv-proxy 选择 ESP32 连接的串口 输入 Wi-Fi 信息（SSID \u0026 Password） 重要：确保连接 2.4G Wi-Fi 开始安装，选择 Plug into this computer 等待 2 分钟以上，安装完毕 结果验证 安装完成后会有提示 关闭提示后可以在后台看到刚才添加的设备是在线状态（ONLINE） 点击 LOGS 可以查看到相关日志 遇到问题 无法安装？等待大于 2 分钟以上，检查安装过程中页面上面文案是否有变化 安装后设备不在线？ 检查 Wi-Fi 信息是否正确 检查是否连接的是 2.4G Wi-Fi 安装 esphome-ble-adv-proxy 要做什么 在 ESP Home 后台为刚连接的 ESP32 设备安装社区组件 esphome-ble_adv_proxy。\n当然，可以访问 esphome-ble_adv_proxy 获取详细安装说明。\n怎么做 在 ESP Home 后台对设备 esp32-ble-adv-proxy 点击 Edit 编辑如下信息 (...) esp32: board: esp32dev # Or your specific board model framework: type: esp-idf # Recommended for BLE stability # Enable ESP32 Bluetooth Low Energy Tracker esp32_ble_tracker: scan_parameters: # Active scanning can discover more devices but uses more power active: true # Enable standard Home Assistant Bluetooth Proxy bluetooth_proxy: active: true # Define the external component source for ble_adv_proxy external_components: - source: github://NicoIIT/esphome-ble_adv_proxy # Enable the ble_adv_proxy component ble_adv_proxy: # No specific configuration needed here unless specified by component docs (...) 点击保存（Save），点击安装（Install），选择无线安装（Wireless） 等待 2 分钟以上，安装完毕 结果验证 选择无线安装以后，可以实时查看安装进度 安装完成后，点击新出现的 VISIT 按钮，会跳转到调试页面，观察页面是否有数据产生 注意：当前页面地址 http://esp32-ble-adv-proxy.local 遇到问题？可以根据安装日志提示寻找相关解决方案。\n至此，ESP32 部分准备完成，让我们回到主线 Home Assistant。\n第二部分： Home Assistant 安装 Home Assistant 要做什么 通过 python 直接在 MacOS 主机上面安装 Home Assistant Core。 注意：本教程对于在 Docker 内运行的 Home Assistant 无法成功，详见下面 Q\u0026A\n当然，可以访问 官方文档 获取更多安装说明。\n怎么做 初始化 python 环境 $ python3 -m venv . $ source ./bin/activate 安装 homeassistant Core $ pip3 install homeassistant==2025.4.4 创建一个配置目录 $ mkdir config 启动 hass --config config 结果验证 在浏览器访问 http://localhost:8123 能够进入 Home Assistant 后台 创建帐号，完成首次登录流程 遇到问题请参考 官方文档。\n接入 ESP32 要做什么 在 Home Assistant 后台添加上面 ESP32 集成。\n怎么做 如果之前的步骤一切顺利的话，在 Home Assistant 完成安装后，会自发现 ESP32 设备，点击添加即可。 如果没有自发现，我们仍然可以手动添加：\n在 Settings \u003e Devices \u0026 Services 点击 ADD INTEGRATION 搜索 ESP Home 进行添加 输入上面的地址 esp32-ble-adv-proxy.local 点击添加 回到 ESP Home 复制 esp32-ble-adv-proxy API Key 完成集成 结果验证 在 Home Assistant Devices \u0026 Services 页面显示添加成功的 ESP32 设备和蓝牙 遇到问题 手动添加失败？ 检查 http://esp32-ble-adv-proxy.local 是否可以访问 检查 ESP Home 是否运行 找不到 API Key 在 ESP Home 设备卡片，点击 ··· 按钮，点击 Show API Key 更多帮助可以查看 官方文档 安装 Home Assistant Community Store 要做什么 在 Home Assistant 后台安装 HACS 集成 当然，可以访问 官方文档 获取更多安装说明。\n怎么做 确保 wget 是可用的 在命令行执行安装命令 $ wget -O - https://get.hacs.xyz | bash - 重启 Home Assistant 在 Settings \u003e Devices \u0026 Services 点击 ADD INTEGRATION 搜索 HACS 进行添加 根据指引完成 GitHub 帐号授权 安装完成 结果验证 在 Home Assistant 后台导航菜单可以看到 HACS 遇到问题？请参考 官方文档 完成配置\n安装 ha-ble-adv 要做什么 通过 HACS 安装自定义仓库 ha-ble-adv\n怎么做 进入 Home Assistant，进入 HACS 点击 ··· 右上角 \u003e Custom respositories 根据指引安装 https://github.com/NicoIIT/ha-ble-adv 结果验证 安装成功 在 Settings \u003e Devices \u0026 Services 点击 ADD INTEGRATION 能够搜索到 BLE ADV 遇到问题？请参考 官方文档 安装自定义仓库指引\n添加 蓝牙灯 设备 要做什么 添加 ha-ble-adv 蓝牙灯设备集成\n怎么做 在 Settings \u003e Devices \u0026 Services 点击 ADD INTEGRATION 搜索 BLE ADV 进行添加 根据指引进行添加，推荐选择 Duplicate Paired Phone App Config 结果验证 添加成功 在 Overview 可以通过 Home Assistant 直接控制蓝牙灯 遇到问题 无法打开安装指引？ 需要手动加载 ble-adv 组件 打开 config/configurations.yml 进行编辑，在最后一行添加 # config/configurations.yml ... ble_adv: 重启 Home Assistant， 重新添加 无法接收到蓝牙信息？ 请确保前面 ESP32 在 EPS Home 是在线状态 可以通过访问 http://esp32-ble-adv-proxy.local 来检查 其他问题？可以参考 FAQ 来排查 接入 HomeKit Bridge 截止上一步，我们实现了通过 Home Assistant 控制蓝牙来控制蓝牙灯。 接下来，我们进入最后一步，接入 HomeKit Bridge 来接入家庭应用。\n要做什么 通过 HomeKit Bridge 接入家庭应用。 当然，可以访问 官方文档 获取更多安装说明。\n怎么做 在 Settings \u003e Devices \u0026 Services 点击 ADD INTEGRATION 搜索 Apple 点击后添加 HomeKit Bridge 这里无需额外配置，直接点击下一步即可 完成添加后，打开左下角 Notification iPhone 打开家庭应用，扫描二维码添加设备 扫描成功后会弹窗 未认证配件，点击 仍要添加 完成配置 结果验证 蓝牙灯控制出现在 iPhone 家庭应用 可以通过 家庭应用 / Siri 控制 灯 开关和灯光 遇到问题 在最后一步遇到的问题会多一些，以下是我遇到的问题，排查思路和解决方案。\n扫码后无法添加，提示 找不到设备？\n主要是网络问题引起，请依次检查：\n排查一：排查本机 mDNS 是否正常工作：\n【操作步骤】\n在命令行执行以下命令 $ dns-sd -B _hap._tcp local 【结果验证】\n如果返回以下信息，说明本机 mDNS 没问题，注意右边 Instance Name 含有 HASS Bridge\nTimestamp A/R Flags if Domain Service Type Instance Name 0:29:39.244 Add 3 10 local. _hap._tcp. HASS Bridge xxxxxx 【解决方式一】\n打开 Debug 日志，打开 config/configurations.yml 进行编辑，在最后一行添加 logger: default: warning logs: homeassistant.components.homekit: debug pyhap: debug 重启 Home Assistant 重新扫码添加设备到家庭应用 观察是否有异常日志 根据日志报错搜索相关解决方案 【解决方式二】\n若使用 Docker 启动 Home Assistant，改为直接安装 Home Assistant 到本机。 排查二：排查手机 mDNS 是否正常工作：\n【操作步骤】\n在 Apple Store 搜索 Discovery - DNS-SD Browser 安装后打开，检查 local 域 【结果验证】\n检查是否存在 _hap._tcp 点击查看，是否存在 HASS Bridge xxxxxx 如果存在，说明手机 mDNS 通信在同一个网络下没问题 【解决方式一】\n检查手机和运行 Home Assistant 的 MacOS 是否在同一个网络下 【解决方式二】\n检查 MacOS 防火墙配置，是否有禁止端口： HomeKit Bridge 21063 mDNS 5353 【解决方式三】\n检查路由器配置，是否禁用 mDNS 其他问题？\n以下是我在排查问题中找到的一些有用的文章，希望能对你有启发：\nOffcial: HomeKit Troubleshooting Community: HomeKit Bridge on Home Assistant in Docker Community: Use HomeKit Component inside Docker Reddit: Troubleshooting HomeKit What Tools to Use and How GitHub issue: Homekit not working with docker GitHub gist: Home Assistant Docker on MacOS Enjoy！ 太好了，大功告成！开始享用家庭应用控制蓝牙灯吧。\n总结 本教程详细介绍了如何将特定的蓝牙灯（如 LampSmart Pro 控制的灯）通过一系列开源工具接入 Apple HomeKit 智能家居系统。我们从准备 ESP32 开发板开始，利用 ESPHome 安装了 esphome-ble-adv-proxy 以实现蓝牙通信代理。接着，我们在 MacOS 上安装了 Home Assistant Core，并集成了 ESP32 设备。通过 HACS，我们安装了关键的 ha-ble-adv 自定义组件，用于发现和控制蓝牙灯。最后，利用 Home Assistant 内置的 HomeKit Bridge 功能，成功将蓝牙灯设备桥接至 iPhone 的家庭应用，实现了通过家庭 App 和 Siri 进行控制。教程中也涵盖了各个步骤可能遇到的问题及其排查方法，特别是 HomeKit 连接时常见的 mDNS 网络问题。遵循本教程，你可以将原本“不智能”的蓝牙设备融入现代智能家居生态。\n答疑 Q1 是否可以使用 Docker 运行 Home Assistant 可以，但我没有成功，可以参考\nGitHub gist: Home Assistant Docker on MacOS。 Community: HomeKit Bridge on Home Assistant in Docker 使用 Docker 会有什么问题？\n我遇到的问题是 HomeKit 死活连不上，排查后发现是主机的 mDNS 网络无法探查到 Docker 内部 HomeKit Bridge 网络。就算使用 network_mode=host 也不行，我就放弃折腾 Docker，改为安装到本机。 Q2 是否可以不用 ESP32， 使用 MacOS 自带的蓝牙功能 目前不行，有 2 个原因：\n使用 Docker 运行，无法在 Docker 内使用主机的蓝牙功能，最简单的方式是使用 ESP32 代理一下 目前 MacOS 自带的蓝牙功能无法满足 ble-adv 功能，可以参考 作者回复 Q3 本机运行 Home Assistant 脚本 后台运行脚本，创建一个文件 run.sh\n#!/bin/bash source bin/activate nohup hass --config config \u003e hass.log 2\u003e\u00261 \u0026 echo \"Home Assistant started on: http://localhost:8123\" 添加执行权限\n$ chmod +x run.sh 启动 Home Assistant\n$ ./run.sh 查看日志\ntail -f hass.log 停止 Home Assistant\n$ pkill -f \"hass --config config\" 引用 Home Assistant (HA) Home Assistant Community Store (HACS) ha-ble-adv ESP Home esphome-ble-adv-proxy ESP Home 官方文档 - 安装 ESP Home 官方文档 - 安装问题 ESP Home 官方文档 - Home Assistant 集成 Home Assistant 官方文档 - MacOS 安装 Home Assistant 官方文档 - HomeKit 集成 Home Assistant 官方文档 - HomeKit Troubleshooting HACS 官方文档 - 首页 HACS 官方文档 - 配置 HACS 官方文档 - 自定义仓库 ha-ble-adv FAQ Community: HomeKit Bridge on Home Assistant in Docker Community: Use HomeKit Component inside Docker Reddit: Troubleshooting HomeKit What Tools to Use and How GitHub issue: Homekit not working with docker GitHub gist: Home Assistant Docker on MacOS ESP Home 后台 http://localhost:6052 Home Assistant 后台 http://localhost:8123 ","wordCount":"1126","inLanguage":"zh","image":"https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format\u0026fit=crop\u0026w=720\u0026q=80","datePublished":"2025-04-27T00:00:00Z","dateModified":"2025-04-27T00:00:00Z","author":{"@type":"Person","name":"Lex Cao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/"},"publisher":{"@type":"Organization","name":"The Coding Notes","logo":{"@type":"ImageObject","url":"https://lexcao.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lexcao.io/zh/ accesskey=h title="代码笔记 (Alt + H)">代码笔记</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://lexcao.io/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://lexcao.io/zh/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://lexcao.io/zh/archives/ title=归档><span>归档</span></a></li><li><a href=https://lexcao.io/zh/tags/ title=标签><span>标签</span></a></li><li><a href=https://lexcao.io/zh/projects/ title=项目><span>项目</span></a></li><li><a href=https://lexcao.io/zh/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lexcao.io/zh/>主页</a>&nbsp;»&nbsp;<a href=https://lexcao.io/zh/posts/>博文</a></div><h1 class="post-title entry-hint-parent">教程：让你的不智能蓝牙灯接入 HomeKit 智能家居</h1><div class=post-meta><span title='2025-04-27 00:00:00 +0000 UTC'>四月 27, 2025</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;Lex Cao&nbsp;|&nbsp;翻译:<ul class=i18n_list><li><a href=https://lexcao.io/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/>English</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%bc%95%e8%a8%80 aria-label=引言>引言</a><ul><li><a href=#%e5%bc%80%e5%a7%8b%e4%b9%8b%e5%89%8d aria-label=开始之前>开始之前</a></li><li><a href=#%e6%95%99%e7%a8%8b%e6%96%b9%e5%bc%8f aria-label=教程方式>教程方式</a></li></ul></li><li><a href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0 aria-label=如何实现>如何实现</a><ul><li><a href=#%e7%bb%84%e4%bb%b6%e5%88%97%e8%a1%a8 aria-label=组件列表>组件列表</a></li><li><a href=#%e7%bb%84%e4%bb%b6%e4%ba%a4%e4%ba%92 aria-label=组件交互>组件交互</a></li></ul></li><li><a href=#%e7%ac%ac%e4%b8%80%e9%83%a8%e5%88%86-esp-home aria-label="第一部分： ESP Home ">第一部分： ESP Home</a><ul><li><a href=#%e5%ae%89%e8%a3%85-esp-home aria-label="安装 ESP Home">安装 ESP Home</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81 aria-label=结果验证>结果验证</a></li></ul></li><li><a href=#%e8%bf%9e%e6%8e%a5-esp32 aria-label="连接 ESP32">连接 ESP32</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-1 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-1 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-1 aria-label=结果验证>结果验证</a></li><li><a href=#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98 aria-label=遇到问题>遇到问题</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85-esphome-ble-adv-proxy aria-label="安装 esphome-ble-adv-proxy">安装 esphome-ble-adv-proxy</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-2 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-2 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-2 aria-label=结果验证>结果验证</a></li></ul></li></ul></li><li><a href=#%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86-home-assistant aria-label="第二部分： Home Assistant">第二部分： Home Assistant</a><ul><li><a href=#%e5%ae%89%e8%a3%85-home-assistant aria-label="安装 Home Assistant">安装 Home Assistant</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-3 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-3 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-3 aria-label=结果验证>结果验证</a></li></ul></li><li><a href=#%e6%8e%a5%e5%85%a5-esp32 aria-label="接入 ESP32">接入 ESP32</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-4 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-4 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-4 aria-label=结果验证>结果验证</a></li><li><a href=#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98-1 aria-label=遇到问题>遇到问题</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85-home-assistant-community-store aria-label="安装 Home Assistant Community Store">安装 Home Assistant Community Store</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-5 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-5 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-5 aria-label=结果验证>结果验证</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85-ha-ble-adv aria-label="安装 ha-ble-adv">安装 ha-ble-adv</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-6 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-6 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-6 aria-label=结果验证>结果验证</a></li></ul></li><li><a href=#%e6%b7%bb%e5%8a%a0-%e8%93%9d%e7%89%99%e7%81%af-%e8%ae%be%e5%a4%87 aria-label="添加 蓝牙灯 设备">添加 蓝牙灯 设备</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-7 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-7 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-7 aria-label=结果验证>结果验证</a></li><li><a href=#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98-2 aria-label=遇到问题>遇到问题</a></li></ul></li><li><a href=#%e6%8e%a5%e5%85%a5-homekit-bridge aria-label="接入 HomeKit Bridge">接入 HomeKit Bridge</a><ul><li><a href=#%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88-8 aria-label=要做什么>要做什么</a></li><li><a href=#%e6%80%8e%e4%b9%88%e5%81%9a-8 aria-label=怎么做>怎么做</a></li><li><a href=#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81-8 aria-label=结果验证>结果验证</a></li><li><a href=#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98-3 aria-label=遇到问题>遇到问题</a></li></ul></li><li><a href=#enjoy aria-label=Enjoy！>Enjoy！</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li><li><a href=#%e7%ad%94%e7%96%91 aria-label="答疑 ">答疑</a><ul><ul><li><a href=#q1-%e6%98%af%e5%90%a6%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8-docker-%e8%bf%90%e8%a1%8c-home-assistant aria-label="Q1 是否可以使用 Docker 运行 Home Assistant">Q1 是否可以使用 Docker 运行 Home Assistant</a></li><li><a href=#q2-%e6%98%af%e5%90%a6%e5%8f%af%e4%bb%a5%e4%b8%8d%e7%94%a8-esp32-%e4%bd%bf%e7%94%a8-macos-%e8%87%aa%e5%b8%a6%e7%9a%84%e8%93%9d%e7%89%99%e5%8a%9f%e8%83%bd aria-label="Q2 是否可以不用 ESP32， 使用 MacOS 自带的蓝牙功能">Q2 是否可以不用 ESP32， 使用 MacOS 自带的蓝牙功能</a></li><li><a href=#q3-%e6%9c%ac%e6%9c%ba%e8%bf%90%e8%a1%8c-home-assistant-%e8%84%9a%e6%9c%ac aria-label="Q3 本机运行 Home Assistant 脚本">Q3 本机运行 Home Assistant 脚本</a></li></ul></ul></li><li><a href=#%e5%bc%95%e7%94%a8 aria-label=引用>引用</a></li></ul></div></details></div><div class=post-content><h1 id=引言>引言<a hidden class=anchor aria-hidden=true href=#引言>#</a></h1><p>如果你有一个蓝牙灯，并且它能够被以下几个手机应用控制：</p><ul><li>LampSmart Pro</li><li>Lamp Smart Pro - Soft Lighting / Smart Lighting</li><li>FanLamp Pro</li><li>Zhi Jia</li><li>Zhi Guang</li><li>ApplianceSmart</li><li>Vmax smart</li><li>Zhi Mei Deng Kong</li></ul><p>那么恭喜你，你可以跟随本篇教程，一步一步将它接入 HomeKit 智能家居。
来实现通过 iPhone 家庭应用控制以及 Siri 语音控制。
对于实现后的效果，可以看我另一篇博文：<a href=/zh/posts/integrate-bluetooth-lamp-into-homekit/>折腾：HomeKit 接入蓝牙吸顶灯</a></p><p>非常感谢 <a href=https://github.com/NicoIIT/ha-ble-adv/>https://github.com/NicoIIT/ha-ble-adv/</a>，本篇教程实际是从零接入该项目。</p><h2 id=开始之前>开始之前<a hidden class=anchor aria-hidden=true href=#开始之前>#</a></h2><p>在开始之前，需要一点点基础的计算机知识，确保满足以下条件：</p><ul><li>熟悉 Home Assistant 概念和一些基本操作，可以阅读官方文档快速熟悉；</li><li>能够使用 Terminal 命令行工具；</li><li>已安装 Docker 并且可用；</li><li>有一个 GitHub 帐号；</li><li><strong>关键：一块 ESP32 开发板</strong>；<ul><li>主要用于蓝牙通信，如果没有的话，可以网购一块，25 元左右的价格；</li><li>（未来会研究如何直接使用系统自带的蓝牙）；</li></ul></li></ul><h2 id=教程方式>教程方式<a hidden class=anchor aria-hidden=true href=#教程方式>#</a></h2><p>本教程以 MacOS 为例。如果你使用 Linux 或 Windows，部分操作可能需要稍作调整。
教程的每个步骤会说明：<strong>要做什么</strong>、<strong>怎么做</strong>、以及<strong>验证结果</strong>。请确保完成验证后再进行下一步。遇到问题时，可以参考自查攻略（部分步骤有）或联系我。</p><h1 id=如何实现>如何实现<a hidden class=anchor aria-hidden=true href=#如何实现>#</a></h1><p>对于实现不感兴趣的，可以跳转到<a href=/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/#Step1>下一部分</a></p><h2 id=组件列表>组件列表<a hidden class=anchor aria-hidden=true href=#组件列表>#</a></h2><ul><li><a href=https://www.home-assistant.io/>Home Assistant (HA)</a></li><li><a href=https://hacs.xyz/>Home Assistant Community Store (HACS)</a></li><li><strong><a href=https://github.com/NicoIIT/ha-ble-adv/>ha-ble-adv</a></strong><ul><li>缩写是 Home Assistant Bluetooth Low Energy Advertise</li><li>翻译为 Home Assistant 蓝牙低功耗广播</li></ul></li><li><a href=https://esphome.io/>ESP Home</a></li><li><a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble-adv-proxy</a></li><li>ESP32</li></ul><h2 id=组件交互>组件交互<a hidden class=anchor aria-hidden=true href=#组件交互>#</a></h2><ol><li>核心是使用 <code>ha-ble-adv</code> 通过蓝牙与设备交互，控制开关和亮度</li><li>通过 Home Assistant 提供的 HomeKit Bridge 连接到 iPhone 家庭应用，来实现控制</li><li>要让 Home Assistant 成功使用上 <code>ha-ble-adv</code> 需要具备以下条件：<ol><li>通过 <code>HACS</code> 安装组件 <code>ha-ble-adv</code></li><li>通过 ESP Home 在 ESP32 上面安装 <code>esphome-ble-adv-proxy</code> 以供 <code>ha-ble-adv</code> 发送和接收蓝牙信息</li></ol></li></ol><p>以下是整体架构图</p><img src=/images/integrate-bluetooth-lamp-into-homekit-step-by-step/ha-ble-adv-arch02.webp alt=ha-ble-adv-arch02><p>话不多说，让我们开始吧。基于上面的实现，为了教程的连贯性，让我们从 ESP32 开始。</p><p>首先创建一个目录存放本次用到的所有组件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir Home-Assistant
</span></span><span style=display:flex><span>$ cd Home-Assistant
</span></span></code></pre></div><h1 id=第一部分-esp-home>第一部分： ESP Home <a name=Step1><a hidden class=anchor aria-hidden=true href=#第一部分-esp-home>#</a></h1><h2 id=安装-esp-home>安装 ESP Home<a hidden class=anchor aria-hidden=true href=#安装-esp-home>#</a></h2><h3 id=要做什么>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么>#</a></h3><p>使用 Docker 安装 ESP Home。
当然，可以访问 <a href=https://esphome.io/guides/getting_started_command_line#bonus-esphome-device-builder>官方文档</a> 获取更多安装方式。</p><h3 id=怎么做>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做>#</a></h3><ol><li>使用以下 Docker compose 文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Home-Assistant/docker-compose.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/esphome/esphome</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./esphome/config:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privileged</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network_mode</span>: <span style=color:#ae81ff>host</span>
</span></span></code></pre></div><ol start=2><li>启动运行</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker compose up -d
</span></span></code></pre></div><h3 id=结果验证>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证>#</a></h3><p>在浏览器访问 <a href=http://localhost:6052>http://localhost:6052</a> 能够进入 ESP Home 后台。</p><p>遇到问题请参考 <a href=https://esphome.io/guides/getting_started_command_line#installation>官方文档</a>。</p><h2 id=连接-esp32>连接 ESP32<a hidden class=anchor aria-hidden=true href=#连接-esp32>#</a></h2><h3 id=要做什么-1>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-1>#</a></h3><p>添加 ESP32 到 ESP Home 进行管理，用于后续安装组件。</p><h3 id=怎么做-1>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-1>#</a></h3><ol><li>将你的 ESP32 设备通过有线连接到 MacOS</li><li>在 ESP Home 后台添加设备，设置一个名字，比如 <code>esp32-ble-adv-proxy</code></li><li>选择 ESP32 连接的串口</li><li>输入 Wi-Fi 信息（SSID & Password）<ul><li><strong>重要：确保连接 2.4G Wi-Fi</strong></li></ul></li><li>开始安装，选择 Plug into this computer</li><li>等待 2 分钟以上，安装完毕</li></ol><h3 id=结果验证-1>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-1>#</a></h3><ul><li>安装完成后会有提示</li><li>关闭提示后可以在后台看到刚才添加的设备是在线状态（ONLINE）</li><li>点击 LOGS 可以查看到相关日志</li></ul><h3 id=遇到问题>遇到问题<a hidden class=anchor aria-hidden=true href=#遇到问题>#</a></h3><ul><li>无法安装？等待大于 2 分钟以上，检查安装过程中页面上面文案是否有变化</li><li>安装后设备不在线？<ul><li>检查 Wi-Fi 信息是否正确</li><li>检查是否连接的是 2.4G Wi-Fi</li></ul></li></ul><h2 id=安装-esphome-ble-adv-proxy>安装 <code>esphome-ble-adv-proxy</code><a hidden class=anchor aria-hidden=true href=#安装-esphome-ble-adv-proxy>#</a></h2><h3 id=要做什么-2>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-2>#</a></h3><p>在 ESP Home 后台为刚连接的 ESP32 设备安装社区组件 <code>esphome-ble_adv_proxy</code>。</p><p>当然，可以访问 <a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble_adv_proxy</a> 获取详细安装说明。</p><h3 id=怎么做-2>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-2>#</a></h3><ol><li>在 ESP Home 后台对设备 <code>esp32-ble-adv-proxy</code> 点击 Edit</li><li>编辑如下信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>(...)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp32dev</span> <span style=color:#75715e># Or your specific board model</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>framework</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>esp-idf</span> <span style=color:#75715e># Recommended for BLE stability</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable ESP32 Bluetooth Low Energy Tracker</span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scan_parameters</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Active scanning can discover more devices but uses more power</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>active</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable standard Home Assistant Bluetooth Proxy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>bluetooth_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>active</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the external component source for ble_adv_proxy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>external_components</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source</span>: <span style=color:#ae81ff>github://NicoIIT/esphome-ble_adv_proxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable the ble_adv_proxy component</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ble_adv_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># No specific configuration needed here unless specified by component docs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>(...)</span>
</span></span></code></pre></div><ol start=3><li>点击保存（Save），点击安装（Install），选择无线安装（Wireless）</li><li>等待 2 分钟以上，安装完毕</li></ol><h3 id=结果验证-2>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-2>#</a></h3><ul><li>选择无线安装以后，可以实时查看安装进度</li><li>安装完成后，点击新出现的 VISIT 按钮，会跳转到调试页面，观察页面是否有数据产生</li><li><strong>注意：当前页面地址 <code>http://esp32-ble-adv-proxy.local</code></strong></li></ul><p>遇到问题？可以根据安装日志提示寻找相关解决方案。</p><p>至此，ESP32 部分准备完成，让我们回到主线 Home Assistant。</p><h1 id=第二部分-home-assistant>第二部分： Home Assistant<a hidden class=anchor aria-hidden=true href=#第二部分-home-assistant>#</a></h1><h2 id=安装-home-assistant>安装 Home Assistant<a hidden class=anchor aria-hidden=true href=#安装-home-assistant>#</a></h2><h3 id=要做什么-3>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-3>#</a></h3><p>通过 python 直接在 MacOS 主机上面安装 Home Assistant Core。
<strong>注意：本教程对于在 Docker 内运行的 Home Assistant 无法成功</strong>，详见下面 <a href=/zh/posts/integrate-bluetooth-lamp-into-homekit-step-by-step/#QA>Q&amp;A</a></p><p>当然，可以访问 <a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>官方文档</a> 获取更多安装说明。</p><h3 id=怎么做-3>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-3>#</a></h3><ol><li>初始化 python 环境</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ python3 -m venv .
</span></span><span style=display:flex><span>$ source ./bin/activate
</span></span></code></pre></div><ol start=2><li>安装 <code>homeassistant</code> Core</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pip3 install homeassistant<span style=color:#f92672>==</span>2025.4.4
</span></span></code></pre></div><ol start=3><li>创建一个配置目录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir config
</span></span></code></pre></div><ol start=4><li>启动</li></ol><pre tabindex=0><code>hass --config config
</code></pre><h3 id=结果验证-3>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-3>#</a></h3><ul><li>在浏览器访问 <a href=http://localhost:8123>http://localhost:8123</a> 能够进入 Home Assistant 后台</li><li>创建帐号，完成首次登录流程</li></ul><p>遇到问题请参考 <a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>官方文档</a>。</p><h2 id=接入-esp32>接入 ESP32<a hidden class=anchor aria-hidden=true href=#接入-esp32>#</a></h2><h3 id=要做什么-4>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-4>#</a></h3><p>在 Home Assistant 后台添加上面 ESP32 集成。</p><h3 id=怎么做-4>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-4>#</a></h3><p>如果之前的步骤一切顺利的话，在 Home Assistant 完成安装后，会自发现 ESP32 设备，点击添加即可。
如果没有自发现，我们仍然可以手动添加：</p><ol><li>在 <code>Settings > Devices & Services</code> 点击 ADD INTEGRATION 搜索 ESP Home 进行添加</li><li>输入上面的地址 <code>esp32-ble-adv-proxy.local</code></li><li>点击添加</li><li>回到 ESP Home 复制 <code>esp32-ble-adv-proxy</code> API Key 完成集成</li></ol><h3 id=结果验证-4>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-4>#</a></h3><ul><li>在 Home Assistant <code>Devices & Services</code> 页面显示添加成功的 ESP32 设备和蓝牙</li></ul><h3 id=遇到问题-1>遇到问题<a hidden class=anchor aria-hidden=true href=#遇到问题-1>#</a></h3><ul><li>手动添加失败？<ul><li>检查 <a href=http://esp32-ble-adv-proxy.local>http://esp32-ble-adv-proxy.local</a> 是否可以访问</li><li>检查 ESP Home 是否运行</li></ul></li><li>找不到 API Key<ul><li>在 ESP Home 设备卡片，点击 ··· 按钮，点击 Show API Key</li></ul></li><li>更多帮助可以查看 <a href=https://esphome.io/guides/getting_started_hassio>官方文档</a></li></ul><h2 id=安装-home-assistant-community-store>安装 Home Assistant Community Store<a hidden class=anchor aria-hidden=true href=#安装-home-assistant-community-store>#</a></h2><h3 id=要做什么-5>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-5>#</a></h3><p>在 Home Assistant 后台安装 HACS 集成
当然，可以访问 <a href=https://hacs.xyz/>官方文档</a> 获取更多安装说明。</p><h3 id=怎么做-5>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-5>#</a></h3><ol><li>确保 <code>wget</code> 是可用的</li><li>在命令行执行安装命令</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget -O - https://get.hacs.xyz | bash -
</span></span></code></pre></div><ol start=3><li>重启 Home Assistant</li><li>在 <code>Settings > Devices & Services</code> 点击 ADD INTEGRATION 搜索 HACS 进行添加</li><li>根据指引完成 GitHub 帐号授权</li><li>安装完成</li></ol><h3 id=结果验证-5>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-5>#</a></h3><ul><li>在 Home Assistant 后台导航菜单可以看到 HACS</li></ul><p>遇到问题？请参考 <a href=https://hacs.xyz/docs/use/configuration/basic/>官方文档</a> 完成配置</p><h2 id=安装-ha-ble-adv>安装 <code>ha-ble-adv</code><a hidden class=anchor aria-hidden=true href=#安装-ha-ble-adv>#</a></h2><h3 id=要做什么-6>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-6>#</a></h3><p>通过 HACS 安装自定义仓库 <code>ha-ble-adv</code></p><h3 id=怎么做-6>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-6>#</a></h3><ol><li>进入 Home Assistant，进入 HACS</li><li>点击 ··· 右上角 > <code>Custom respositories</code></li><li>根据指引安装 <code>https://github.com/NicoIIT/ha-ble-adv</code></li></ol><h3 id=结果验证-6>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-6>#</a></h3><ul><li>安装成功</li><li>在 <code>Settings > Devices & Services</code> 点击 ADD INTEGRATION 能够搜索到 BLE ADV</li></ul><p>遇到问题？请参考 <a href=https://hacs.xyz/docs/use/repositories/dashboard/>官方文档</a> 安装自定义仓库指引</p><h2 id=添加-蓝牙灯-设备>添加 蓝牙灯 设备<a hidden class=anchor aria-hidden=true href=#添加-蓝牙灯-设备>#</a></h2><h3 id=要做什么-7>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-7>#</a></h3><p>添加 <code>ha-ble-adv</code> 蓝牙灯设备集成</p><h3 id=怎么做-7>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-7>#</a></h3><ol><li>在 <code>Settings > Devices & Services</code> 点击 ADD INTEGRATION 搜索 BLE ADV 进行添加</li><li>根据指引进行添加，推荐选择 Duplicate Paired Phone App Config</li></ol><h3 id=结果验证-7>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-7>#</a></h3><ul><li>添加成功</li><li>在 Overview 可以通过 Home Assistant 直接控制蓝牙灯</li></ul><h3 id=遇到问题-2>遇到问题<a hidden class=anchor aria-hidden=true href=#遇到问题-2>#</a></h3><ul><li>无法打开安装指引？<ul><li>需要手动加载 <code>ble-adv</code> 组件</li><li>打开 <code>config/configurations.yml</code> 进行编辑，在最后一行添加</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># config/configurations.yml</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>ble_adv</span>:
</span></span></code></pre></div><ul><li>重启 Home Assistant， 重新添加</li><li>无法接收到蓝牙信息？<ul><li>请确保前面 ESP32 在 EPS Home 是在线状态</li><li>可以通过访问 <a href=http://esp32-ble-adv-proxy.local>http://esp32-ble-adv-proxy.local</a> 来检查</li></ul></li><li>其他问题？可以参考 <a href="https://github.com/NicoIIT/ha-ble-adv?tab=readme-ov-file#faq">FAQ</a> 来排查</li></ul><h2 id=接入-homekit-bridge>接入 HomeKit Bridge<a hidden class=anchor aria-hidden=true href=#接入-homekit-bridge>#</a></h2><p>截止上一步，我们实现了通过 Home Assistant 控制蓝牙来控制蓝牙灯。
接下来，我们进入最后一步，接入 HomeKit Bridge 来接入家庭应用。</p><h3 id=要做什么-8>要做什么<a hidden class=anchor aria-hidden=true href=#要做什么-8>#</a></h3><p>通过 HomeKit Bridge 接入家庭应用。
当然，可以访问 <a href=https://www.home-assistant.io/integrations/homekit>官方文档</a> 获取更多安装说明。</p><h3 id=怎么做-8>怎么做<a hidden class=anchor aria-hidden=true href=#怎么做-8>#</a></h3><ol><li>在 <code>Settings > Devices & Services</code> 点击 ADD INTEGRATION 搜索 Apple 点击后添加 HomeKit Bridge</li><li>这里无需额外配置，直接点击下一步即可</li><li>完成添加后，打开左下角 Notification</li><li>iPhone 打开家庭应用，扫描二维码添加设备</li><li>扫描成功后会弹窗 未认证配件，点击 仍要添加 完成配置</li></ol><h3 id=结果验证-8>结果验证<a hidden class=anchor aria-hidden=true href=#结果验证-8>#</a></h3><ul><li>蓝牙灯控制出现在 iPhone 家庭应用</li><li>可以通过 家庭应用 / Siri 控制 灯 开关和灯光</li></ul><h3 id=遇到问题-3>遇到问题<a hidden class=anchor aria-hidden=true href=#遇到问题-3>#</a></h3><p>在最后一步遇到的问题会多一些，以下是我遇到的问题，排查思路和解决方案。</p><p><strong>扫码后无法添加，提示 找不到设备？</strong></p><p>主要是网络问题引起，请依次检查：</p><p>排查一：排查本机 mDNS 是否正常工作：</p><p>【操作步骤】</p><ul><li>在命令行执行以下命令</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ dns-sd -B _hap._tcp local
</span></span></code></pre></div><p>【结果验证】</p><p>如果返回以下信息，说明本机 mDNS 没问题，注意右边 Instance Name 含有 HASS Bridge</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Timestamp     A/R    Flags  <span style=color:#66d9ef>if</span> Domain     Service Type     Instance Name
</span></span><span style=display:flex><span> 0:29:39.244  Add        <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>10</span> local.     _hap._tcp.       HASS Bridge xxxxxx
</span></span></code></pre></div><p>【解决方式一】</p><ol><li>打开 Debug 日志，打开 <code>config/configurations.yml</code> 进行编辑，在最后一行添加</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>default</span>: <span style=color:#ae81ff>warning</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>logs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>homeassistant.components.homekit</span>: <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pyhap</span>: <span style=color:#ae81ff>debug</span>
</span></span></code></pre></div><ol start=2><li>重启 Home Assistant</li><li>重新扫码添加设备到家庭应用</li><li>观察是否有异常日志</li><li>根据日志报错搜索相关解决方案</li></ol><p>【解决方式二】</p><ul><li>若使用 Docker 启动 Home Assistant，改为直接安装 Home Assistant 到本机。</li></ul><p>排查二：排查手机 mDNS 是否正常工作：</p><p>【操作步骤】</p><ol><li>在 Apple Store 搜索 Discovery - DNS-SD Browser</li><li>安装后打开，检查 local 域</li></ol><p>【结果验证】</p><ul><li>检查是否存在 <code>_hap._tcp</code></li><li>点击查看，是否存在 <code>HASS Bridge xxxxxx</code></li><li>如果存在，说明手机 mDNS 通信在同一个网络下没问题</li></ul><p>【解决方式一】</p><ul><li>检查手机和运行 Home Assistant 的 MacOS 是否在同一个网络下</li></ul><p>【解决方式二】</p><ul><li>检查 MacOS 防火墙配置，是否有禁止端口：<ul><li>HomeKit Bridge <code>21063</code></li><li>mDNS <code>5353</code></li></ul></li></ul><p>【解决方式三】</p><ul><li>检查路由器配置，是否禁用 mDNS</li></ul><p><strong>其他问题？</strong></p><p>以下是我在排查问题中找到的一些有用的文章，希望能对你有启发：</p><ul><li><a href=https://www.home-assistant.io/integrations/homekit#troubleshooting>Offcial: HomeKit Troubleshooting</a></li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>Community: HomeKit Bridge on Home Assistant in Docker</a></li><li><a href=https://community.home-assistant.io/t/using-homekit-component-inside-docker/45409>Community: Use HomeKit Component inside Docker</a></li><li><a href=https://www.reddit.com/r/HomeKit/comments/a3iwwj/troubleshooting_homekit_what_tools_to_use_and_how/>Reddit: Troubleshooting HomeKit What Tools to Use and How</a></li><li><a href=https://github.com/home-assistant/core/issues/15692>GitHub issue: Homekit not working with docker</a></li><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>GitHub gist: Home Assistant Docker on MacOS</a></li></ul><h2 id=enjoy>Enjoy！<a hidden class=anchor aria-hidden=true href=#enjoy>#</a></h2><p>太好了，大功告成！开始享用家庭应用控制蓝牙灯吧。</p><h1 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h1><p>本教程详细介绍了如何将特定的蓝牙灯（如 LampSmart Pro 控制的灯）通过一系列开源工具接入 Apple HomeKit 智能家居系统。我们从准备 ESP32 开发板开始，利用 ESPHome 安装了 <code>esphome-ble-adv-proxy</code> 以实现蓝牙通信代理。接着，我们在 MacOS 上安装了 Home Assistant Core，并集成了 ESP32 设备。通过 HACS，我们安装了关键的 <code>ha-ble-adv</code> 自定义组件，用于发现和控制蓝牙灯。最后，利用 Home Assistant 内置的 HomeKit Bridge 功能，成功将蓝牙灯设备桥接至 iPhone 的家庭应用，实现了通过家庭 App 和 Siri 进行控制。教程中也涵盖了各个步骤可能遇到的问题及其排查方法，特别是 HomeKit 连接时常见的 mDNS 网络问题。遵循本教程，你可以将原本“不智能”的蓝牙设备融入现代智能家居生态。</p><h1 id=答疑>答疑 <a name=QA><a hidden class=anchor aria-hidden=true href=#答疑>#</a></h1><h3 id=q1-是否可以使用-docker-运行-home-assistant>Q1 是否可以使用 Docker 运行 Home Assistant<a hidden class=anchor aria-hidden=true href=#q1-是否可以使用-docker-运行-home-assistant>#</a></h3><p>可以，但我没有成功，可以参考</p><ul><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>GitHub gist: Home Assistant Docker on MacOS</a>。</li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>Community: HomeKit Bridge on Home Assistant in Docker</a></li></ul><p>使用 Docker 会有什么问题？</p><ul><li>我遇到的问题是 HomeKit 死活连不上，排查后发现是主机的 mDNS 网络无法探查到 Docker 内部 HomeKit Bridge 网络。就算使用 <code>network_mode=host</code> 也不行，我就放弃折腾 Docker，改为安装到本机。</li></ul><h3 id=q2-是否可以不用-esp32-使用-macos-自带的蓝牙功能>Q2 是否可以不用 ESP32， 使用 MacOS 自带的蓝牙功能<a hidden class=anchor aria-hidden=true href=#q2-是否可以不用-esp32-使用-macos-自带的蓝牙功能>#</a></h3><p>目前不行，有 2 个原因：</p><ol><li>使用 Docker 运行，无法在 Docker 内使用主机的蓝牙功能，最简单的方式是使用 ESP32 代理一下</li><li>目前 MacOS 自带的蓝牙功能无法满足 <code>ble-adv</code> 功能，可以参考 <a href>作者回复</a></li></ol><h3 id=q3-本机运行-home-assistant-脚本>Q3 本机运行 Home Assistant 脚本<a hidden class=anchor aria-hidden=true href=#q3-本机运行-home-assistant-脚本>#</a></h3><p>后台运行脚本，创建一个文件 <code>run.sh</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>source bin/activate
</span></span><span style=display:flex><span>nohup hass --config config &gt; hass.log 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Home Assistant started on: http://localhost:8123&#34;</span>
</span></span></code></pre></div><p>添加执行权限</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ chmod +x run.sh
</span></span></code></pre></div><p>启动 Home Assistant</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./run.sh
</span></span></code></pre></div><p>查看日志</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tail -f hass.log
</span></span></code></pre></div><p>停止 Home Assistant</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pkill -f <span style=color:#e6db74>&#34;hass --config config&#34;</span>
</span></span></code></pre></div><h1 id=引用>引用<a hidden class=anchor aria-hidden=true href=#引用>#</a></h1><ul><li><a href=https://www.home-assistant.io/>Home Assistant (HA)</a></li><li><a href=https://hacs.xyz/>Home Assistant Community Store (HACS)</a></li><li><a href=https://github.com/NicoIIT/ha-ble-adv/>ha-ble-adv</a></li><li><a href=https://esphome.io/>ESP Home</a></li><li><a href=https://github.com/NicoIIT/esphome-ble_adv_proxy>esphome-ble-adv-proxy</a></li><li><a href=https://esphome.io/guides/getting_started_command_line#bonus-esphome-device-builder>ESP Home 官方文档 - 安装</a></li><li><a href=https://esphome.io/guides/getting_started_command_line#installation>ESP Home 官方文档 - 安装问题</a></li><li><a href=https://esphome.io/guides/getting_started_hassio>ESP Home 官方文档 - Home Assistant 集成</a></li><li><a href=https://www.home-assistant.io/installation/macos#install-home-assistant-core>Home Assistant 官方文档 - MacOS 安装</a></li><li><a href=https://www.home-assistant.io/integrations/homekit>Home Assistant 官方文档 - HomeKit 集成</a></li><li><a href=https://www.home-assistant.io/integrations/homekit#troubleshooting>Home Assistant 官方文档 - HomeKit Troubleshooting</a></li><li><a href=https://hacs.xyz/>HACS 官方文档 - 首页</a></li><li><a href=https://hacs.xyz/docs/use/configuration/basic/>HACS 官方文档 - 配置</a></li><li><a href=https://hacs.xyz/docs/use/repositories/dashboard/>HACS 官方文档 - 自定义仓库</a></li><li><a href="https://github.com/NicoIIT/ha-ble-adv?tab=readme-ov-file#faq">ha-ble-adv FAQ</a></li><li><a href=https://community.home-assistant.io/t/guide-homekit-bridge-on-home-assistant-in-docker-nanopi-r6s-friendlywrt-possibly-openwrt/775006>Community: HomeKit Bridge on Home Assistant in Docker</a></li><li><a href=https://community.home-assistant.io/t/using-homekit-component-inside-docker/45409>Community: Use HomeKit Component inside Docker</a></li><li><a href=https://www.reddit.com/r/HomeKit/comments/a3iwwj/troubleshooting_homekit_what_tools_to_use_and_how/>Reddit: Troubleshooting HomeKit What Tools to Use and How</a></li><li><a href=https://github.com/home-assistant/core/issues/15692>GitHub issue: Homekit not working with docker</a></li><li><a href=https://gist.github.com/dieu/96cded47544ee48ce0b3c69d529b723c>GitHub gist: Home Assistant Docker on MacOS</a></li><li>ESP Home 后台 <a href=http://localhost:6052>http://localhost:6052</a></li><li>Home Assistant 后台 <a href=http://localhost:8123>http://localhost:8123</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://lexcao.io/zh/tags/%E8%93%9D%E7%89%99/>蓝牙</a></li><li><a href=https://lexcao.io/zh/tags/homekit/>HomeKit</a></li><li><a href=https://lexcao.io/zh/tags/home-assistant/>Home Assistant</a></li><li><a href=https://lexcao.io/zh/tags/esphome/>ESPHome</a></li><li><a href=https://lexcao.io/zh/tags/%E6%95%99%E7%A8%8B/>教程</a></li></ul><nav class=paginav><a class=next href=https://lexcao.io/zh/posts/integrate-bluetooth-lamp-into-homekit/><span class=title>下一页 »</span><br><span>折腾：蓝牙吸顶灯接入 HomeKit</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lexcao.io/zh/>The Coding Notes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>