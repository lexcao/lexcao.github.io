<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°) | The Coding Notes</title><meta name=keywords content="Java,Kotlin,Spring,JPA"><meta name=description content="ç—›ç‚¹ é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ JpaSpecificationExecutor<T> æ„é€  Specification<T> è½»æ¾åº”å¯¹ã€‚
è€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚
å°½ç®¡å¯ä»¥ä½¿ç”¨ EntityManager åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º ResultSet ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚
æ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Specification<T> è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚
æƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µã€‚
åŸºç¡€æ“ä½œ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤ã€‘
å‰ç½®è¯´æ˜ ç›¸å…³ä¾èµ– Java 11 SpringBoot 2.4.2 build.gradle
plugins { id 'org.springframework.boot' version '2.4.2' id 'io.spring.dependency-management' version '1.0.11.RELEASE' id 'java' } dependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' compileOnly 'org.projectlombok:lombok' runtimeOnly 'mysql:mysql-connector-java' annotationProcessor 'org."><meta name=author content="Lex Cao"><link rel=canonical href=https://lexcao.io/zh/posts/spring-data-jpa-join-table/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b1540977aafa12664148f5c3a53472ca37129bcd9cbbdf6f6336462e0e1e9ecb.css integrity="sha256-sVQJd6r6EmZBSPXDpTRyyjcSm82cu99vYzZGLg4enss=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lexcao.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lexcao.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lexcao.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lexcao.io/apple-touch-icon.png><link rel=mask-icon href=https://lexcao.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.0"><link rel=alternate hreflang=zh href=https://lexcao.io/zh/posts/spring-data-jpa-join-table/><script async src="https://www.googletagmanager.com/gtag/js?id=G-DDVMDVDZMH"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DDVMDVDZMH",{anonymize_ip:!1})}</script><meta property="og:title" content="Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)"><meta property="og:description" content="ç—›ç‚¹ é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ JpaSpecificationExecutor<T> æ„é€  Specification<T> è½»æ¾åº”å¯¹ã€‚
è€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚
å°½ç®¡å¯ä»¥ä½¿ç”¨ EntityManager åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º ResultSet ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚
æ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Specification<T> è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚
æƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µã€‚
åŸºç¡€æ“ä½œ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤ã€‘
å‰ç½®è¯´æ˜ ç›¸å…³ä¾èµ– Java 11 SpringBoot 2.4.2 build.gradle
plugins { id 'org.springframework.boot' version '2.4.2' id 'io.spring.dependency-management' version '1.0.11.RELEASE' id 'java' } dependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' compileOnly 'org.projectlombok:lombok' runtimeOnly 'mysql:mysql-connector-java' annotationProcessor 'org."><meta property="og:type" content="article"><meta property="og:url" content="https://lexcao.io/zh/posts/spring-data-jpa-join-table/"><meta property="og:image" content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&fit=crop&w=720&q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-24T00:00:00+00:00"><meta property="og:site_name" content="The Coding Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1510843572979-e4b9e790fdd7?auto=format&fit=crop&w=720&q=80"><meta name=twitter:title content="Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)"><meta name=twitter:description content="ç—›ç‚¹ é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ JpaSpecificationExecutor<T> æ„é€  Specification<T> è½»æ¾åº”å¯¹ã€‚
è€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚
å°½ç®¡å¯ä»¥ä½¿ç”¨ EntityManager åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º ResultSet ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚
æ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Specification<T> è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚
æƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µã€‚
åŸºç¡€æ“ä½œ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤ã€‘
å‰ç½®è¯´æ˜ ç›¸å…³ä¾èµ– Java 11 SpringBoot 2.4.2 build.gradle
plugins { id 'org.springframework.boot' version '2.4.2' id 'io.spring.dependency-management' version '1.0.11.RELEASE' id 'java' } dependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' compileOnly 'org.projectlombok:lombok' runtimeOnly 'mysql:mysql-connector-java' annotationProcessor 'org."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)","item":"https://lexcao.io/zh/posts/spring-data-jpa-join-table/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)","name":"Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)","description":"ç—›ç‚¹ é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ JpaSpecificationExecutor\u0026lt;T\u0026gt; æ„é€  Specification\u0026lt;T\u0026gt; è½»æ¾åº”å¯¹ã€‚\nè€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚\nå°½ç®¡å¯ä»¥ä½¿ç”¨ EntityManager åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º ResultSet ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚\næ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Specification\u0026lt;T\u0026gt; è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚\næƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µã€‚\nåŸºç¡€æ“ä½œ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤ã€‘\nå‰ç½®è¯´æ˜ ç›¸å…³ä¾èµ– Java 11 SpringBoot 2.4.2 build.gradle\nplugins { id \u0026#39;org.springframework.boot\u0026#39; version \u0026#39;2.4.2\u0026#39; id \u0026#39;io.spring.dependency-management\u0026#39; version \u0026#39;1.0.11.RELEASE\u0026#39; id \u0026#39;java\u0026#39; } dependencies { implementation \u0026#39;org.springframework.boot:spring-boot-starter-data-jpa\u0026#39; compileOnly \u0026#39;org.projectlombok:lombok\u0026#39; runtimeOnly \u0026#39;mysql:mysql-connector-java\u0026#39; annotationProcessor \u0026#39;org.","keywords":["Java","Kotlin","Spring","JPA"],"articleBody":"ç—›ç‚¹ é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ JpaSpecificationExecutor æ„é€  Specification è½»æ¾åº”å¯¹ã€‚\nè€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚\nå°½ç®¡å¯ä»¥ä½¿ç”¨ EntityManager åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º ResultSet ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚\næ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Specification è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚\næƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µã€‚\nåŸºç¡€æ“ä½œ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤ã€‘\nå‰ç½®è¯´æ˜ ç›¸å…³ä¾èµ– Java 11 SpringBoot 2.4.2 build.gradle\nplugins { id 'org.springframework.boot' version '2.4.2' id 'io.spring.dependency-management' version '1.0.11.RELEASE' id 'java' } dependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' compileOnly 'org.projectlombok:lombok' runtimeOnly 'mysql:mysql-connector-java' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testRuntimeOnly 'com.h2database:h2' } maven.xml\n\u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-maven-plugin\u003c/artifactId\u003e \u003cconfiguration\u003e \u003cexcludes\u003e \u003cexclude\u003e \u003cgroupId\u003eorg.projectlombok\u003c/groupId\u003e \u003cartifactId\u003elombok\u003c/artifactId\u003e \u003c/exclude\u003e \u003c/excludes\u003e \u003c/configuration\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-data-jpa\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.h2database\u003c/groupId\u003e \u003cartifactId\u003eh2\u003c/artifactId\u003e \u003cscope\u003eruntime\u003c/scope\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.projectlombok\u003c/groupId\u003e \u003cartifactId\u003elombok\u003c/artifactId\u003e \u003coptional\u003etrue\u003c/optional\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e æ¨¡æ‹Ÿåœºæ™¯ ä¸‰ä¸ªå®ä½“ï¼šä½œè€…ã€ä¹¦ã€ä¹¦è¯„ã€‚å…¶ä¸­ï¼Œä½œè€…ä¸ä¹¦æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¹¦ä¸ä¹¦è¯„æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼ˆå½“ç„¶ä¹¦è¯„ä¸è¯»è€…çš„è¯„ä»·æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè¿™é‡Œçœå»ï¼Œä»…ç”¨ä¸€å¯¹ä¸€æ¥è¿›è¡Œæ¼”ç¤ºå³å¯ï¼‰ã€‚\nå‡è®¾æœ‰è¿™æ ·çš„åå°æŸ¥è¯¢æ¡ä»¶ï¼šä½œè€…åç§°ã€ä¹¦çš„å‘å¸ƒæ—¶é—´ã€ä¹¦è¯„çš„è¯„åˆ†ã€‚ï¼ˆè¿™é‡Œæ¯ä¸ªå®ä½“å–ä¸€ä¸ªå­—æ®µè¿›è¡Œè¿è¡¨æŸ¥è¯¢æ¼”ç¤ºï¼Œå…¶ä»–å­—æ®µåŒç†ï¼‰ã€‚è¿”å›ä¹¦ç±åˆ—è¡¨ä»¥åŠç›¸å…³è¡¨å­—æ®µã€‚\nå®ä½“å…³ç³» è¡¨ç»“æ„ CREATE TABLE `author` ( `id` VARCHAR(255) PRIMARY KEY, `name` VARCHAR(255) ); CREATE TABLE `book` ( `id` VARCHAR(255) PRIMARY KEY, `publish_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP, `author_id` VARCHAR(255), `review_id` VARCHAR(255) ); CREATE TABLE `review` ( `id` VARCHAR(255) PRIMARY KEY, `score` INT ); -- æ•°æ®åˆå§‹åŒ– INSERT INTO `author` (`id`, `name`) VALUES ('A_1', 'Author_1'), ('A_2', 'Author_2'), ('A_3', 'Author_3'), ('A_4', 'Author_4'), ('A_5', 'Author_5'); INSERT INTO `review` (`id`, `score`) VALUES ('R_1', 20), ('R_2', 30), ('R_3', 40), ('R_4', 50), ('R_5', 60), ('R_6', 70), ('R_7', 80), ('R_8', 90); INSERT INTO `book` (`id`, `author_id`, `review_id`) VALUES ('B_1', 'A_1', 'R_1'), ('B_2', 'A_2', 'R_2'), ('B_3', 'A_3', 'R_3'), ('B_4', 'A_4', 'R_4'), ('B_5', 'A_5', 'R_5'), ('B_6', 'A_2', 'R_6'), ('B_7', 'A_2', 'R_7'), ('B_8', 'A_3', 'R_8'); JPA å®ä½“å…³ç³» ä½¿ç”¨ Java persistence API æ„å»ºå¦‚ä¸‹å®ä½“å…³ç³»ï¼Œå…¶ä»–ä¸šåŠ¡å­—æ®µçœç•¥ã€‚\n@Data @Table @Entity public class Author { @Id private String id; private String name; } @Data @Table @Entity public class Book { @Id private String id; @Column(name = \"publish_time\") private LocalDateTime publishTime; @ManyToOne(fetch = FetchType.LAZY) @JoinColumn(name = \"author_id\", foreignKey = @ForeignKey(ConstraintMode.NO_CONSTRAINT)) private Author author; @OneToOne(fetch = FetchType.LAZY) @JoinColumn(name = \"review_id\", foreignKey = @ForeignKey(ConstraintMode.NO_CONSTRAINT)) private Review review; } @Data @Table @Entity public class Review { @Id private String id; } ç›¸å…³è§£é‡Šï¼š\n@Data Lombok æ³¨è§£ï¼Œè‡ªåŠ¨ç”Ÿæˆ getterã€setterã€hashcodeã€equals @Table @Entity @Id @Column @JoinColumn å‡ä¸º persistence API @ManyToOne å®ä½“æ˜ å°„å…³ç³» å¤šå¯¹ä¸€ @OneToOne å®ä½“æ˜ å°„å…³ç³» ä¸€å¯¹ä¸€ åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿è¡¨çš„æ—¶å€™ä¸ä¸€å®šæ˜¯æŸ¥è¯¢å¤šä¸ªå®ä½“çš„å…¨éƒ¨å­—æ®µï¼Œä¸ºäº†ä¸å½±å“åŸæœ‰å®ä½“å…³ç³»çš„æ­£å¸¸æ˜ å°„ï¼Œè¿™é‡Œå•ç‹¬å£°æ˜ä¸€ä¸ªç±» BookJoin æ¥æ˜ å°„æŸ¥è¯¢æ¡ä»¶è¿”å›ã€‚ä¼˜é›…çš„å®ç° Spring Data JPA è¿è¡¨æ“ä½œï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š\nåªæœ‰ SELECT æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µï¼Œæ‰éœ€è¦åœ¨å®ä½“é‡Œé¢å£°æ˜å‡ºæ¥ JOIN ON åé¢çš„æ¡ä»¶ï¼Œéœ€è¦åœ¨å®ä½“é‡Œé¢å£°æ˜å‡ºæ¥ å†æ ¹æ® Specification ä¸­çš„ query.join æ¥è¿›è¡Œ JOIN ä»¥ä¸‹æ˜¯è¿è¡¨å®ä½“ BookJoin.java æ–‡ä»¶\n@Data @Entity @Table(name = \"book\") public class BookJoin { @Id private String id; @Column(name = \"publish_time\") private LocalDateTime publishTime; @ManyToOne @JoinColumn(name = \"author_id\", foreignKey = @ForeignKey(ConstraintMode.NO_CONSTRAINT)) private Author author; @OneToOne @JoinColumn(name = \"review_id\", foreignKey = @ForeignKey(ConstraintMode.NO_CONSTRAINT)) private Review review; @Data @Entity @Table(name = \"author\") public static class Author { @Id private String id; private String name; } @Data @Entity @Table(name = \"review\") public static class Review { @Id private String id; private Integer score; } } æ„å»ºæµ‹è¯•ç¯å¢ƒ ä¸ºäº†æ¼”ç¤ºå¤šæ¡ä»¶æŸ¥è¯¢ç»“æœï¼Œè¿™é‡Œä½¿ç”¨ JUnit æ¥è¿›è¡Œå•å…ƒæµ‹è¯•\nSpringBoot x JUnit å•å…ƒæµ‹è¯•æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·çœ‹å¦ä¸€ç¯‡åšå®¢\n/** * given: * empty query * then: * paged data */ @Test void multiQuery() { var spec = BookJoinSpec.multiQuery(emptyQuery()); var page = PageRequest.of(0, 5); queryBySpecMethod(spec, page); } private Page\u003cBookJoin\u003e queryBySpecMethod(Specification\u003cBookJoin\u003e spec, PageRequest pageRequest) { var books = repo.findAll(spec, pageRequest); assertThat(books.getNumberOfElements()).isGreaterThan(0); books.getContent().forEach(it -\u003e { assertThat(it).isNotNull(); // è®¿é—®ç»“æœé›†çš„å±æ€§ï¼ŒéªŒè¯æ˜¯å¦æ‡’åŠ è½½ assertThat(it.getAuthor().getName()).isNotNull(); assertThat(it.getReview().getScore()).isNotNull(); } ); return books; } è¿è¡¨æ“ä½œ å¦‚ä½•è¿›è¡Œå£°æ˜å¼è¿è¡¨æŸ¥è¯¢ï¼Œè¿™é‡Œè®²æ¼”ç¤ºå„ç§å†™æ³•çš„ä¸åŒï¼Œ ä»¥åŠå„ä¸ªå‚æ•°æ‰€èµ·çš„ä½œç”¨ï¼Œæœ€åä¼šç»™å‡ºä¸€ä¸ªæœ€ç»ˆç‰ˆæœ¬ä½œä¸ºæœ€ä½³å®è·µå‚è€ƒã€‚\n01 ç‰ˆæœ¬ static Specification\u003cBookJoin\u003e multiQuery_01(BookJoinQuery param) { return (root, query, cb) -\u003e { var predicates = new LinkedList\u003cPredicate\u003e(); root.join(\"author\"); root.join(\"review\"); // ... }; } é€šè¿‡ä»¥ä¸Šçš„å•å…ƒæµ‹è¯•ï¼Œæ‰“å°å‡ºçš„ SQL å¦‚ä¸‹\nHibernate: SELECT `bookjoin0_`.`id` AS `id1_1_`, `bookjoin0_`.`author_id` AS `author_i3_1_`, `bookjoin0_`.`publish_time` AS `publish_2_1_`, `bookjoin0_`.`review_id` AS `review_i4_1_` FROM `book` `bookjoin0_` INNER JOIN `author` `bookjoin_a1_` ON `bookjoin0_`.`author_id` = `bookjoin_a1_`.`id` INNER JOIN `review` `bookjoin_r2_` ON `bookjoin0_`.`review_id` = `bookjoin_r2_`.`id` WHERE 1 = 1 LIMIT ? OFFSET ? Hibernate: SELECT `bookjoin_a0_`.`id` AS `id1_0_0_`, `bookjoin_a0_`.`name` AS `name2_0_0_` FROM `author` `bookjoin_a0_` WHERE `bookjoin_a0_`.`id` = ? Hibernate: SELECT `bookjoin_r0_`.`id` AS `id1_2_0_`, `bookjoin_r0_`.`score` AS `score2_2_0_` FROM `review` `bookjoin_r0_` WHERE `bookjoin_r0_`.`id` = ? Hibernate: SELECT `bookjoin_r0_`.`id` AS `id1_2_0_`, `bookjoin_r0_`.`score` AS `score2_2_0_` FROM `review` `bookjoin_r0_` WHERE `bookjoin_r0_`.`id` = ? Hibernate: SELECT `bookjoin_a0_`.`id` AS `id1_0_0_`, `bookjoin_a0_`.`name` AS `name2_0_0_` FROM `author` `bookjoin_a0_` WHERE `bookjoin_a0_`.`id` = ? Hibernate: SELECT `bookjoin_r0_`.`id` AS `id1_2_0_`, `bookjoin_r0_`.`score` AS `score2_2_0_` FROM `review` `bookjoin_r0_` WHERE `bookjoin_r0_`.`id` = ? å¯ä»¥çœ‹åˆ°ï¼š\næ•°æ®æ€»å…±æŸ¥å‡ºæ¥ 3 æ¡ï¼Œç»“æœæ‰§è¡Œçš„ SQL è¯­å¥æœ‰ 7 æ¡ åˆ†åˆ«æ˜¯ï¼š1 æ¡è¿è¡¨æŸ¥è¯¢ï¼Œ3 æ¡ author è¡¨çš„å•æŸ¥è¯¢ï¼Œ3 æ¡ review è¡¨çš„å•æŸ¥è¯¢ 02 ç‰ˆæœ¬ - ä½¿ç”¨ fetch ä¼˜åŒ– ä½¿ç”¨ fetch æ›¿ä»£ join\njoin ä»…è¿è¡¨æŸ¥è¯¢ï¼Œè¿”å›çš„ä¸»å®ä½“çš„æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ç†è§£ä¸º SELECT book.* fetch è¿è¡¨æŸ¥è¯¢ + å¿«åŠ è½½ï¼Œè¿”å›è¿è¡¨æ‰€æœ‰å®ä½“çš„å±æ€§ï¼Œå¯ä»¥ç†è§£ä¸º SELECT * static Specification\u003cBookJoin\u003e multiQuery_02(BookJoinQuery param) { return (root, query, cb) -\u003e { // ... root.fetch(\"author\"); root.fetch(\"review\"); // ... }; } é€šè¿‡ä»¥ä¸Šçš„å•å…ƒæµ‹è¯•ï¼Œæ‰“å°å‡ºçš„ SQL å¦‚ä¸‹\nHibernate: SELECT `bookjoin0_`.`id` AS `id1_1_0_`, `bookjoin_a1_`.`id` AS `id1_0_1_`, `bookjoin_r2_`.`id` AS `id1_2_2_`, `bookjoin0_`.`author_id` AS `author_i3_1_0_`, `bookjoin0_`.`publish_time` AS `publish_2_1_0_`, `bookjoin0_`.`review_id` AS `review_i4_1_0_`, `bookjoin_a1_`.`name` AS `name2_0_1_`, `bookjoin_r2_`.`score` AS `score2_2_2_` FROM `book` `bookjoin0_` INNER JOIN `author` `bookjoin_a1_` ON `bookjoin0_`.`author_id` = `bookjoin_a1_`.`id` INNER JOIN `review` `bookjoin_r2_` ON `bookjoin0_`.`review_id` = `bookjoin_r2_`.`id` WHERE 1 = 1 LIMIT ? OFFSET ? å¯ä»¥çœ‹åˆ°ï¼š\næ‰§è¡Œçš„ SQL åªæœ‰ 1 æ¡ SELECT ä¸­çš„å­—æ®µåŒ…æ‹¬è¿è¡¨çš„å­—æ®µ è¸©å‘ - åˆ†é¡µé—®é¢˜ åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨ fetch åˆ†é¡µæŠ¥é”™\n@Test void multiQuery_02() { var spec = BookJoinSpec.multiQuery_02(emptyQuery()); var page = PageRequest.of(0, 5); assertThatThrownBy(() -\u003e queryBySpecMethod(spec, page)) .hasCauseInstanceOf(QueryException.class); } å½“ä½¿ç”¨ fetch å†è¿›è¡Œåˆ†é¡µçš„æ—¶å€™ï¼Œä¼šæŠ¥ä»¥ä¸‹é”™è¯¯\nCaused by: org.hibernate.QueryException: query specified join fetching, but the owner of the fetched association was not present in the select list. åŸå› åˆ†æï¼š\nå®é™…æŠ¥é”™å‡ºç°åœ¨ count è¯­å¥ï¼Œé”™è¯¯ä¿¡æ¯è¡¨ç¤ºè¯¥ count è¯­å¥è¿”å›å€¼æ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„æ˜ å°„å±æ€§ è§£å†³æ–¹æ³•ï¼š\né’ˆå¯¹åˆ†é¡µçš„ count æŸ¥è¯¢è¯­å¥å•ç‹¬åšå¤„ç†ï¼Œä»£ç å¦‚ä¸‹ static Specification\u003cBookJoin\u003e multiQuery_02_fix(BookJoinQuery param) { return (root, query, cb) -\u003e { // ... if (Long.class.equals(query.getResultType()) || long.class.equals(query.getResultType())) { root.join(\"author\"); root.join(\"review\"); } else { root.fetch(\"author\"); root.fetch(\"review\"); } // ... }; } æ³¨æ„ å¯èƒ½ç–‘é—®ã€Œä¸Šé¢ BookJoin å®ä½“é‡Œé¢å£°æ˜å…³ç³»ä¸æ˜¯ fetch = FetchType.LAZY ï¼Œæ²¡æœ‰æŒ‡æ˜æ˜¯æ‡’åŠ è½½ï¼Œä¸ºä»€ä¹ˆè¿è¡¨æŸ¥è¯¢çš„æ—¶å€™è¿˜æ˜¯æ²¡æœ‰åŠ è½½å‡ºæ¥ã€ã€‚\nåŸå› æ˜¯ JPA é‡Œé¢ join æœºåˆ¶å¤„ç†ï¼ŒåŸç†å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š\næ ¹æ® join å’Œ fetch ç”Ÿæˆä¸åŒçš„ JpaQL è¯­å¥ï¼Œå·®åˆ«åœ¨äº join ä¸ join fetch -- fetch ç”Ÿæˆçš„ JpaQL è¯­å¥ select generatedAlias0 from BookJoin as generatedAlias0 inner join fetch generatedAlias0.author as generatedAlias1 inner join fetch generatedAlias0.review as generatedAlias2 where 1=1 -- join ç”Ÿæˆçš„ JpaQL è¯­å¥ select generatedAlias0 from BookJoin as generatedAlias0 inner join generatedAlias0.author as generatedAlias1 inner join generatedAlias0.review as generatedAlias2 where 1=1 JpaQL è¯­å¥æ ¹æ® join fetch è½¬æ¢ä¸º HQL å†è½¬æ¢ä¸ºæœ€ç»ˆçš„ SQL è¯­å¥ï¼Œé€šè¿‡ QueryTranslatorImpl ç±»ï¼Œåœ¨ doCompile æ–¹æ³•çœ‹åˆ°å®Œæ•´è½¬æ¢è¿‡ç¨‹ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ // QueryTranslatorImpl // doCompile -\u003e analyze -\u003e HqlSqlBaseWalker.statement -\u003e selectStatement // selectClause -\u003e fromClause -\u003e fromElementList -\u003e fromElement -\u003e joinElement // HqlSqlWalker.java createFromJoinElement #367 // DotNode æ­¤å¤„è®¾ç½® fetch DotNode dot = (DotNode) path; JoinType hibernateJoinType = JoinProcessor.toHibernateJoinType( joinType ); dot.setJoinType( hibernateJoinType ); // Tell the dot node about the join type. dot.setFetch( fetch ); // Generate an explicit join for the root dot node. The implied joins will be collected and passed up // to the root dot node. dot.resolve( true, false, alias == null ? null : alias.getText() ); // è§£æé˜¶æ®µ // selectStatement -\u003e query -\u003e processQuery // ä¸Šé¢çš„æŠ¥é”™åœ¨æ­¤å¤„ SelectClause.java #212 if ( !fromElementsForLoad.contains( origin ) \u0026\u0026 !fromElementsForLoad.contains( fromElement.getFetchOrigin() ) ) throw new QueryException( \"query specified join fetching, but the owner \" + \"of the fetched association was not present in the select list \" + \"[\" + fromElement.getDisplayText() + \"]\" ); } 03 ç‰ˆæœ¬ - åŠ ä¸Š WHERE æ¡ä»¶ç­›é€‰ åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•ï¼Œç­›é€‰ä¸€ä¸‹ Join æ¡ä»¶\n@Test void multiQuery_03() { var query = BookJoinQuery.builder() .authorName(\"Author_2\") .build(); var spec = BookJoinSpec.multiQuery_03(query); var page = PageRequest.of(0, 5); var result = queryBySpecMethod(spec, page); var givenAuthor = result.getContent().get(0).getAuthor(); assertThat(givenAuthor.getName()).isEqualTo(\"Author_2\"); } å…·ä½“çš„è¿è¡¨æŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹\nstatic Specification\u003cBookJoin\u003e multiQuery_03(BookJoinQuery param) { return (root, query, cb) -\u003e { var predicates = new LinkedList\u003cPredicate\u003e(); if (Long.class.equals(query.getResultType()) || long.class.equals(query.getResultType())) { root.join(\"author\"); root.join(\"review\"); } else { root.fetch(\"author\"); root.fetch(\"review\"); } if (null != param.getBookPublishTime()) { predicates.add(cb.equal(root.get(\"publishTime\"), param.getBookPublishTime())); } if (null != param.getAuthorName()) { predicates.add(cb.equal(root.get(\"author\").get(\"name\"), param.getAuthorName())); } if (null != param.getReviewScore()) { predicates.add(cb.equal(root.get(\"review\").get(\"score\"), param.getReviewScore())); } query.where(predicates.toArray(new Predicate[0])); return query.getRestriction(); }; } ç”Ÿæˆçš„æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æŸ¥è¯¢æ¡ä»¶æ˜¯æ‹¼æ¥åœ¨ WHERE éƒ¨åˆ†\nselect bookjoin0_.id as id1_1_0_, bookjoin_a1_.id as id1_0_1_, bookjoin_r2_.id as id1_2_2_, bookjoin0_.author_id as author_i3_1_0_, bookjoin0_.publish_time as publish_2_1_0_, bookjoin0_.review_id as review_i4_1_0_, bookjoin_a1_.name as name2_0_1_, bookjoin_r2_.score as score2_2_2_ from book bookjoin0_ inner join author bookjoin_a1_ on bookjoin0_.author_id = bookjoin_a1_.id inner join review bookjoin_r2_ on bookjoin0_.review_id = bookjoin_r2_.id where bookjoin_a1_.name = ? limit ? å¦‚æœæˆ‘æƒ³è¦é’ˆå¯¹ join çš„è¡¨è¿›è¡Œ on æ¡ä»¶æŸ¥è¯¢ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ ä¸‹é¢æ¥çœ‹ä¸‹ 04 ç‰ˆæœ¬ã€‚\n04 ç‰ˆæœ¬ - åŠ ä¸Š JOIN ON æ¡ä»¶ç­›é€‰ åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•\n@Test void multiQuery_04() { var query = BookJoinQuery.builder() .authorName(\"Author_2\") .reviewScore(70) .build(); var spec = BookJoinSpec.multiQuery_04(query); var page = PageRequest.of(0, 5); var bookJoin = queryBySpecMethod(spec, page).getContent().get(0); assertThat(bookJoin.getAuthor().getName()).isEqualTo(\"Author_2\"); assertThat(bookJoin.getReview().getScore()).isEqualTo(70); } é¦–å…ˆç›´æ¥å¯¹ join æ¡ä»¶è¿›è¡Œ on æŸ¥è¯¢\nstatic Specification\u003cBookJoin\u003e multiQuery_04(BookJoinQuery param) { return (root, query, cb) -\u003e { if (null != param.getBookPublishTime()) { query.where(cb.equal(root.get(\"publishTime\"), param.getBookPublishTime())); } if (null != param.getAuthorName()) { Join\u003cObject, Object\u003e author = root.join(\"author\"); author.on(cb.equal(author.get(\"name\"), param.getAuthorName())); } if (null != param.getReviewScore()) { Join\u003cObject, Object\u003e review = root.join(\"review\"); review.on(cb.equal(review.get(\"score\"), param.getReviewScore())); } return query.getRestriction(); }; } æ­¤æ—¶ç”Ÿæˆçš„ SQL è¯­å¥å¦‚ä¸‹ï¼Œèƒ½å¤ŸæˆåŠŸæ‹¼æ¥ JOIN ON æ¡ä»¶ä½†æ˜¯å‡ºç° N + 1 é—®é¢˜ï¼Œ\nselect bookjoin0_.id as id1_1_, bookjoin0_.author_id as author_i3_1_, bookjoin0_.publish_time as publish_2_1_, bookjoin0_.review_id as review_i4_1_ from book bookjoin0_ inner join author bookjoin_a1_ on bookjoin0_.author_id = bookjoin_a1_.id and (bookjoin_a1_.name = ?) inner join review bookjoin_r2_ on bookjoin0_.review_id = bookjoin_r2_.id and (bookjoin_r2_.score = ?) limit ? select bookjoin_a0_.id as id1_0_0_, bookjoin_a0_.name as name2_0_0_ from author bookjoin_a0_ where bookjoin_a0_.id = ? select bookjoin_r0_.id as id1_2_0_, bookjoin_r0_.score as score2_2_0_ from review bookjoin_r0_ where bookjoin_r0_.id = ? æ­¤æ—¶å¦‚æœæˆ‘ä»¬æ”¹ç”¨ fetch çš„è¯ï¼Œåˆä¸èƒ½è¿›è¡Œ on æ¡ä»¶ç­›é€‰ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ\nè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„æ³¨è§£ @EntityGraphï¼Œä¿®æ”¹æˆ‘ä»¬çš„æŸ¥è¯¢æ–¹æ³•\nä¸»åŠ¨å£°æ˜æŸ¥è¯¢æ–¹æ³•è¿”å›çš„ Entity æ˜ç¡®éœ€è¦è¿›è¡Œ Fetch çš„å±æ€§æœ‰å“ªäº› @Override @EntityGraph(attributePaths = { \"author\", \"review\" }) Page\u003cBookJoin\u003e findAll(Specification\u003cBookJoin\u003e spec, Pageable pageable); å†çœ‹ä¸€ä¸‹ç”Ÿæˆçš„è¯­å¥ï¼Œå¾ˆå¥½ï¼Œè‡ªåŠ¨å¸®å¿™ fetch å‡ºæ¥äº†ï¼Œå¹¶ä¸”ä¹Ÿè§£å†³äº† 02 ç‰ˆæœ¬çš„åˆ†é¡µæŸ¥è¯¢é—®é¢˜\nselect bookjoin0_.id as id1_1_0_, bookjoin_a1_.id as id1_0_1_, bookjoin_r2_.id as id1_2_2_, bookjoin0_.author_id as author_i3_1_0_, bookjoin0_.publish_time as publish_2_1_0_, bookjoin0_.review_id as review_i4_1_0_, bookjoin_a1_.name as name2_0_1_, bookjoin_r2_.score as score2_2_2_ from book bookjoin0_ inner join author bookjoin_a1_ on bookjoin0_.author_id = bookjoin_a1_.id and (bookjoin_a1_.name = ?) inner join review bookjoin_r2_ on bookjoin0_.review_id = bookjoin_r2_.id and (bookjoin_r2_.score = ?) limit ? æ³¨æ„ ä¸Šé¢ä½¿ç”¨çš„ç¤ºä¾‹æ˜¯é’ˆå¯¹ã€å¼ºä¸€å¯¹ä¸€å…³ç³»ã€‘æ‰€ä»¥ä½¿ç”¨é»˜è®¤çš„è¿æ¥ç±»å‹ INNER JOIN\nå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å·¦å¤–è¿æ¥ï¼ˆå³å¤–è¿æ¥ä¸æ”¯æŒï¼‰\nroot.join(\"author\", JoinType.LEFT); root.fetch(\"author\", JoinType.LEFT); æ‰©å±•é˜…è¯» Advanced Spring Data JPA - Specifications and Querydsl REST Query Language with Spring Data JPA Specifications Spring Data JPA Specification DSL for Kotlin ğŸ”— é“¾æ¥ Github source Spring Data JPAä½¿ç”¨Specification ğŸ‘€æ€»ç»“ ä½¿ç”¨ SpringJPA æ¥å†™åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ï¼Œé€šè¿‡ä»£ç æ¥æ§åˆ¶ SQL è¯­å¥ï¼Œéœ€è¦å¯¹ JPA ä»¥åŠ Hibernate ç›¸å…³ API ç›¸å¯¹ç†Ÿç»ƒæ‰å¯ä»¥å†™å‡ºä¼˜è´¨çš„ SQL è¯­å¥ç”Ÿæˆã€‚ å’Œ MyBatis å¯ä»¥ç›´æ¥æ‹¼æ¥ SQL çš„ç›¸æ¯”ï¼Œå„æœ‰åº”ç”¨åœºæ™¯ã€‚ æ•´ä½“æ¥è¯´ç”¨ä»£ç æ¥å†™ JPA çš„åŠ¨æ€æŸ¥è¯¢ï¼Œå¯¹äºä¹ æƒ¯ SQL è¯­å¥çš„äººæ¥è¯´ï¼Œè¿˜æ˜¯æ„Ÿè§‰éš”äº†ä¸€å±‚ã€‚ å¯¹äºè¿™æ ·çš„åˆ†é¡µè¿è¡¨æŸ¥è¯¢ï¼Œä¸ªäººæ„Ÿè§‰è¿˜æ˜¯ MyBatis èˆ’æœä¸€ç‚¹ï¼Œç®€å•ã€‚ ","wordCount":"1549","inLanguage":"zh","datePublished":"2022-09-24T00:00:00Z","dateModified":"2022-09-24T00:00:00Z","author":{"@type":"Person","name":"Lex Cao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lexcao.io/zh/posts/spring-data-jpa-join-table/"},"publisher":{"@type":"Organization","name":"The Coding Notes","logo":{"@type":"ImageObject","url":"https://lexcao.io/favicon.ico"}}}</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KJ277ZJ" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://lexcao.io/zh/ accesskey=h title="ä»£ç ç¬”è®° (Alt + H)">ä»£ç ç¬”è®°</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://lexcao.io/ title=English aria-label=English>English</a></li></ul></span></div><ul id=menu><li><a href=https://lexcao.io/zh/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li><li><a href=https://lexcao.io/zh/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://lexcao.io/zh/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://lexcao.io/zh/projects/ title=é¡¹ç›®><span>é¡¹ç›®</span></a></li><li><a href=https://lexcao.io/zh/about/ title=å…³äº><span>å…³äº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lexcao.io/zh/>ä¸»é¡µ</a></div><h1 class=post-title>Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ (2022 æ›´æ–°)</h1><div class=post-meta>2022 September 24&nbsp;Â·&nbsp;8 åˆ†é’Ÿ&nbsp;Â·&nbsp;Lex Cao</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>ç›®å½•</div></summary><div class=inner><ul><li><a href=#%e7%97%9b%e7%82%b9 aria-label=ç—›ç‚¹>ç—›ç‚¹</a></li><li><a href=#%e5%9f%ba%e7%a1%80%e6%93%8d%e4%bd%9c aria-label=åŸºç¡€æ“ä½œ>åŸºç¡€æ“ä½œ</a><ul><li><a href=#%e5%89%8d%e7%bd%ae%e8%af%b4%e6%98%8e aria-label=å‰ç½®è¯´æ˜>å‰ç½®è¯´æ˜</a><ul><li><a href=#%e7%9b%b8%e5%85%b3%e4%be%9d%e8%b5%96 aria-label=ç›¸å…³ä¾èµ–>ç›¸å…³ä¾èµ–</a></li><li><a href=#%e6%a8%a1%e6%8b%9f%e5%9c%ba%e6%99%af aria-label=æ¨¡æ‹Ÿåœºæ™¯>æ¨¡æ‹Ÿåœºæ™¯</a></li></ul></li><li><a href=#%e5%ae%9e%e4%bd%93%e5%85%b3%e7%b3%bb aria-label=å®ä½“å…³ç³»>å®ä½“å…³ç³»</a><ul><li><a href=#%e8%a1%a8%e7%bb%93%e6%9e%84 aria-label=è¡¨ç»“æ„>è¡¨ç»“æ„</a></li><li><a href=#jpa-%e5%ae%9e%e4%bd%93%e5%85%b3%e7%b3%bb aria-label="JPA å®ä½“å…³ç³»">JPA å®ä½“å…³ç³»</a></li></ul></li><li><a href=#%e6%9e%84%e5%bb%ba%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83 aria-label=æ„å»ºæµ‹è¯•ç¯å¢ƒ>æ„å»ºæµ‹è¯•ç¯å¢ƒ</a></li></ul></li><li><a href=#%e8%bf%9e%e8%a1%a8%e6%93%8d%e4%bd%9c aria-label=è¿è¡¨æ“ä½œ>è¿è¡¨æ“ä½œ</a><ul><li><a href=#01-%e7%89%88%e6%9c%ac aria-label="01 ç‰ˆæœ¬">01 ç‰ˆæœ¬</a></li><li><a href=#02-%e7%89%88%e6%9c%ac---%e4%bd%bf%e7%94%a8-fetch-%e4%bc%98%e5%8c%96 aria-label="02 ç‰ˆæœ¬ - ä½¿ç”¨ fetch ä¼˜åŒ–">02 ç‰ˆæœ¬ - ä½¿ç”¨ fetch ä¼˜åŒ–</a><ul><li><a href=#%e8%b8%a9%e5%9d%91---%e5%88%86%e9%a1%b5%e9%97%ae%e9%a2%98 aria-label="è¸©å‘ - åˆ†é¡µé—®é¢˜">è¸©å‘ - åˆ†é¡µé—®é¢˜</a></li><li><a href=#%e6%b3%a8%e6%84%8f aria-label=æ³¨æ„>æ³¨æ„</a></li></ul></li><li><a href=#03-%e7%89%88%e6%9c%ac---%e5%8a%a0%e4%b8%8a-where-%e6%9d%a1%e4%bb%b6%e7%ad%9b%e9%80%89 aria-label="03 ç‰ˆæœ¬ - åŠ ä¸Š WHERE æ¡ä»¶ç­›é€‰">03 ç‰ˆæœ¬ - åŠ ä¸Š WHERE æ¡ä»¶ç­›é€‰</a></li><li><a href=#04-%e7%89%88%e6%9c%ac---%e5%8a%a0%e4%b8%8a-join-on-%e6%9d%a1%e4%bb%b6%e7%ad%9b%e9%80%89 aria-label="04 ç‰ˆæœ¬ - åŠ ä¸Š JOIN ON æ¡ä»¶ç­›é€‰">04 ç‰ˆæœ¬ - åŠ ä¸Š JOIN ON æ¡ä»¶ç­›é€‰</a></li><li><a href=#%e6%b3%a8%e6%84%8f-1 aria-label=æ³¨æ„>æ³¨æ„</a></li></ul></li><li><a href=#%e6%89%a9%e5%b1%95%e9%98%85%e8%af%bb aria-label=æ‰©å±•é˜…è¯»>æ‰©å±•é˜…è¯»</a></li><li><a href=#-%e9%93%be%e6%8e%a5 aria-label="ğŸ”— é“¾æ¥">ğŸ”— é“¾æ¥</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=ğŸ‘€æ€»ç»“>ğŸ‘€æ€»ç»“</a></li></ul></div></details></div><div class=post-content><h1 id=ç—›ç‚¹>ç—›ç‚¹<a hidden class=anchor aria-hidden=true href=#ç—›ç‚¹>#</a></h1><p>é¡¹ç›®ä¸­ä½¿ç”¨ Spring Data JPA ä½œä¸º ORM æ¡†æ¶çš„æ—¶å€™ï¼Œå®ä½“æ˜ å°„éå¸¸æ–¹ä¾¿ã€‚Spring Data Repository çš„é¡¶å±‚æŠ½è±¡å®Œå…¨è§£å†³å•å®ä½“çš„æŸ¥è¯¢ï¼Œé¢å¯¹å•å®ä½“çš„å¤æ‚æŸ¥è¯¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ <code>JpaSpecificationExecutor&lt;T></code> æ„é€  <code>Specification&lt;T></code> è½»æ¾åº”å¯¹ã€‚</p><p>è€Œå¯¹äºåå°ç®¡ç†æŠ¥è¡¨æŸ¥è¯¢éœ€æ±‚æ¥è¯´ï¼Œéœ€è¦è¿›è¡Œè¿è¡¨å¤šæ¡ä»¶åŠ¨æ€æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—æ— ä»ä¸‹æ‰‹ã€‚å› ä¸ºå®ƒå¹¶ä¸åƒ MyBatis ä¸€æ ·èƒ½å¤Ÿåœ¨ XML æ–‡ä»¶ä¸­å†™å‡ºåŠ¨æ€ SQL è¯­å¥ã€‚</p><p>å°½ç®¡å¯ä»¥ä½¿ç”¨ <code>EntityManager</code> åŠ¨æ€æ‹¼æ¥åŸç”Ÿ SQL è¯­å¥ï¼Œä½†æ˜¯è¯¥æ–¹æ³•è¿”å›å€¼ä¸º <code>ResultSet</code> ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥å‡ºæ¥çš„å®ä½“æ˜ å°„å…³ç³»éœ€è¦æ‰‹åŠ¨æ˜ å°„ï¼ˆğŸ˜¢è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œå·²ç»å®šä¹‰å‡ºå®ä½“ï¼Œè¿˜éœ€è¦è‡ªå·±å»æ˜ å°„ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ï¼Œåœ¨ç°æœ‰å®ä½“å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»“åˆ <code>Specification&lt;T></code> è®°å½•ä¸‹ Spring Data JPA å¤šæ¡ä»¶åŠ¨æ€è¿è¡¨æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå…¶ä¸­çš„è¸©å‘å’Œä¼˜åŒ–ã€‚</p><p>æƒ³è¦ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·çœ‹è¿™ç¯‡ <a href=/zh/posts/spring-data-jpa-join-table-best-practice>Spring Data JPA åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µ</a>ã€‚</p><h1 id=åŸºç¡€æ“ä½œ>åŸºç¡€æ“ä½œ<a hidden class=anchor aria-hidden=true href=#åŸºç¡€æ“ä½œ>#</a></h1><p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»£ç æ“ä½œã€‚ã€<a href=https://github.com/lexcao/spring-data-jpa-join-table>æœ¬æ–‡æ‰€æœ‰ä»£ç åœ¨æ­¤</a>ã€‘</p><h2 id=å‰ç½®è¯´æ˜>å‰ç½®è¯´æ˜<a hidden class=anchor aria-hidden=true href=#å‰ç½®è¯´æ˜>#</a></h2><h3 id=ç›¸å…³ä¾èµ–>ç›¸å…³ä¾èµ–<a hidden class=anchor aria-hidden=true href=#ç›¸å…³ä¾èµ–>#</a></h3><ul><li>Java 11</li><li>SpringBoot 2.4.2</li></ul><p>build.gradle</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;org.springframework.boot&#39;</span> version <span style=color:#e6db74>&#39;2.4.2&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;io.spring.dependency-management&#39;</span> version <span style=color:#e6db74>&#39;1.0.11.RELEASE&#39;</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;</span>
</span></span><span style=display:flex><span>    compileOnly <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    runtimeOnly <span style=color:#e6db74>&#39;mysql:mysql-connector-java&#39;</span>
</span></span><span style=display:flex><span>    annotationProcessor <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
</span></span><span style=display:flex><span>    testRuntimeOnly <span style=color:#e6db74>&#39;com.h2database:h2&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>maven.xml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>&lt;</span>build<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span>plugins<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>plugin<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>maven<span style=color:#f92672>-</span>plugin<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span>configuration<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span>excludes<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span>exclude<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>lombok<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/</span>exclude<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/</span>excludes<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/</span>configuration<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/</span>plugin<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/</span>plugins<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/</span>build<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>dependencies<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span><span style=color:#66d9ef>data</span><span style=color:#f92672>-</span>jpa<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>com.h2database<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>h2<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>scope</span><span style=color:#f92672>&gt;</span>runtime<span style=color:#f92672>&lt;/</span><span style=color:#66d9ef>scope</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>lombok<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>optional<span style=color:#f92672>&gt;</span><span style=color:#66d9ef>true</span><span style=color:#f92672>&lt;/</span>optional<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>groupId<span style=color:#f92672>&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/</span>groupId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span>artifactId<span style=color:#f92672>&gt;</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>test<span style=color:#f92672>&lt;/</span>artifactId<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>scope</span><span style=color:#f92672>&gt;</span>test<span style=color:#f92672>&lt;/</span><span style=color:#66d9ef>scope</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/</span>dependency<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/</span>dependencies<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><h3 id=æ¨¡æ‹Ÿåœºæ™¯>æ¨¡æ‹Ÿåœºæ™¯<a hidden class=anchor aria-hidden=true href=#æ¨¡æ‹Ÿåœºæ™¯>#</a></h3><p>ä¸‰ä¸ªå®ä½“ï¼šä½œè€…ã€ä¹¦ã€ä¹¦è¯„ã€‚å…¶ä¸­ï¼Œä½œè€…ä¸ä¹¦æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¹¦ä¸ä¹¦è¯„æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼ˆå½“ç„¶ä¹¦è¯„ä¸è¯»è€…çš„è¯„ä»·æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè¿™é‡Œçœå»ï¼Œä»…ç”¨ä¸€å¯¹ä¸€æ¥è¿›è¡Œæ¼”ç¤ºå³å¯ï¼‰ã€‚</p><p>å‡è®¾æœ‰è¿™æ ·çš„åå°æŸ¥è¯¢æ¡ä»¶ï¼šä½œè€…åç§°ã€ä¹¦çš„å‘å¸ƒæ—¶é—´ã€ä¹¦è¯„çš„è¯„åˆ†ã€‚ï¼ˆè¿™é‡Œæ¯ä¸ªå®ä½“å–ä¸€ä¸ªå­—æ®µè¿›è¡Œè¿è¡¨æŸ¥è¯¢æ¼”ç¤ºï¼Œå…¶ä»–å­—æ®µåŒç†ï¼‰ã€‚è¿”å›ä¹¦ç±åˆ—è¡¨ä»¥åŠç›¸å…³è¡¨å­—æ®µã€‚</p><h2 id=å®ä½“å…³ç³»>å®ä½“å…³ç³»<a hidden class=anchor aria-hidden=true href=#å®ä½“å…³ç³»>#</a></h2><h3 id=è¡¨ç»“æ„>è¡¨ç»“æ„<a hidden class=anchor aria-hidden=true href=#è¡¨ç»“æ„>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>book<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>publish_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>),
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>score<span style=color:#f92672>`</span> INT
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- æ•°æ®åˆå§‹åŒ–
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;A_1&#39;</span>, <span style=color:#e6db74>&#39;Author_1&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;A_2&#39;</span>, <span style=color:#e6db74>&#39;Author_2&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;A_3&#39;</span>, <span style=color:#e6db74>&#39;Author_3&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;A_4&#39;</span>, <span style=color:#e6db74>&#39;Author_4&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;A_5&#39;</span>, <span style=color:#e6db74>&#39;Author_5&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>score<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;R_1&#39;</span>, <span style=color:#ae81ff>20</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_2&#39;</span>, <span style=color:#ae81ff>30</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_3&#39;</span>, <span style=color:#ae81ff>40</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_4&#39;</span>, <span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_5&#39;</span>, <span style=color:#ae81ff>60</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_6&#39;</span>, <span style=color:#ae81ff>70</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_7&#39;</span>, <span style=color:#ae81ff>80</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;R_8&#39;</span>, <span style=color:#ae81ff>90</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>book<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;B_1&#39;</span>, <span style=color:#e6db74>&#39;A_1&#39;</span>, <span style=color:#e6db74>&#39;R_1&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_2&#39;</span>, <span style=color:#e6db74>&#39;A_2&#39;</span>, <span style=color:#e6db74>&#39;R_2&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_3&#39;</span>, <span style=color:#e6db74>&#39;A_3&#39;</span>, <span style=color:#e6db74>&#39;R_3&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_4&#39;</span>, <span style=color:#e6db74>&#39;A_4&#39;</span>, <span style=color:#e6db74>&#39;R_4&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_5&#39;</span>, <span style=color:#e6db74>&#39;A_5&#39;</span>, <span style=color:#e6db74>&#39;R_5&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_6&#39;</span>, <span style=color:#e6db74>&#39;A_2&#39;</span>, <span style=color:#e6db74>&#39;R_6&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_7&#39;</span>, <span style=color:#e6db74>&#39;A_2&#39;</span>, <span style=color:#e6db74>&#39;R_7&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;B_8&#39;</span>, <span style=color:#e6db74>&#39;A_3&#39;</span>, <span style=color:#e6db74>&#39;R_8&#39;</span>);
</span></span></code></pre></div><h3 id=jpa-å®ä½“å…³ç³»>JPA å®ä½“å…³ç³»<a hidden class=anchor aria-hidden=true href=#jpa-å®ä½“å…³ç³»>#</a></h3><p>ä½¿ç”¨ Java persistence API æ„å»ºå¦‚ä¸‹å®ä½“å…³ç³»ï¼Œå…¶ä»–ä¸šåŠ¡å­—æ®µçœç•¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Author</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Book</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;publish_time&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> LocalDateTime publishTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToOne</span><span style=color:#f92672>(</span>fetch <span style=color:#f92672>=</span> FetchType<span style=color:#f92672>.</span><span style=color:#a6e22e>LAZY</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JoinColumn</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;author_id&#34;</span><span style=color:#f92672>,</span> foreignKey <span style=color:#f92672>=</span> <span style=color:#a6e22e>@ForeignKey</span><span style=color:#f92672>(</span>ConstraintMode<span style=color:#f92672>.</span><span style=color:#a6e22e>NO_CONSTRAINT</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Author author<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToOne</span><span style=color:#f92672>(</span>fetch <span style=color:#f92672>=</span> FetchType<span style=color:#f92672>.</span><span style=color:#a6e22e>LAZY</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JoinColumn</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;review_id&#34;</span><span style=color:#f92672>,</span> foreignKey <span style=color:#f92672>=</span> <span style=color:#a6e22e>@ForeignKey</span><span style=color:#f92672>(</span>ConstraintMode<span style=color:#f92672>.</span><span style=color:#a6e22e>NO_CONSTRAINT</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Review review<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Review</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ç›¸å…³è§£é‡Šï¼š</p><ul><li><code>@Data</code> Lombok æ³¨è§£ï¼Œè‡ªåŠ¨ç”Ÿæˆ getterã€setterã€hashcodeã€equals</li><li><code>@Table</code> <code>@Entity</code> <code>@Id</code> <code>@Column</code> <code>@JoinColumn</code> å‡ä¸º persistence API</li><li><code>@ManyToOne</code> å®ä½“æ˜ å°„å…³ç³» å¤šå¯¹ä¸€</li><li><code>@OneToOne</code> å®ä½“æ˜ å°„å…³ç³» ä¸€å¯¹ä¸€</li></ul><p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿è¡¨çš„æ—¶å€™ä¸ä¸€å®šæ˜¯æŸ¥è¯¢å¤šä¸ªå®ä½“çš„å…¨éƒ¨å­—æ®µï¼Œä¸ºäº†ä¸å½±å“åŸæœ‰å®ä½“å…³ç³»çš„æ­£å¸¸æ˜ å°„ï¼Œè¿™é‡Œå•ç‹¬å£°æ˜ä¸€ä¸ªç±» <code>BookJoin</code> æ¥æ˜ å°„æŸ¥è¯¢æ¡ä»¶è¿”å›ã€‚ä¼˜é›…çš„å®ç° Spring Data JPA è¿è¡¨æ“ä½œï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p><ul><li>åªæœ‰ SELECT æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µï¼Œæ‰éœ€è¦åœ¨å®ä½“é‡Œé¢å£°æ˜å‡ºæ¥</li><li>JOIN ON åé¢çš„æ¡ä»¶ï¼Œéœ€è¦åœ¨å®ä½“é‡Œé¢å£°æ˜å‡ºæ¥</li><li>å†æ ¹æ® Specification ä¸­çš„ query.join æ¥è¿›è¡Œ JOIN</li></ul><p>ä»¥ä¸‹æ˜¯è¿è¡¨å®ä½“ <code>BookJoin.java</code> æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;book&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BookJoin</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;publish_time&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> LocalDateTime publishTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JoinColumn</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;author_id&#34;</span><span style=color:#f92672>,</span> foreignKey <span style=color:#f92672>=</span> <span style=color:#a6e22e>@ForeignKey</span><span style=color:#f92672>(</span>ConstraintMode<span style=color:#f92672>.</span><span style=color:#a6e22e>NO_CONSTRAINT</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Author author<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JoinColumn</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;review_id&#34;</span><span style=color:#f92672>,</span> foreignKey <span style=color:#f92672>=</span> <span style=color:#a6e22e>@ForeignKey</span><span style=color:#f92672>(</span>ConstraintMode<span style=color:#f92672>.</span><span style=color:#a6e22e>NO_CONSTRAINT</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Review review<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Table</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Author</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Table</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Review</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Integer score<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=æ„å»ºæµ‹è¯•ç¯å¢ƒ>æ„å»ºæµ‹è¯•ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#æ„å»ºæµ‹è¯•ç¯å¢ƒ>#</a></h2><p>ä¸ºäº†æ¼”ç¤ºå¤šæ¡ä»¶æŸ¥è¯¢ç»“æœï¼Œè¿™é‡Œä½¿ç”¨ JUnit æ¥è¿›è¡Œå•å…ƒæµ‹è¯•</p><blockquote><p>SpringBoot x JUnit å•å…ƒæµ‹è¯•æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·çœ‹å¦ä¸€ç¯‡åšå®¢</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  given:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *      empty query
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  then:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *      paged data
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>multiQuery</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var spec <span style=color:#f92672>=</span> BookJoinSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>multiQuery</span><span style=color:#f92672>(</span>emptyQuery<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    var page <span style=color:#f92672>=</span> PageRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 5<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    queryBySpecMethod<span style=color:#f92672>(</span>spec<span style=color:#f92672>,</span> page<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Page<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>queryBySpecMethod</span><span style=color:#f92672>(</span>Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> spec<span style=color:#f92672>,</span> PageRequest pageRequest<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var books <span style=color:#f92672>=</span> repo<span style=color:#f92672>.</span><span style=color:#a6e22e>findAll</span><span style=color:#f92672>(</span>spec<span style=color:#f92672>,</span> pageRequest<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertThat<span style=color:#f92672>(</span>books<span style=color:#f92672>.</span><span style=color:#a6e22e>getNumberOfElements</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isGreaterThan</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    books<span style=color:#f92672>.</span><span style=color:#a6e22e>getContent</span><span style=color:#f92672>().</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>it <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            assertThat<span style=color:#f92672>(</span>it<span style=color:#f92672>).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>						<span style=color:#75715e>// è®¿é—®ç»“æœé›†çš„å±æ€§ï¼ŒéªŒè¯æ˜¯å¦æ‡’åŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            assertThat<span style=color:#f92672>(</span>it<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthor</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            assertThat<span style=color:#f92672>(</span>it<span style=color:#f92672>.</span><span style=color:#a6e22e>getReview</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getScore</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> books<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=è¿è¡¨æ“ä½œ>è¿è¡¨æ“ä½œ<a hidden class=anchor aria-hidden=true href=#è¿è¡¨æ“ä½œ>#</a></h1><p>å¦‚ä½•è¿›è¡Œå£°æ˜å¼è¿è¡¨æŸ¥è¯¢ï¼Œè¿™é‡Œè®²æ¼”ç¤ºå„ç§å†™æ³•çš„ä¸åŒï¼Œ ä»¥åŠå„ä¸ªå‚æ•°æ‰€èµ·çš„ä½œç”¨ï¼Œæœ€åä¼šç»™å‡ºä¸€ä¸ªæœ€ç»ˆç‰ˆæœ¬ä½œä¸ºæœ€ä½³å®è·µå‚è€ƒã€‚</p><h2 id=01-ç‰ˆæœ¬>01 ç‰ˆæœ¬<a hidden class=anchor aria-hidden=true href=#01-ç‰ˆæœ¬>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>multiQuery_01</span><span style=color:#f92672>(</span>BookJoinQuery param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>root<span style=color:#f92672>,</span> query<span style=color:#f92672>,</span> cb<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        var predicates <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedList<span style=color:#f92672>&lt;</span>Predicate<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šçš„å•å…ƒæµ‹è¯•ï¼Œæ‰“å°å‡ºçš„ SQL å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_1_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>author_i3_1_<span style=color:#f92672>`</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>publish_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>publish_2_1_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>review_i4_1_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>book<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>OFFSET</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_0_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>name2_0_0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_2_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>score<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>score2_2_0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_2_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>score<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>score2_2_0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_0_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>name2_0_0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>`</span>bookjoin_a0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_2_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>score<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>score2_2_0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>`</span>bookjoin_r0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>æ•°æ®æ€»å…±æŸ¥å‡ºæ¥ 3 æ¡ï¼Œç»“æœæ‰§è¡Œçš„ SQL è¯­å¥æœ‰ 7 æ¡</li><li>åˆ†åˆ«æ˜¯ï¼š1 æ¡è¿è¡¨æŸ¥è¯¢ï¼Œ3 æ¡ <code>author</code> è¡¨çš„å•æŸ¥è¯¢ï¼Œ3 æ¡ <code>review</code> è¡¨çš„å•æŸ¥è¯¢</li></ul><h2 id=02-ç‰ˆæœ¬---ä½¿ç”¨-fetch-ä¼˜åŒ–>02 ç‰ˆæœ¬ - ä½¿ç”¨ fetch ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#02-ç‰ˆæœ¬---ä½¿ç”¨-fetch-ä¼˜åŒ–>#</a></h2><p>ä½¿ç”¨ <code>fetch</code> æ›¿ä»£ <code>join</code></p><ul><li><code>join</code> ä»…è¿è¡¨æŸ¥è¯¢ï¼Œè¿”å›çš„ä¸»å®ä½“çš„æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ç†è§£ä¸º <code>SELECT book.*</code></li><li><code>fetch</code> è¿è¡¨æŸ¥è¯¢ + å¿«åŠ è½½ï¼Œè¿”å›è¿è¡¨æ‰€æœ‰å®ä½“çš„å±æ€§ï¼Œå¯ä»¥ç†è§£ä¸º <code>SELECT *</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>multiQuery_02</span><span style=color:#f92672>(</span>BookJoinQuery param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>root<span style=color:#f92672>,</span> query<span style=color:#f92672>,</span> cb<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	      <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šçš„å•å…ƒæµ‹è¯•ï¼Œæ‰“å°å‡ºçš„ SQL å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>Hibernate:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_1_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_0_1_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>id1_2_2_<span style=color:#f92672>`</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>author_i3_1_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>publish_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>publish_2_1_0_<span style=color:#f92672>`</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>review_i4_1_0_<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>name2_0_1_<span style=color:#f92672>`</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>score<span style=color:#f92672>`</span> <span style=color:#66d9ef>AS</span> <span style=color:#f92672>`</span>score2_2_2_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#f92672>`</span>book<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>author<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>author_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>`</span>bookjoin_a1_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>review<span style=color:#f92672>`</span> <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>`</span>bookjoin0_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>review_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> <span style=color:#f92672>`</span>bookjoin_r2_<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>OFFSET</span> <span style=color:#f92672>?</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>æ‰§è¡Œçš„ SQL åªæœ‰ 1 æ¡</li><li>SELECT ä¸­çš„å­—æ®µåŒ…æ‹¬è¿è¡¨çš„å­—æ®µ</li></ul><h3 id=è¸©å‘---åˆ†é¡µé—®é¢˜>è¸©å‘ - åˆ†é¡µé—®é¢˜<a hidden class=anchor aria-hidden=true href=#è¸©å‘---åˆ†é¡µé—®é¢˜>#</a></h3><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨ <code>fetch</code> åˆ†é¡µæŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>multiQuery_02</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var spec <span style=color:#f92672>=</span> BookJoinSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>multiQuery_02</span><span style=color:#f92672>(</span>emptyQuery<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    var page <span style=color:#f92672>=</span> PageRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 5<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertThatThrownBy<span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> queryBySpecMethod<span style=color:#f92672>(</span>spec<span style=color:#f92672>,</span> page<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>.</span><span style=color:#a6e22e>hasCauseInstanceOf</span><span style=color:#f92672>(</span>QueryException<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>å½“ä½¿ç”¨ <code>fetch</code> å†è¿›è¡Œåˆ†é¡µçš„æ—¶å€™ï¼Œä¼šæŠ¥ä»¥ä¸‹é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Caused by<span style=color:#f92672>:</span> org<span style=color:#f92672>.</span><span style=color:#a6e22e>hibernate</span><span style=color:#f92672>.</span><span style=color:#a6e22e>QueryException</span><span style=color:#f92672>:</span> query specified join fetching<span style=color:#f92672>,</span> but the owner of the fetched association was not present in the select list<span style=color:#f92672>.</span>
</span></span></code></pre></div><p>åŸå› åˆ†æï¼š</p><ul><li>å®é™…æŠ¥é”™å‡ºç°åœ¨ count è¯­å¥ï¼Œé”™è¯¯ä¿¡æ¯è¡¨ç¤ºè¯¥ count è¯­å¥è¿”å›å€¼æ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„æ˜ å°„å±æ€§</li></ul><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li>é’ˆå¯¹åˆ†é¡µçš„ count æŸ¥è¯¢è¯­å¥å•ç‹¬åšå¤„ç†ï¼Œä»£ç å¦‚ä¸‹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>multiQuery_02_fix</span><span style=color:#f92672>(</span>BookJoinQuery param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>root<span style=color:#f92672>,</span> query<span style=color:#f92672>,</span> cb<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	      <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Long<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>query<span style=color:#f92672>.</span><span style=color:#a6e22e>getResultType</span><span style=color:#f92672>())</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>query<span style=color:#f92672>.</span><span style=color:#a6e22e>getResultType</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	          root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	          root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	      <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	          root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	          root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=æ³¨æ„>æ³¨æ„<a hidden class=anchor aria-hidden=true href=#æ³¨æ„>#</a></h3><p>å¯èƒ½ç–‘é—®ã€Œä¸Šé¢ BookJoin å®ä½“é‡Œé¢å£°æ˜å…³ç³»ä¸æ˜¯ <code>fetch = FetchType.LAZY</code> ï¼Œæ²¡æœ‰æŒ‡æ˜æ˜¯æ‡’åŠ è½½ï¼Œä¸ºä»€ä¹ˆè¿è¡¨æŸ¥è¯¢çš„æ—¶å€™è¿˜æ˜¯æ²¡æœ‰åŠ è½½å‡ºæ¥ã€ã€‚</p><p>åŸå› æ˜¯ JPA é‡Œé¢ <code>join</code> æœºåˆ¶å¤„ç†ï¼ŒåŸç†å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ ¹æ® <code>join</code> å’Œ <code>fetch</code> ç”Ÿæˆä¸åŒçš„ <code>JpaQL</code> è¯­å¥ï¼Œå·®åˆ«åœ¨äº <code>join</code> ä¸ <code>join fetch</code></li></ol><pre tabindex=0><code>-- fetch ç”Ÿæˆçš„ JpaQL è¯­å¥
select generatedAlias0 from BookJoin as generatedAlias0 inner join fetch generatedAlias0.author as generatedAlias1 inner join fetch generatedAlias0.review as generatedAlias2 where 1=1

-- join ç”Ÿæˆçš„ JpaQL è¯­å¥
select generatedAlias0 from BookJoin as generatedAlias0 inner join generatedAlias0.author as generatedAlias1 inner join generatedAlias0.review as generatedAlias2 where 1=1
</code></pre><ol start=2><li><code>JpaQL</code> è¯­å¥æ ¹æ® <code>join fetch</code> è½¬æ¢ä¸º <code>HQL</code> å†è½¬æ¢ä¸ºæœ€ç»ˆçš„ SQL è¯­å¥ï¼Œé€šè¿‡ <code>QueryTranslatorImpl</code> ç±»ï¼Œåœ¨ <code>doCompile</code> æ–¹æ³•çœ‹åˆ°å®Œæ•´è½¬æ¢è¿‡ç¨‹ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// QueryTranslatorImpl
</span></span></span><span style=display:flex><span><span style=color:#75715e>// doCompile -&gt; analyze -&gt; HqlSqlBaseWalker.statement -&gt; selectStatement
</span></span></span><span style=display:flex><span><span style=color:#75715e>// selectClause -&gt; fromClause -&gt; fromElementList -&gt; fromElement -&gt; joinElement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// HqlSqlWalker.java createFromJoinElement  #367
</span></span></span><span style=display:flex><span><span style=color:#75715e>// DotNode æ­¤å¤„è®¾ç½® fetch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DotNode dot <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>DotNode<span style=color:#f92672>)</span> path<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>JoinType hibernateJoinType <span style=color:#f92672>=</span> JoinProcessor<span style=color:#f92672>.</span><span style=color:#a6e22e>toHibernateJoinType</span><span style=color:#f92672>(</span> joinType <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>dot<span style=color:#f92672>.</span><span style=color:#a6e22e>setJoinType</span><span style=color:#f92672>(</span> hibernateJoinType <span style=color:#f92672>);</span>    <span style=color:#75715e>// Tell the dot node about the join type.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>dot<span style=color:#f92672>.</span><span style=color:#a6e22e>setFetch</span><span style=color:#f92672>(</span> fetch <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generate an explicit join for the root dot node.   The implied joins will be collected and passed up
</span></span></span><span style=display:flex><span><span style=color:#75715e>// to the root dot node.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>dot<span style=color:#f92672>.</span><span style=color:#a6e22e>resolve</span><span style=color:#f92672>(</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> alias <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> alias<span style=color:#f92672>.</span><span style=color:#a6e22e>getText</span><span style=color:#f92672>()</span> <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è§£æé˜¶æ®µ
</span></span></span><span style=display:flex><span><span style=color:#75715e>// selectStatement -&gt; query -&gt; processQuery
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ä¸Šé¢çš„æŠ¥é”™åœ¨æ­¤å¤„  SelectClause.java #212
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span> <span style=color:#f92672>!</span>fromElementsForLoad<span style=color:#f92672>.</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span> origin <span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>fromElementsForLoad<span style=color:#f92672>.</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span> fromElement<span style=color:#f92672>.</span><span style=color:#a6e22e>getFetchOrigin</span><span style=color:#f92672>()</span> <span style=color:#f92672>)</span> <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> QueryException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;query specified join fetching, but the owner &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;of the fetched association was not present in the select list &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;[&#34;</span> <span style=color:#f92672>+</span> fromElement<span style=color:#f92672>.</span><span style=color:#a6e22e>getDisplayText</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;]&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=03-ç‰ˆæœ¬---åŠ ä¸Š-where-æ¡ä»¶ç­›é€‰>03 ç‰ˆæœ¬ - åŠ ä¸Š WHERE æ¡ä»¶ç­›é€‰<a hidden class=anchor aria-hidden=true href=#03-ç‰ˆæœ¬---åŠ ä¸Š-where-æ¡ä»¶ç­›é€‰>#</a></h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•ï¼Œç­›é€‰ä¸€ä¸‹ Join æ¡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>multiQuery_03</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var query <span style=color:#f92672>=</span> BookJoinQuery<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>authorName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Author_2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    var spec <span style=color:#f92672>=</span> BookJoinSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>multiQuery_03</span><span style=color:#f92672>(</span>query<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    var page <span style=color:#f92672>=</span> PageRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 5<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var result <span style=color:#f92672>=</span> queryBySpecMethod<span style=color:#f92672>(</span>spec<span style=color:#f92672>,</span> page<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    var givenAuthor <span style=color:#f92672>=</span> result<span style=color:#f92672>.</span><span style=color:#a6e22e>getContent</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>0<span style=color:#f92672>).</span><span style=color:#a6e22e>getAuthor</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    assertThat<span style=color:#f92672>(</span>givenAuthor<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isEqualTo</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Author_2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>å…·ä½“çš„è¿è¡¨æŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>multiQuery_03</span><span style=color:#f92672>(</span>BookJoinQuery param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>root<span style=color:#f92672>,</span> query<span style=color:#f92672>,</span> cb<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        var predicates <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedList<span style=color:#f92672>&lt;</span>Predicate<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Long<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>query<span style=color:#f92672>.</span><span style=color:#a6e22e>getResultType</span><span style=color:#f92672>())</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>query<span style=color:#f92672>.</span><span style=color:#a6e22e>getResultType</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getBookPublishTime</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            predicates<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;publishTime&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getBookPublishTime</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthorName</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            predicates<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthorName</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getReviewScore</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            predicates<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;score&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getReviewScore</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        query<span style=color:#f92672>.</span><span style=color:#a6e22e>where</span><span style=color:#f92672>(</span>predicates<span style=color:#f92672>.</span><span style=color:#a6e22e>toArray</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Predicate<span style=color:#f92672>[</span>0<span style=color:#f92672>]));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> query<span style=color:#f92672>.</span><span style=color:#a6e22e>getRestriction</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ç”Ÿæˆçš„æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æŸ¥è¯¢æ¡ä»¶æ˜¯æ‹¼æ¥åœ¨ <code>WHERE</code> éƒ¨åˆ†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> bookjoin0_.id           <span style=color:#66d9ef>as</span> id1_1_0_,
</span></span><span style=display:flex><span>       bookjoin_a1_.id         <span style=color:#66d9ef>as</span> id1_0_1_,
</span></span><span style=display:flex><span>       bookjoin_r2_.id         <span style=color:#66d9ef>as</span> id1_2_2_,
</span></span><span style=display:flex><span>       bookjoin0_.author_id    <span style=color:#66d9ef>as</span> author_i3_1_0_,
</span></span><span style=display:flex><span>       bookjoin0_.publish_time <span style=color:#66d9ef>as</span> publish_2_1_0_,
</span></span><span style=display:flex><span>       bookjoin0_.review_id    <span style=color:#66d9ef>as</span> review_i4_1_0_,
</span></span><span style=display:flex><span>       bookjoin_a1_.name       <span style=color:#66d9ef>as</span> name2_0_1_,
</span></span><span style=display:flex><span>       bookjoin_r2_.score      <span style=color:#66d9ef>as</span> score2_2_2_
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> book bookjoin0_
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> author bookjoin_a1_ <span style=color:#66d9ef>on</span> bookjoin0_.author_id <span style=color:#f92672>=</span> bookjoin_a1_.id
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> review bookjoin_r2_ <span style=color:#66d9ef>on</span> bookjoin0_.review_id <span style=color:#f92672>=</span> bookjoin_r2_.id
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> bookjoin_a1_.name <span style=color:#f92672>=</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>limit</span> <span style=color:#f92672>?</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘æƒ³è¦é’ˆå¯¹ <code>join</code> çš„è¡¨è¿›è¡Œ <code>on</code> æ¡ä»¶æŸ¥è¯¢ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ
ä¸‹é¢æ¥çœ‹ä¸‹ 04 ç‰ˆæœ¬ã€‚</p><h2 id=04-ç‰ˆæœ¬---åŠ ä¸Š-join-on-æ¡ä»¶ç­›é€‰>04 ç‰ˆæœ¬ - åŠ ä¸Š JOIN ON æ¡ä»¶ç­›é€‰<a hidden class=anchor aria-hidden=true href=#04-ç‰ˆæœ¬---åŠ ä¸Š-join-on-æ¡ä»¶ç­›é€‰>#</a></h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>multiQuery_04</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var query <span style=color:#f92672>=</span> BookJoinQuery<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>authorName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Author_2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>reviewScore</span><span style=color:#f92672>(</span>70<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var spec <span style=color:#f92672>=</span> BookJoinSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>multiQuery_04</span><span style=color:#f92672>(</span>query<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    var page <span style=color:#f92672>=</span> PageRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 5<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var bookJoin <span style=color:#f92672>=</span> queryBySpecMethod<span style=color:#f92672>(</span>spec<span style=color:#f92672>,</span> page<span style=color:#f92672>).</span><span style=color:#a6e22e>getContent</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertThat<span style=color:#f92672>(</span>bookJoin<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthor</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isEqualTo</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Author_2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertThat<span style=color:#f92672>(</span>bookJoin<span style=color:#f92672>.</span><span style=color:#a6e22e>getReview</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getScore</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isEqualTo</span><span style=color:#f92672>(</span>70<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>é¦–å…ˆç›´æ¥å¯¹ <code>join</code> æ¡ä»¶è¿›è¡Œ <code>on</code> æŸ¥è¯¢</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>multiQuery_04</span><span style=color:#f92672>(</span>BookJoinQuery param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>root<span style=color:#f92672>,</span> query<span style=color:#f92672>,</span> cb<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getBookPublishTime</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            query<span style=color:#f92672>.</span><span style=color:#a6e22e>where</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;publishTime&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getBookPublishTime</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthorName</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Join<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> author <span style=color:#f92672>=</span> root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>on</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>author<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthorName</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getReviewScore</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Join<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> review <span style=color:#f92672>=</span> root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;review&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            review<span style=color:#f92672>.</span><span style=color:#a6e22e>on</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>.</span><span style=color:#a6e22e>equal</span><span style=color:#f92672>(</span>review<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;score&#34;</span><span style=color:#f92672>),</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>getReviewScore</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> query<span style=color:#f92672>.</span><span style=color:#a6e22e>getRestriction</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>æ­¤æ—¶ç”Ÿæˆçš„ SQL è¯­å¥å¦‚ä¸‹ï¼Œèƒ½å¤ŸæˆåŠŸæ‹¼æ¥ JOIN ON æ¡ä»¶ä½†æ˜¯å‡ºç° N + 1 é—®é¢˜ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> bookjoin0_.id           <span style=color:#66d9ef>as</span> id1_1_,
</span></span><span style=display:flex><span>       bookjoin0_.author_id    <span style=color:#66d9ef>as</span> author_i3_1_,
</span></span><span style=display:flex><span>       bookjoin0_.publish_time <span style=color:#66d9ef>as</span> publish_2_1_,
</span></span><span style=display:flex><span>       bookjoin0_.review_id    <span style=color:#66d9ef>as</span> review_i4_1_
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> book bookjoin0_
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> author bookjoin_a1_ <span style=color:#66d9ef>on</span> bookjoin0_.author_id <span style=color:#f92672>=</span> bookjoin_a1_.id <span style=color:#66d9ef>and</span> (bookjoin_a1_.name <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>)
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> review bookjoin_r2_ <span style=color:#66d9ef>on</span> bookjoin0_.review_id <span style=color:#f92672>=</span> bookjoin_r2_.id <span style=color:#66d9ef>and</span> (bookjoin_r2_.score <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>) <span style=color:#66d9ef>limit</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> bookjoin_a0_.id <span style=color:#66d9ef>as</span> id1_0_0_, bookjoin_a0_.name <span style=color:#66d9ef>as</span> name2_0_0_
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> author bookjoin_a0_
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> bookjoin_a0_.id <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> bookjoin_r0_.id <span style=color:#66d9ef>as</span> id1_2_0_, bookjoin_r0_.score <span style=color:#66d9ef>as</span> score2_2_0_
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> review bookjoin_r0_
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> bookjoin_r0_.id <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>
</span></span></code></pre></div><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬æ”¹ç”¨ <code>fetch</code> çš„è¯ï¼Œåˆä¸èƒ½è¿›è¡Œ <code>on</code> æ¡ä»¶ç­›é€‰ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„æ³¨è§£ <code>@EntityGraph</code>ï¼Œä¿®æ”¹æˆ‘ä»¬çš„æŸ¥è¯¢æ–¹æ³•</p><ul><li>ä¸»åŠ¨å£°æ˜æŸ¥è¯¢æ–¹æ³•è¿”å›çš„ Entity æ˜ç¡®éœ€è¦è¿›è¡Œ Fetch çš„å±æ€§æœ‰å“ªäº›</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EntityGraph</span><span style=color:#f92672>(</span>attributePaths <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;review&#34;</span> <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>Page<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findAll</span><span style=color:#f92672>(</span>Specification<span style=color:#f92672>&lt;</span>BookJoin<span style=color:#f92672>&gt;</span> spec<span style=color:#f92672>,</span> Pageable pageable<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>å†çœ‹ä¸€ä¸‹ç”Ÿæˆçš„è¯­å¥ï¼Œå¾ˆå¥½ï¼Œè‡ªåŠ¨å¸®å¿™ fetch å‡ºæ¥äº†ï¼Œå¹¶ä¸”ä¹Ÿè§£å†³äº† 02 ç‰ˆæœ¬çš„åˆ†é¡µæŸ¥è¯¢é—®é¢˜</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> bookjoin0_.id           <span style=color:#66d9ef>as</span> id1_1_0_,
</span></span><span style=display:flex><span>       bookjoin_a1_.id         <span style=color:#66d9ef>as</span> id1_0_1_,
</span></span><span style=display:flex><span>       bookjoin_r2_.id         <span style=color:#66d9ef>as</span> id1_2_2_,
</span></span><span style=display:flex><span>       bookjoin0_.author_id    <span style=color:#66d9ef>as</span> author_i3_1_0_,
</span></span><span style=display:flex><span>       bookjoin0_.publish_time <span style=color:#66d9ef>as</span> publish_2_1_0_,
</span></span><span style=display:flex><span>       bookjoin0_.review_id    <span style=color:#66d9ef>as</span> review_i4_1_0_,
</span></span><span style=display:flex><span>       bookjoin_a1_.name       <span style=color:#66d9ef>as</span> name2_0_1_,
</span></span><span style=display:flex><span>       bookjoin_r2_.score      <span style=color:#66d9ef>as</span> score2_2_2_
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> book bookjoin0_
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> author bookjoin_a1_ <span style=color:#66d9ef>on</span> bookjoin0_.author_id <span style=color:#f92672>=</span> bookjoin_a1_.id <span style=color:#66d9ef>and</span> (bookjoin_a1_.name <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>)
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>join</span> review bookjoin_r2_ <span style=color:#66d9ef>on</span> bookjoin0_.review_id <span style=color:#f92672>=</span> bookjoin_r2_.id <span style=color:#66d9ef>and</span> (bookjoin_r2_.score <span style=color:#f92672>=</span> <span style=color:#f92672>?</span>) <span style=color:#66d9ef>limit</span> <span style=color:#f92672>?</span>
</span></span></code></pre></div><h2 id=æ³¨æ„-1>æ³¨æ„<a hidden class=anchor aria-hidden=true href=#æ³¨æ„-1>#</a></h2><p>ä¸Šé¢ä½¿ç”¨çš„ç¤ºä¾‹æ˜¯é’ˆå¯¹ã€å¼ºä¸€å¯¹ä¸€å…³ç³»ã€‘æ‰€ä»¥ä½¿ç”¨é»˜è®¤çš„è¿æ¥ç±»å‹ <code>INNER JOIN</code></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å·¦å¤–è¿æ¥ï¼ˆå³å¤–è¿æ¥ä¸æ”¯æŒï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>,</span> JoinType<span style=color:#f92672>.</span><span style=color:#a6e22e>LEFT</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;author&#34;</span><span style=color:#f92672>,</span> JoinType<span style=color:#f92672>.</span><span style=color:#a6e22e>LEFT</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><h1 id=æ‰©å±•é˜…è¯»>æ‰©å±•é˜…è¯»<a hidden class=anchor aria-hidden=true href=#æ‰©å±•é˜…è¯»>#</a></h1><ul><li><a href=https://spring.io/blog/2011/04/26/advanced-spring-data-jpa-specifications-and-querydsl>Advanced Spring Data JPA - Specifications and Querydsl</a></li><li><a href=https://www.baeldung.com/rest-api-search-language-spring-data-specifications>REST Query Language with Spring Data JPA Specifications</a></li><li><a href=https://github.com/consoleau/kotlin-jpa-specification-dsl>Spring Data JPA Specification DSL for Kotlin</a></li></ul><h1 id=-é“¾æ¥>ğŸ”— é“¾æ¥<a hidden class=anchor aria-hidden=true href=#-é“¾æ¥>#</a></h1><ul><li><a href=https://github.com/lexcao/spring-data-jpa-join-table>Github source</a></li><li><a href=https://www.jianshu.com/p/659e9715d01d>Spring Data JPAä½¿ç”¨Specification</a></li></ul><h1 id=æ€»ç»“>ğŸ‘€æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h1><ul><li>ä½¿ç”¨ SpringJPA æ¥å†™åŠ¨æ€å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢ï¼Œé€šè¿‡ä»£ç æ¥æ§åˆ¶ SQL è¯­å¥ï¼Œéœ€è¦å¯¹ JPA ä»¥åŠ Hibernate ç›¸å…³ API ç›¸å¯¹ç†Ÿç»ƒæ‰å¯ä»¥å†™å‡ºä¼˜è´¨çš„ SQL è¯­å¥ç”Ÿæˆã€‚</li><li>å’Œ MyBatis å¯ä»¥ç›´æ¥æ‹¼æ¥ SQL çš„ç›¸æ¯”ï¼Œå„æœ‰åº”ç”¨åœºæ™¯ã€‚</li><li>æ•´ä½“æ¥è¯´ç”¨ä»£ç æ¥å†™ JPA çš„åŠ¨æ€æŸ¥è¯¢ï¼Œå¯¹äºä¹ æƒ¯ SQL è¯­å¥çš„äººæ¥è¯´ï¼Œè¿˜æ˜¯æ„Ÿè§‰éš”äº†ä¸€å±‚ã€‚</li><li>å¯¹äºè¿™æ ·çš„åˆ†é¡µè¿è¡¨æŸ¥è¯¢ï¼Œä¸ªäººæ„Ÿè§‰è¿˜æ˜¯ MyBatis èˆ’æœä¸€ç‚¹ï¼Œç®€å•ã€‚</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://lexcao.io/zh/tags/java/>Java</a></li><li><a href=https://lexcao.io/zh/tags/kotlin/>Kotlin</a></li><li><a href=https://lexcao.io/zh/tags/spring/>Spring</a></li><li><a href=https://lexcao.io/zh/tags/jpa/>JPA</a></li></ul><nav class=paginav><a class=prev href=https://lexcao.io/zh/posts/spring-data-jpa-join-table-best-practice/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Spring Data JPA å¤šæ¡ä»¶è¿è¡¨æŸ¥è¯¢æœ€ä½³å®è·µ</span></a>
<a class=next href=https://lexcao.io/zh/posts/learn-rust-fullstack/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>é€šè¿‡æ„å»ºå…¨æ ˆå¾…åŠåº”ç”¨å­¦ä¹  Rust</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://lexcao.io/zh/>The Coding Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function s(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>